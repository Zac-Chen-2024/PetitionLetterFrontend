(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";e.i(47167);var r=e.i(43476),t=e.i(71645);let s="https://exempt-upc-determine-adapted.trycloudflare.com";async function a(e,r){let t=`${s}${e}`,a=await fetch(t,{...r,headers:{"Content-Type":"application/json",...r?.headers}});if(!a.ok)throw Error(await a.text()||`API error: ${a.status}`);return a.json()}let o=(e,r)=>a(`/api/projects/${e}`,{method:"PATCH",body:JSON.stringify(r)});function l({header:e,documents:t,highlight:s,analysis:a,generate:o}){return(0,r.jsxs)("div",{className:"min-h-screen bg-[var(--color-background)]",children:[(0,r.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,r.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--color-primary)] text-white flex items-center justify-center text-sm font-semibold",children:"1"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text)]",children:"Upload Documents"})]}),t]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("div",{className:"w-px h-8 bg-[var(--color-border)]"})}),(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--color-warning)] text-white flex items-center justify-center text-sm font-semibold",children:"2"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text)]",children:"Document Highlights"})]}),s]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("div",{className:"w-px h-8 bg-[var(--color-border)]"})}),(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--color-primary)] text-white flex items-center justify-center text-sm font-semibold",children:"3"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text)]",children:"Evidence Analysis"})]}),a]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("div",{className:"w-px h-8 bg-[var(--color-border)]"})}),(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--color-success)] text-white flex items-center justify-center text-sm font-semibold",children:"4"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text)]",children:"Generate Paragraphs"})]}),o]})]})})]})}let n=[{key:"documents",label:"Documents",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})},{key:"highlight",label:"Highlights",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})},{key:"analysis",label:"Analysis",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})},{key:"generate",label:"Generate",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}];function i({header:e,documents:s,highlight:a,analysis:o,generate:l}){let[i,c]=(0,t.useState)("documents");return(0,r.jsxs)("div",{className:"min-h-screen bg-[var(--color-background)]",children:[(0,r.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsxs)("aside",{className:"w-64 min-h-[calc(100vh-64px)] bg-[var(--color-surface)] border-r border-[var(--color-border)] sticky top-16 self-start",children:[(0,r.jsx)("nav",{className:"p-4 space-y-1",children:n.map(e=>(0,r.jsxs)("button",{onClick:()=>c(e.key),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all ${i===e.key?"bg-blue-50 text-[var(--color-primary)]":"text-[var(--color-text-secondary)] hover:bg-gray-50 hover:text-[var(--color-text)]"}`,children:[e.icon,(0,r.jsx)("span",{className:"font-medium",children:e.label}),i===e.key&&(0,r.jsx)("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-[var(--color-primary)]"})]},e.key))}),(0,r.jsxs)("div",{className:"p-4 border-t border-[var(--color-border)] mt-4",children:[(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)] mb-2",children:"Progress"}),(0,r.jsx)("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[var(--color-primary)] transition-all duration-300",style:{width:(()=>{switch(i){case"documents":return"0%";case"highlight":return"33%";case"analysis":return"66%";case"generate":return"100%"}})()}})}),(0,r.jsx)("div",{className:"flex justify-between mt-2",children:["1","2","3","4"].map((e,t)=>(0,r.jsx)("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs ${t<=n.findIndex(e=>e.key===i)?"bg-[var(--color-primary)] text-white":"bg-gray-200 text-[var(--color-text-secondary)]"}`,children:e},e))})]})]}),(0,r.jsx)("main",{className:"flex-1 p-8",children:(0,r.jsx)("div",{className:"max-w-5xl mx-auto",children:(()=>{switch(i){case"documents":return s;case"highlight":return a;case"analysis":return o;case"generate":return l}})()})})]})]})}let c=[{key:"documents",label:"Documents"},{key:"highlight",label:"Highlights"},{key:"analysis",label:"Evidence Analysis"},{key:"generate",label:"Generate"}];function d({header:e,documents:s,highlight:a,analysis:o,generate:l}){let[n,i]=(0,t.useState)("documents");return(0,r.jsxs)("div",{className:"min-h-screen bg-[var(--color-background)]",children:[(0,r.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,r.jsx)("div",{className:"bg-[var(--color-surface)] border-b border-[var(--color-border)] sticky top-16 z-40",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-6",children:(0,r.jsx)("nav",{className:"flex gap-1",children:c.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>i(e.key),className:`relative px-6 py-4 text-sm font-medium transition-colors ${n===e.key?"text-[var(--color-primary)]":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${n===e.key?"bg-[var(--color-primary)] text-white":"bg-gray-100 text-[var(--color-text-secondary)]"}`,children:t+1}),e.label]}),n===e.key&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[var(--color-primary)]"})]},e.key))})})}),(0,r.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:(()=>{switch(n){case"documents":return s;case"highlight":return a;case"analysis":return o;case"generate":return l}})()})]})}let x=(e,r)=>{let t=e=>"pending"===e||"failed"===e||"partial"===e;return r.length>0?e.some(e=>r.includes(e.id)&&t(e.ocr_status)):e.some(e=>t(e.ocr_status))};function m({documents:e,selectedDocs:s,activeDocId:a,onSelectDoc:o,onViewDoc:l,onDeleteDoc:n,folders:i,ocrProgress:c,isOcrRunning:d,onStartOcr:m,onPauseOcr:h,onCancelOcr:u,onResumeOcr:p,onBatchDelete:g}){let[v,b]=(0,t.useState)(new Set(["A"])),f={};i.forEach(e=>{f[e]=[]}),e.forEach(e=>{let r=(e=>{if(!e)return"Other";let r=e.match(/^([A-Za-z0-9]+)-\d+$/i);return r?r[1].toUpperCase():"Other"})(e.exhibit_number);f[r]||(f[r]=[]),f[r].push(e)}),Object.keys(f).forEach(e=>{f[e].sort((e,r)=>parseInt(e.exhibit_number?.match(/-(\d+)$/)?.[1]||"0")-parseInt(r.exhibit_number?.match(/-(\d+)$/)?.[1]||"0"))});let y=Array.from(new Set([...i,...Object.keys(f)])).sort((e,r)=>"Other"===e?1:"Other"===r?-1:e.localeCompare(r));return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-[var(--color-surface)]",children:[(0,r.jsxs)("div",{className:"flex-shrink-0 p-3 border-b border-[var(--color-border)]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("span",{className:"text-xs font-medium text-[var(--color-text-secondary)]",children:[e.length," files",c&&` | ${c.completed} OCR done`]}),(0,r.jsx)("button",{onClick:m,disabled:d||!x(e,s),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors flex items-center gap-1.5 ${d||!x(e,s)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[var(--color-primary)] text-white hover:bg-[var(--color-primary-hover)]"}`,children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border border-white border-t-transparent"}),"OCR..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})}),s.length>0?`OCR Selected (${s.length})`:"Start OCR"]})})]}),d&&c&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-[var(--color-text-secondary)]",children:[(0,r.jsxs)("span",{children:[c.completed+c.failed,"/",c.total]}),(0,r.jsxs)("span",{children:[c.progress_percent,"%"]})]}),(0,r.jsx)("div",{className:"w-full h-1.5 bg-gray-100 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[var(--color-primary)] transition-all duration-300",style:{width:`${c.progress_percent}%`}})}),c.current_processing&&c.current_processing.total_pages>0&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-xs text-[var(--color-primary)] truncate flex-1",title:c.current_processing.file_name,children:[c.current_processing.file_name," (",c.current_processing.current_page,"/",c.current_processing.total_pages,")"]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:h,className:"p-1 text-[var(--color-warning)] hover:bg-yellow-50 rounded transition-colors",title:"Pause OCR",children:(0,r.jsx)("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})})}),(0,r.jsx)("button",{onClick:u,className:"p-1 text-[var(--color-error)] hover:bg-red-50 rounded transition-colors",title:"Cancel OCR",children:(0,r.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),s.length>0&&(0,r.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs text-[var(--color-primary)] font-medium",children:[s.length," selected"]}),(0,r.jsxs)("button",{onClick:g,className:"px-2 py-1 text-xs font-medium text-[var(--color-error)] hover:bg-red-50 rounded transition-colors flex items-center gap-1",children:[(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:y.map(e=>{let t=f[e]||[],i=v.has(e),c=t.filter(e=>"completed"===e.ocr_status).length;return(0,r.jsxs)("div",{className:"border-b border-[var(--color-border)] last:border-b-0",children:[(0,r.jsxs)("button",{onClick:()=>{b(r=>{let t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t})},className:"w-full px-3 py-2 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:`w-3 h-3 text-[var(--color-text-secondary)] transition-transform duration-200 ${i?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,r.jsx)("span",{className:"w-5 h-5 rounded bg-amber-100 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-3 h-3 text-amber-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})})}),(0,r.jsx)("span",{className:"text-sm font-medium text-[var(--color-text)]",children:e}),(0,r.jsxs)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["(",t.length,")"]})]}),t.length>0&&(0,r.jsx)("div",{className:"w-12 h-1 bg-gray-100 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[var(--color-success)]",style:{width:`${c/t.length*100}%`}})})]}),i&&(0,r.jsx)("div",{className:"bg-gray-50/50",children:0===t.length?(0,r.jsxs)("div",{className:"px-3 py-4 text-xs text-[var(--color-text-secondary)] text-center",children:["No files in folder ",e]}):t.map(e=>{let t;return(0,r.jsxs)("div",{onClick:()=>l(e.id),className:`px-3 py-2 flex items-center gap-2 cursor-pointer transition-colors border-l-2 ${a===e.id?"bg-blue-50 border-l-[var(--color-primary)]":"border-l-transparent hover:bg-gray-100"}`,children:[(0,r.jsx)("input",{type:"checkbox",checked:s.includes(e.id),onChange:r=>{r.stopPropagation(),o(e.id)},onClick:e=>e.stopPropagation(),className:"w-3.5 h-3.5 text-[var(--color-primary)] rounded border-gray-300 cursor-pointer flex-shrink-0"}),(0,r.jsx)("span",{className:"text-xs font-mono text-[var(--color-primary)] w-10 flex-shrink-0",children:e.exhibit_number||"-"}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsx)("div",{className:"text-xs text-[var(--color-text)] truncate",title:e.file_name,children:e.file_name})}),(0,r.jsx)("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${(e=>{switch(e){case"completed":return"bg-[var(--color-success)]";case"processing":return"bg-[var(--color-warning)]";case"queued":return"bg-blue-400";case"partial":return"bg-yellow-500";case"paused":return"bg-purple-500";case"cancelled":return"bg-gray-500";case"failed":return"bg-[var(--color-error)]";default:return"bg-gray-300"}})(e.ocr_status)}`,title:e.ocr_status}),("paused"===(t=e.ocr_status)||"partial"===t)&&(0,r.jsx)("button",{onClick:r=>{r.stopPropagation(),p(e.id)},className:"p-1 text-[var(--color-success)] hover:bg-green-50 rounded transition-colors flex-shrink-0",title:"Resume OCR",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,r.jsx)("button",{onClick:r=>{r.stopPropagation(),confirm(`Delete "${e.file_name}"?`)&&n(e.id)},className:"p-1 text-[var(--color-text-secondary)] hover:text-[var(--color-error)] rounded transition-colors flex-shrink-0",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id)})})]},e)})})]})}function h({document:e,onCopyText:s}){let[a,o]=(0,t.useState)("ocr"),l=async e=>{await navigator.clipboard.writeText(e),s()};return e?(0,r.jsxs)("div",{className:"h-full flex flex-col bg-[var(--color-surface)]",children:[(0,r.jsx)("div",{className:"flex-shrink-0 border-b border-[var(--color-border)]",children:(0,r.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)("span",{className:"text-sm font-mono text-[var(--color-primary)] flex-shrink-0",children:e.exhibit_number||"-"}),(0,r.jsx)("span",{className:"text-sm text-[var(--color-text)] truncate",title:e.file_name,children:e.file_name})]}),(0,r.jsx)("div",{className:"flex items-center gap-1 flex-shrink-0",children:(0,r.jsx)("button",{onClick:()=>o("ocr"),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${"ocr"===a?"bg-blue-100 text-[var(--color-primary)]":"text-[var(--color-text-secondary)] hover:bg-gray-100"}`,children:"OCR Text"})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex-shrink-0 px-4 py-2 bg-gray-50 border-b border-[var(--color-border)] flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-[var(--color-text-secondary)]",children:[(0,r.jsxs)("span",{children:["Pages: ",e.page_count||1]}),(0,r.jsxs)("span",{children:["~",Math.round((e.ocr_text?.length||0)/4)," tokens"]})]}),(0,r.jsx)("button",{onClick:()=>l(e.ocr_text||""),disabled:!e.ocr_text,className:"px-3 py-1 text-xs font-medium text-[var(--color-primary)] hover:bg-blue-50 rounded transition-colors disabled:text-gray-400 disabled:hover:bg-transparent",children:"Copy All"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:"completed"===e.ocr_status&&e.ocr_text?(0,r.jsx)("pre",{className:"text-sm text-[var(--color-text)] whitespace-pre-wrap font-mono leading-relaxed",children:e.ocr_text}):"processing"===e.ocr_status?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-[var(--color-primary)] border-t-transparent mx-auto mb-3"}),(0,r.jsx)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:"OCR in progress..."})]})}):"failed"===e.ocr_status?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-[var(--color-error)]",children:[(0,r.jsx)("svg",{className:"w-10 h-10 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("p",{className:"text-sm",children:"OCR failed"})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-[var(--color-text-secondary)]",children:[(0,r.jsx)("svg",{className:"w-10 h-10 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("p",{className:"text-sm",children:"OCR not started"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:'Click "Start OCR" to process'})]})})})]})})]}):(0,r.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center text-[var(--color-text-secondary)]",children:[(0,r.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("p",{className:"text-sm",children:"Select a document to preview"})]})})}function u({projectId:e,folders:s,selectedFolder:a,onFolderSelect:o,onAddFolder:l,onUploadComplete:n,onError:i,onSuccess:c,disabled:d=!1}){let[x,m]=(0,t.useState)(!1),[h,u]=(0,t.useState)(!1),[p,g]=(0,t.useState)(null),v=(0,t.useRef)(null),b=()=>{for(let e of"ABCDEFGHIJKLMNOPQRSTUVWXYZ")if(!s.includes(e))return e;let e=1;for(;s.includes(`F${e}`);)e++;return`F${e}`},f=(0,t.useCallback)(e=>{e.preventDefault(),d||m(!0)},[d]),y=(0,t.useCallback)(e=>{e.preventDefault(),m(!1)},[]),j=async(r,t)=>{let s=new FormData;s.append("file",r),s.append("project_id",e),s.append("folder",t);let a=await fetch("https://exempt-upc-determine-adapted.trycloudflare.com/api/upload",{method:"POST",body:s});if(!a.ok)throw Error(`Upload failed: ${a.status}`);return a.json()},N=async e=>{if(d||h)return;let r=Array.from(e);if(0===r.length)return;u(!0),g({current:0,total:r.length});let t=0,s=0;for(let e=0;e<r.length;e++){let o=r[e];try{await j(o,a),t++}catch{s++}g({current:e+1,total:r.length})}u(!1),g(null),t>0&&(c(`Uploaded ${t} file${t>1?"s":""} to folder ${a}`),n()),s>0&&i(`Failed to upload ${s} file${s>1?"s":""}`)},w=(0,t.useCallback)(e=>{e.preventDefault(),m(!1),!d&&e.dataTransfer.files.length>0&&N(e.dataTransfer.files)},[d]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,r.jsx)("label",{className:"text-sm text-[var(--color-text-secondary)] font-medium",children:"Upload to folder:"}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[s.map(e=>(0,r.jsx)("button",{onClick:()=>o(e),disabled:d||h,className:`min-w-[40px] h-10 px-3 rounded-lg font-semibold text-sm transition-all ${a===e?"bg-[var(--color-primary)] text-white shadow-md":"bg-gray-100 text-[var(--color-text-secondary)] hover:bg-gray-200"} ${d||h?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e},e)),(0,r.jsx)("button",{onClick:()=>{let e=b();l(e),o(e)},disabled:d||h,className:"w-10 h-10 rounded-lg border-2 border-dashed border-[var(--color-border)] text-[var(--color-text-secondary)] hover:border-[var(--color-primary)] hover:text-[var(--color-primary)] transition-colors flex items-center justify-center",title:`Add folder ${b()}`,children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),(0,r.jsxs)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["Files will be auto-numbered (e.g., ",a,"-1, ",a,"-2...)"]})]}),(0,r.jsxs)("div",{onDragOver:f,onDragLeave:y,onDrop:w,onClick:()=>{!d&&v.current&&v.current.click()},className:`relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${x?"border-[var(--color-primary)] bg-blue-50":"border-[var(--color-border)] hover:border-[var(--color-primary)] hover:bg-gray-50"} ${d||h?"opacity-50 cursor-not-allowed":""}`,children:[(0,r.jsx)("input",{ref:v,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{e.target.files&&e.target.files.length>0&&N(e.target.files)},className:"hidden",disabled:d||h}),h?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-3 border-[var(--color-primary)] border-t-transparent mx-auto"}),(0,r.jsxs)("div",{className:"text-sm text-[var(--color-text)]",children:["Uploading ",p?.current," of ",p?.total,"..."]}),(0,r.jsx)("div",{className:"w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[var(--color-primary)] transition-all duration-300",style:{width:`${p?p.current/p.total*100:0}%`}})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-[var(--color-primary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,r.jsx)("div",{className:"text-sm text-[var(--color-text)] font-medium mb-1",children:"Drop files here or click to upload"}),(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)]",children:"PDF, JPG, PNG supported"})]})]})]})}let p=["A","B","C","D"],g="https://exempt-upc-determine-adapted.trycloudflare.com";function v({projectId:e,documents:s,selectedDocs:a,onSelectDoc:o,onRefresh:l,onError:n,onSuccess:i,loading:c=!1}){let[d,x]=(0,t.useState)(p),[v,b]=(0,t.useState)("A"),[f,y]=(0,t.useState)(null),[j,N]=(0,t.useState)(!1),[w,k]=(0,t.useState)(null),[C,_]=(0,t.useState)(320),[E,S]=(0,t.useState)(!1),L=(0,t.useRef)(null),$=(0,t.useRef)(null),O=(0,t.useMemo)(()=>s.find(e=>e.id===w)||null,[s,w]);(0,t.useEffect)(()=>{let r=localStorage.getItem(`folders_${e}`);if(r)try{let e=JSON.parse(r);Array.isArray(e)&&e.length>0&&(x(e),e.includes(v)||b(e[0]))}catch{}},[e]);let M=async e=>{try{if(!(await fetch(`${g}/api/document/${e}`,{method:"DELETE"})).ok)throw Error("Delete failed");i("File deleted"),w===e&&k(null),l()}catch{n("Failed to delete file")}},I=async()=>{if(0!==a.length&&confirm(`Delete ${a.length} selected files?`))try{let r=await fetch(`${g}/api/document/batch/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error("Batch delete failed");let t=await r.json();i(`Deleted ${t.deleted_count} files`),w&&a.includes(w)&&k(null),l()}catch{n("Batch delete failed")}},A=(0,t.useCallback)(async()=>{try{let r=await fetch(`${g}/api/ocr/progress/${e}`);if(r.ok){let e=await r.json();y(e),e.processing>0&&!j&&N(!0),j&&0===e.processing&&(N(!1),l(),e.failed>0?i(`OCR complete: ${e.completed} done, ${e.failed} failed`):e.completed>0&&i(`OCR complete: ${e.completed} files processed`))}}catch{}},[e,j,l,i]);(0,t.useEffect)(()=>(j?$.current=setInterval(()=>{A()},5e3):$.current&&(clearInterval($.current),$.current=null),()=>{$.current&&clearInterval($.current)}),[j,A]),(0,t.useEffect)(()=>{A()},[e]);let P=async()=>{try{let e=a.length>0?a:s.filter(e=>"pending"===e.ocr_status).map(e=>e.id);if(0===e.length)return void i("No files to process");let r=0,t=0;for(let s of e)try{(await fetch(`${g}/api/ocr/${s}`,{method:"POST"})).ok?r++:t++}catch{t++}r>0&&(N(!0),i(`Starting OCR for ${r} file(s)`),A(),l()),t>0&&n(`Failed to start OCR for ${t} file(s)`)}catch{n("Failed to start OCR")}},B=async()=>{if(!f?.current_processing?.document_id)return void n("No document currently processing");try{let e=await fetch(`${g}/api/ocr/pause/${f.current_processing.document_id}`,{method:"POST"}),r=await e.json();r.success?(i("Pause requested - will stop after current page"),A()):n(r.message||"Failed to pause OCR")}catch{n("Failed to pause OCR")}},F=async()=>{if(!f?.current_processing?.document_id)return void n("No document currently processing");if(confirm("Cancel OCR? Progress will be saved and can be resumed later."))try{let e=await fetch(`${g}/api/ocr/cancel/${f.current_processing.document_id}`,{method:"POST"}),r=await e.json();r.success?(i("Cancel requested - will stop after current page"),N(!1),A(),l()):n(r.message||"Failed to cancel OCR")}catch{n("Failed to cancel OCR")}},R=async e=>{try{let r=await fetch(`${g}/api/ocr/resume/${e}`,{method:"POST"}),t=await r.json();t.success?(N(!0),i(t.message),A(),l()):n(t.message||"Failed to resume OCR")}catch{n("Failed to resume OCR")}};return((0,t.useEffect)(()=>{let e=e=>{if(!E||!L.current)return;let r=L.current.getBoundingClientRect();_(Math.max(240,Math.min(e.clientX-r.left,.5*r.width)))},r=()=>{S(!1)};return E&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",r)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[E]),c)?(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-12 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-[var(--color-primary)] border-t-transparent"}),(0,r.jsx)("span",{className:"ml-3 text-[var(--color-text-secondary)]",children:"Loading documents..."})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-4",children:(0,r.jsx)(u,{projectId:e,folders:d,selectedFolder:v,onFolderSelect:b,onAddFolder:r=>{let t=[...d,r];x(t),localStorage.setItem(`folders_${e}`,JSON.stringify(t))},onUploadComplete:l,onError:n,onSuccess:i})}),(0,r.jsxs)("div",{ref:L,className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden flex",style:{height:"600px"},children:[(0,r.jsx)("div",{className:"flex-shrink-0 border-r border-[var(--color-border)] overflow-hidden",style:{width:C},children:(0,r.jsx)(m,{documents:s,selectedDocs:a,activeDocId:w,onSelectDoc:o,onViewDoc:k,onDeleteDoc:M,folders:d,ocrProgress:f,isOcrRunning:j,onStartOcr:P,onPauseOcr:B,onCancelOcr:F,onResumeOcr:R,onBatchDelete:I})}),(0,r.jsx)("div",{className:`w-1 flex-shrink-0 cursor-col-resize transition-colors ${E?"bg-[var(--color-primary)]":"bg-transparent hover:bg-blue-200"}`,onMouseDown:e=>{e.preventDefault(),S(!0)}}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsx)(h,{document:O,projectId:e,onCopyText:()=>i("Copied!")})})]})]})}let b={company_name:"bg-blue-100 border-blue-300 text-blue-800",person_name:"bg-green-100 border-green-300 text-green-800",date:"bg-purple-100 border-purple-300 text-purple-800",amount:"bg-yellow-100 border-yellow-300 text-yellow-800",address:"bg-orange-100 border-orange-300 text-orange-800",position:"bg-pink-100 border-pink-300 text-pink-800",key_fact:"bg-red-100 border-red-300 text-red-800",legal_term:"bg-indigo-100 border-indigo-300 text-indigo-800",signature:"bg-gray-100 border-gray-300 text-gray-800",other:"bg-gray-100 border-gray-300 text-gray-600"},f={high:"bg-[var(--color-error)] text-white",medium:"bg-[var(--color-warning)] text-white",low:"bg-gray-400 text-white"};function y({projectId:e,documents:o,onError:l,onSuccess:n}){var i,c;let d,[x,m]=(0,t.useState)([]),[h,u]=(0,t.useState)(null),[p,g]=(0,t.useState)(1),[v,y]=(0,t.useState)(1),[j,N]=(0,t.useState)([]),[w,k]=(0,t.useState)({}),[C,_]=(0,t.useState)(null),[E,S]=(0,t.useState)(!1),[L,$]=(0,t.useState)(!1),[O,M]=(0,t.useState)(null),I=(0,t.useRef)(null),A=(0,t.useRef)(null),P=(0,t.useCallback)(async()=>{if(e)try{let r,t=(await (r=e,a(`/api/highlight/progress/${r}`))).documents.filter(e=>"completed"===e.ocr_status);m(t),!h&&t.length>0&&u(t[0].id)}catch(e){console.error("Failed to load documents:",e)}},[e,h]);(0,t.useEffect)(()=>{P()},[P]);let B=(0,t.useCallback)(async()=>{if(h){S(!0);try{let e,r=await (e=h,a(`/api/highlight/by-page/${e}`));k(r.highlights_by_page),y(r.page_count||1),_(r.highlight_status);let t=[];Object.values(r.highlights_by_page).forEach(e=>{t.push(...e)}),N(t),g(1)}catch(e){console.error("Failed to load highlights:",e)}finally{S(!1)}}},[h]);(0,t.useEffect)(()=>{B()},[B]);let F=async()=>{if(h){$(!0);try{let e;await (e=h,a(`/api/highlight/${e}`,{method:"POST"}));let r=setInterval(async()=>{let e,t=await (e=h,a(`/api/highlight/status/${e}`));("completed"===t.highlight_status||"failed"===t.highlight_status)&&(clearInterval(r),$(!1),B(),P(),"completed"===t.highlight_status?n?.("Highlight analysis completed"):l?.("Highlight analysis failed"))},2e3)}catch(e){console.error("Failed to trigger analysis:",e),l?.("Failed to start highlight analysis"),$(!1)}}};(0,t.useEffect)(()=>{let e=I.current,r=A.current;if(!e||!r)return;let t=e.getContext("2d");if(!t)return;let s=()=>{e.width=r.naturalWidth,e.height=r.naturalHeight,t.clearRect(0,0,e.width,e.height),(w[p]||[]).forEach(r=>{if(!r.bbox||null===r.bbox.x1)return;let s=e.width/1e3,a=e.height/1e3,o=r.bbox.x1*s,l=r.bbox.y1*a,n=(r.bbox.x2-r.bbox.x1)*s,i=(r.bbox.y2-r.bbox.y1)*a;t.fillStyle="rgba(255, 255, 0, 0.3)",t.fillRect(o,l,n,i),O?.id===r.id?(t.strokeStyle="rgba(255, 165, 0, 0.9)",t.lineWidth=3):(t.strokeStyle="rgba(255, 200, 0, 0.6)",t.lineWidth=1),t.strokeRect(o,l,n,i)})};r.complete?s():r.onload=s},[p,w,O]);let R=x.filter(e=>"completed"===e.highlight_status).length;return 0===x.length?(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-8 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-[var(--color-text-secondary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-[var(--color-text)] mb-2",children:"No Documents Ready"}),(0,r.jsx)("p",{className:"text-[var(--color-text-secondary)]",children:"Complete OCR on documents first to analyze highlights."})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:[x.length," document",1!==x.length?"s":""," ready"]}),(0,r.jsx)("span",{className:"text-[var(--color-border)]",children:"|"}),(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:[R," analyzed"]}),j.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-[var(--color-border)]",children:"|"}),(0,r.jsxs)("span",{className:"px-2 py-1 bg-yellow-50 text-[var(--color-warning)] rounded text-xs font-medium",children:[j.length," highlight",1!==j.length?"s":""]})]})]}),(0,r.jsx)("button",{onClick:F,disabled:L||!h||"processing"===C,className:"px-4 py-2 text-sm bg-[var(--color-warning)] text-white rounded-lg font-medium hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:L?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Analyzing..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"Analyze Highlights"]})})]})}),(0,r.jsx)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden",style:{height:"600px"},children:(0,r.jsxs)("div",{className:"flex h-full",children:[(0,r.jsxs)("div",{className:"w-56 border-r overflow-y-auto bg-gray-50",children:[(0,r.jsx)("div",{className:"p-3 border-b bg-gray-100",children:(0,r.jsx)("h3",{className:"font-medium text-[var(--color-text-secondary)] text-sm",children:"Documents"})}),(0,r.jsx)("div",{className:"divide-y",children:x.map(e=>(0,r.jsxs)("button",{onClick:()=>u(e.id),className:`w-full text-left p-3 hover:bg-gray-100 transition ${h===e.id?"bg-blue-50 border-l-4 border-[var(--color-primary)]":""}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:`w-2 h-2 rounded-full ${"completed"===e.highlight_status?"bg-[var(--color-success)]":"processing"===e.highlight_status?"bg-[var(--color-warning)]":"failed"===e.highlight_status?"bg-[var(--color-error)]":"bg-gray-300"}`}),(0,r.jsx)("span",{className:"text-sm font-medium text-[var(--color-text-secondary)] truncate",children:e.exhibit_number||"N/A"})]}),(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)] truncate mt-1",children:e.file_name})]},e.id))})]}),(0,r.jsx)("div",{className:"flex-1 bg-gray-100 overflow-hidden flex flex-col",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-[var(--color-surface)] border-b p-2 flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(e=>Math.max(1,e-1)),disabled:p<=1,className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:"←"}),(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["Page ",p," / ",v]}),(0,r.jsx)("button",{onClick:()=>g(e=>Math.min(v,e+1)),disabled:p>=v,className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:"→"})]}),(0,r.jsx)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:C||"Not analyzed"})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto p-4 flex items-start justify-center",children:E?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("div",{className:"text-[var(--color-text-secondary)]",children:"Loading..."})}):(0,r.jsxs)("div",{className:"relative inline-block shadow-lg",children:[(0,r.jsx)("img",{ref:A,src:h?(i=h,c=p,d="?dpi="+150,`${s}/api/highlight/page/${i}/${c}/image${d}`):"",alt:`Page ${p}`,className:"max-w-full max-h-[500px] object-contain"}),(0,r.jsx)("canvas",{ref:I,className:"absolute top-0 left-0 pointer-events-none",style:{width:"100%",height:"100%"}})]})})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center text-[var(--color-text-secondary)]",children:"Select a document to view highlights"})}),(0,r.jsxs)("div",{className:"w-72 border-l overflow-y-auto",children:[(0,r.jsxs)("div",{className:"p-3 border-b bg-gray-50",children:[(0,r.jsx)("h3",{className:"font-medium text-[var(--color-text-secondary)] text-sm",children:"Highlights"}),(0,r.jsxs)("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:[j.length," item",1!==j.length?"s":""," found"]})]}),0===j.length&&!E&&"completed"!==C&&(0,r.jsx)("div",{className:"p-4 text-center text-[var(--color-text-secondary)] text-sm",children:'No highlights yet. Click "Analyze Highlights" to start.'}),(0,r.jsx)("div",{className:"divide-y",children:j.map((e,t)=>(0,r.jsx)("button",{onClick:()=>{M(e),e.page_number!==p&&g(e.page_number)},className:`w-full text-left p-3 hover:bg-gray-50 transition ${O?.id===e.id?"bg-yellow-50 border-l-4 border-[var(--color-warning)]":""}`,children:(0,r.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,r.jsxs)("span",{className:"text-xs font-medium text-gray-400",children:["#",t+1]}),(0,r.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded border ${b[e.category||"other"]}`,children:e.category_cn||e.category||"Other"}),e.importance&&(0,r.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${f[e.importance]}`,children:e.importance})]}),(0,r.jsx)("p",{className:"text-sm text-[var(--color-text)] line-clamp-2",children:e.text_content||"(No text)"}),e.reason&&(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1 line-clamp-1",children:e.reason}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Page ",e.page_number,e.bbox?" - Has BBox":" - No BBox"]})]})})},e.id))})]})]})})]})}let j=[{key:"qualifying_relationship",label:"Qualifying Corporate Relationship & Physical Premises"},{key:"qualifying_employment",label:"Qualifying Employment Abroad"},{key:"qualifying_capacity",label:"Qualifying Capacity (L-1A/L-1B)"},{key:"doing_business",label:"Doing Business / Active Operations"}],N={qualifying_relationship:{chinese:"合格的公司关系",english:"Qualifying Corporate Relationship"},qualifying_employment:{chinese:"海外合格任职",english:"Qualifying Employment Abroad"},qualifying_capacity:{chinese:"合格的职位性质",english:"Qualifying Capacity"},doing_business:{chinese:"持续运营",english:"Doing Business"}},w={qualifying_relationship:`You are a Senior Immigration Attorney. Write a persuasive two-paragraph legal argument for "QUALIFYING RELATIONSHIP BETWEEN FOREIGN PARENT COMPANY AND THE U.S. PETITIONER AND SUFFICIENT PHYSICAL PREMISES".

**Evidence:**
[EVIDENCE_PLACEHOLDER]

**Key Entities:**
Petitioner: [PETITIONER_NAME] | Foreign Entity: [FOREIGN_ENTITY_NAME] | Beneficiary: [BENEFICIARY_NAME]

**Instructions:**
- Paragraph 1: Prove the parent-subsidiary link (stock ownership, formation date, shareholder names)
- Paragraph 2: Prove sufficient physical premises (lease, address, rent payments)
- Citation Format: [Exhibit {exhibit_id}: {file_name}]
- Output: JSON with paragraph_text and citations_used array`,qualifying_employment:`You are a Senior Immigration Attorney. Write a comprehensive narrative for "BENEFICIARY'S QUALIFYING EMPLOYMENT ABROAD".

**Evidence:**
[EVIDENCE_PLACEHOLDER]

**Key Entities:**
Petitioner: [PETITIONER_NAME] | Foreign Entity: [FOREIGN_ENTITY_NAME] | Beneficiary: [BENEFICIARY_NAME]

**Instructions:**
- Section 1: Continuous employment (1+ year in past 3 years)
- Section 2: Executive duties in a, b, c, d format (Strategic, Operational, Financial, Representation)
- Section 3: Oversight of professional staff
- Citation Format: [Exhibit {exhibit_id}: {file_name}]
- Output: JSON with paragraph_text and citations_used array`,qualifying_capacity:`You are a Senior Immigration Attorney. Write a two-paragraph legal argument for "BENEFICIARY'S QUALIFYING CAPACITY - EXECUTIVE/MANAGERIAL ROLE".

**Evidence:**
[EVIDENCE_PLACEHOLDER]

**Key Entities:**
Petitioner: [PETITIONER_NAME] | Foreign Entity: [FOREIGN_ENTITY_NAME] | Beneficiary: [BENEFICIARY_NAME]

**Instructions:**
- Paragraph 1: Foreign position (title, subordinates, decision-making authority)
- Paragraph 2: Proposed U.S. position (duties, reporting structure)
- Citation Format: [Exhibit {exhibit_id}: {file_name}]
- Output: JSON with paragraph_text and citations_used array`,doing_business:`You are a Senior Immigration Attorney. Write a two-paragraph legal argument for "BOTH ENTITIES ARE ACTIVELY DOING BUSINESS".

**Evidence:**
[EVIDENCE_PLACEHOLDER]

**Key Entities:**
Petitioner: [PETITIONER_NAME] | Foreign Entity: [FOREIGN_ENTITY_NAME] | Beneficiary: [BENEFICIARY_NAME]

**Instructions:**
- Paragraph 1: U.S. Petitioner's active operations (bank statements, revenue, employees)
- Paragraph 2: Foreign Entity's active operations (registration, financials, employees)
- Citation Format: [Exhibit {exhibit_id}: {file_name}]
- Output: JSON with paragraph_text and citations_used array`};function k({quote:e,onView:s}){let[a,o]=(0,t.useState)(!1);return(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-[var(--color-border)] hover:border-blue-300 transition-colors cursor-pointer",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:s,children:[(0,r.jsxs)("div",{className:"text-sm text-[var(--color-text)] mb-3 line-clamp-3",children:['"',e.quote,'"']}),(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)] mb-3",children:e.relevance}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-[var(--color-primary)] text-xs font-medium rounded",children:e.source.exhibit_id}),e.page&&(0,r.jsxs)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["p.",e.page]})]}),a&&(0,r.jsx)("span",{className:"text-xs text-[var(--color-primary)]",children:"View in PDF"})]})]})}function C({standardKey:e,quotes:s,onViewQuote:a}){let[o,l]=(0,t.useState)(!0),n=N[e]||{chinese:e,english:e};return(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[(0,r.jsxs)("button",{onClick:()=>l(!o),className:"w-full px-5 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("svg",{className:`w-4 h-4 text-[var(--color-text-secondary)] transition-transform duration-200 ${o?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,r.jsx)("div",{className:`w-2 h-2 rounded-full ${s.length>=5?"bg-[var(--color-success)]":s.length>=2?"bg-[var(--color-warning)]":s.length>=1?"bg-blue-500":"bg-gray-300"}`}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-semibold text-[var(--color-text)]",children:n.english}),(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)]",children:n.chinese})]})]}),(0,r.jsxs)("span",{className:"px-3 py-1 text-sm font-medium bg-gray-100 text-[var(--color-text-secondary)] rounded-full",children:[s.length," quote",1!==s.length?"s":""]})]}),o&&(0,r.jsx)("div",{className:"p-5 border-t border-[var(--color-border)] space-y-3",children:s.length>0?s.map((e,t)=>(0,r.jsx)(k,{quote:e,onView:()=>a?.(e)},t)):(0,r.jsx)("div",{className:"text-center py-8 text-[var(--color-text-secondary)] text-sm",children:"No evidence found for this standard yet."})})]})}function _({quotesByStandard:e,onViewQuote:t}){let s=["qualifying_relationship","qualifying_employment","qualifying_capacity","doing_business"],a=Object.values(e).flat().length;return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,r.jsxs)("span",{className:"text-[var(--color-text)] font-medium",children:[a," Total Quotes"]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:s.map(t=>{let s=e[t]?.length||0;return(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:`w-2 h-2 rounded-full ${s>=5?"bg-[var(--color-success)]":s>=2?"bg-[var(--color-warning)]":s>=1?"bg-blue-500":"bg-gray-300"}`}),(0,r.jsx)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:s})]},t)})})]}),s.map(s=>(0,r.jsx)(C,{standardKey:s,quotes:e[s]||[],onViewQuote:t},s))]})}let E=["qualifying_relationship","qualifying_employment","qualifying_capacity","doing_business"],S={qualifying_relationship:"Relationship",qualifying_employment:"Employment",qualifying_capacity:"Capacity",doing_business:"Operations"};function L({quotesByStandard:e,documents:s,onViewQuote:a}){let[o,l]=(0,t.useState)(null),n=(0,t.useMemo)(()=>{let r=new Set;return Object.values(e).flat().forEach(e=>{r.add(e.source.exhibit_id)}),r},[e]),i=(0,t.useMemo)(()=>{let r={};return s.forEach(e=>{e.exhibit_number&&(r[e.exhibit_number]={},E.forEach(t=>{r[e.exhibit_number][t]=[]}))}),Object.entries(e).forEach(([e,t])=>{t.forEach(t=>{let s=t.source.exhibit_id;r[s]&&(r[s][e]=r[s][e]||[],r[s][e].push(t))})}),r},[e,s]),c=s.filter(e=>e.exhibit_number&&n.has(e.exhibit_number)),d=(0,t.useMemo)(()=>o&&i[o.docId]?.[o.standard]||[],[o,i]);return 0===s.length?(0,r.jsx)("div",{className:"text-center py-12 text-[var(--color-text-secondary)]",children:"No documents uploaded yet."}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b border-[var(--color-border)]",children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider w-32",children:"Document"}),E.map(e=>(0,r.jsxs)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider",children:[(0,r.jsx)("div",{children:S[e]}),(0,r.jsx)("div",{className:"text-[10px] font-normal normal-case text-gray-400",children:N[e]?.chinese})]},e)),(0,r.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider w-20",children:"Total"})]})}),(0,r.jsx)("tbody",{children:0===c.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-[var(--color-text-secondary)] text-sm",children:"No analysis results yet. Run analysis to see the matrix."})}):c.map(e=>{let t=e.exhibit_number,s=i[t]||{},a=E.reduce((e,r)=>e+(s[r]?.length||0),0);return(0,r.jsxs)("tr",{className:"border-b border-[var(--color-border)] hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"px-4 py-3",children:[(0,r.jsx)("div",{className:"font-mono text-sm text-[var(--color-primary)]",children:t}),(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)] truncate max-w-32",title:e.file_name,children:e.file_name})]}),E.map(e=>{let a=s[e]?.length||0,n=o?.docId===t&&o?.standard===e;return(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("button",{onClick:()=>a>0&&l({docId:t,standard:e}),disabled:0===a,className:`w-full py-2 px-3 rounded-lg text-sm font-medium transition-all ${a>=3?"bg-[var(--color-success)] text-white":2===a?"bg-emerald-300 text-emerald-900":1===a?"bg-emerald-100 text-emerald-700":"bg-gray-50 text-gray-400"} ${a>0?"cursor-pointer hover:ring-2 hover:ring-blue-400":"cursor-default"} ${n?"ring-2 ring-[var(--color-primary)]":""}`,children:a})},e)}),(0,r.jsx)("td",{className:"px-4 py-3 text-center",children:(0,r.jsx)("span",{className:"text-sm font-semibold text-[var(--color-text)]",children:a})})]},e.id)})}),c.length>0&&(0,r.jsx)("tfoot",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-t border-[var(--color-border)]",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-xs font-semibold text-[var(--color-text-secondary)] uppercase",children:"Total"}),E.map(t=>{let s=e[t]?.length||0;return(0,r.jsx)("td",{className:"px-4 py-3 text-center",children:(0,r.jsx)("span",{className:"text-sm font-semibold text-[var(--color-text)]",children:s})},t)}),(0,r.jsx)("td",{className:"px-4 py-3 text-center",children:(0,r.jsx)("span",{className:"text-sm font-bold text-[var(--color-primary)]",children:Object.values(e).flat().length})})]})})]})})}),o&&d.length>0&&(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-[var(--color-primary)] text-sm font-medium rounded",children:o.docId}),(0,r.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"/"}),(0,r.jsx)("span",{className:"text-sm font-medium text-[var(--color-text)]",children:N[o.standard]?.english||o.standard})]}),(0,r.jsx)("button",{onClick:()=>l(null),className:"text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"space-y-3",children:d.map((e,t)=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-[var(--color-border)] cursor-pointer hover:border-blue-300 transition-colors",onClick:()=>a?.(e),children:[(0,r.jsxs)("div",{className:"text-sm text-[var(--color-text)] mb-2",children:['"',e.quote,'"']}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:e.relevance}),e.page&&(0,r.jsxs)("span",{className:"text-xs text-[var(--color-primary)]",children:["Page ",e.page]})]})]},t))})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-xs text-[var(--color-text-secondary)]",children:[(0,r.jsx)("span",{children:"Legend:"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded bg-[var(--color-success)]"}),(0,r.jsx)("span",{children:"3+ quotes"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded bg-emerald-300"}),(0,r.jsx)("span",{children:"2 quotes"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded bg-emerald-100"}),(0,r.jsx)("span",{children:"1 quote"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded bg-gray-50 border border-gray-200"}),(0,r.jsx)("span",{children:"No quotes"})]})]})]})}function $({documents:e,selectedDocs:s,quotesByStandard:a,onRunAnalysis:o,isAnalyzing:l,onViewQuote:n}){let[i,c]=(0,t.useState)("standard"),d=Object.values(a).flat().length,x=e.filter(e=>"completed"===e.ocr_status),m=s.length>0||x.length>0;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg",children:[(0,r.jsx)("button",{onClick:()=>c("standard"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${"standard"===i?"bg-[var(--color-surface)] text-[var(--color-text)] shadow-sm":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,children:"By Standard"}),(0,r.jsx)("button",{onClick:()=>c("matrix"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${"matrix"===i?"bg-[var(--color-surface)] text-[var(--color-text)] shadow-sm":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,children:"Matrix View"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,r.jsxs)("span",{className:"text-[var(--color-text-secondary)]",children:[d," quote",1!==d?"s":""," found"]}),s.length>0&&(0,r.jsxs)("span",{className:"px-2 py-1 bg-blue-50 text-[var(--color-primary)] rounded text-xs font-medium",children:[s.length," doc",1!==s.length?"s":""," selected"]})]})]}),(0,r.jsx)("button",{onClick:()=>{o(s.length>0?s:x.map(e=>e.id))},disabled:!m||l,className:"px-5 py-2 bg-[var(--color-primary)] text-white rounded-lg font-medium hover:bg-[var(--color-primary-hover)] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Analyzing..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),s.length>0?`Analyze ${s.length} Selected`:"Analyze All"]})})]}),0===x.length&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:"Upload and OCR documents first to run analysis."})]}),"standard"===i?(0,r.jsx)(_,{quotesByStandard:a,onViewQuote:n}):(0,r.jsx)(L,{quotesByStandard:a,documents:e,onViewQuote:n}),0===d&&e.length>0&&x.length>0&&!l&&(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-12 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-[var(--color-text-secondary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-[var(--color-text)] mb-2",children:"No Analysis Yet"}),(0,r.jsx)("p",{className:"text-[var(--color-text-secondary)] mb-4",children:'Click "Analyze All" to extract L-1 evidence from your documents.'})]})]})}function O({projectId:e,quotesByStandard:s,beneficiaryName:o,petitionerName:l,foreignEntityName:n,onPetitionerChange:i,onForeignEntityChange:c,onEntitySave:d}){let[x,m]=(0,t.useState)("manual"),[h,u]=(0,t.useState)(j[0].key),[p,g]=(0,t.useState)({}),[v,b]=(0,t.useState)({}),[f,y]=(0,t.useState)(!0),[N,k]=(0,t.useState)(!1),[C,_]=(0,t.useState)(!1),[E,S]=(0,t.useState)(""),[L,$]=(0,t.useState)(null),[O,M]=(0,t.useState)(!1),I=p[h]||[],A=v[h]||null,P=I.find(e=>e.id===A),B=Object.values(s).flat(),F=B.length;(0,t.useEffect)(()=>{R()},[e]);let R=async()=>{try{let r;y(!0);let t=await (r=e,a(`/api/l1-writing/${r}`));if(t?.sections){let e={},r={};for(let[s,a]of Object.entries(t.sections)){let t={id:a.version_id||`saved-${s}`,version:1,text:a.text,citations:a.citations||[],created_at:a.timestamp||new Date().toISOString()};e[s]=[t],r[s]=t.id}g(e),b(r)}}catch{console.log("No saved writing yet")}finally{y(!1)}},T=(0,t.useCallback)(()=>{var e;let r=JSON.stringify(B.map(e=>({quote:e.quote,relevance:e.relevance,l1_standard:e.standard_en||e.standard||"unknown",source:{exhibit_id:e.source.exhibit_id,file_name:e.source.file_name}})),null,2);return e={petitionerName:l,foreignEntityName:n,beneficiaryName:o},(w[h]||w.qualifying_relationship).replace("[EVIDENCE_PLACEHOLDER]",r).replace("[PETITIONER_NAME]",e.petitionerName||"[Petitioner]").replace("[FOREIGN_ENTITY_NAME]",e.foreignEntityName||"[Foreign Entity]").replace("[BENEFICIARY_NAME]",e.beneficiaryName||"[Beneficiary]")},[h,o,l,n,B]),D=async e=>{await navigator.clipboard.writeText(e),M(!0),setTimeout(()=>M(!1),2e3)},z=e=>{g(r=>({...r,[h]:[...r[h]||[],e]})),b(r=>({...r,[h]:e.id}))},q=async()=>{if(E.trim()&&!L&&!C)try{let r,t,s,o;_(!0);let l=JSON.parse(E);if((await (r=e,t=h,s=l.paragraph_text,o=l.citations_used||[],a(`/api/l1-write-manual/${r}`,{method:"POST",body:JSON.stringify({section_type:t,paragraph_text:s,citations_used:o})}))).success){let e={id:`v${Date.now()}`,version:I.length+1,text:l.paragraph_text,citations:l.citations_used||[],created_at:new Date().toISOString()};z(e),S("")}}catch(e){$(`Failed to save: ${e.message}`)}finally{_(!1)}},W=async()=>{try{let r,t,s;k(!0);let l=await (r=e,t=h,s=o||void 0,a(`/api/l1-write/${r}?section_type=${t}${s?`&beneficiary_name=${encodeURIComponent(s)}`:""}`,{method:"POST"}));if(l.success){let e={id:`v${Date.now()}`,version:I.length+1,text:l.paragraph.text,citations:l.paragraph.citations,created_at:new Date().toISOString()};z(e)}}catch(e){console.error("Generate failed:",e)}finally{k(!1)}};return f?(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-12 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-[var(--color-primary)] border-t-transparent"}),(0,r.jsx)("span",{className:"ml-3 text-[var(--color-text-secondary)]",children:"Loading..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-5 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("label",{className:"text-sm text-[var(--color-text-secondary)] font-medium",children:"Section:"}),(0,r.jsx)("select",{value:h,onChange:e=>u(e.target.value),className:"flex-1 max-w-md px-3 py-2 text-sm border border-[var(--color-border)] rounded-lg text-[var(--color-text)] bg-[var(--color-surface)] focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent",children:j.map(e=>(0,r.jsx)("option",{value:e.key,children:e.label},e.key))}),(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:[F," quotes available"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Petitioner (US):"}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),onBlur:d,placeholder:"e.g., ABC Corp.",className:"w-40 px-3 py-1.5 text-sm border border-[var(--color-border)] rounded-lg text-[var(--color-text)] bg-[var(--color-surface)] placeholder:text-gray-400 focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Foreign Entity:"}),(0,r.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),onBlur:d,placeholder:"e.g., XYZ Ltd.",className:"w-40 px-3 py-1.5 text-sm border border-[var(--color-border)] rounded-lg text-[var(--color-text)] bg-[var(--color-surface)] placeholder:text-gray-400 focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent"})]}),o&&(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["Beneficiary: ",(0,r.jsx)("strong",{className:"text-[var(--color-text)]",children:o})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg w-fit",children:[(0,r.jsx)("button",{onClick:()=>m("manual"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"manual"===x?"bg-[var(--color-surface)] text-[var(--color-text)] shadow-sm":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,children:"Manual (Copy & Paste)"}),(0,r.jsx)("button",{onClick:()=>m("auto"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"auto"===x?"bg-[var(--color-surface)] text-[var(--color-text)] shadow-sm":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,children:"Auto Generate"})]}),"manual"===x&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border-2 border-[var(--color-success)] p-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-[var(--color-text)] mb-1",children:"Step 1: Copy to LLM"}),(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:['Copy prompt + evidence for "',j.find(e=>e.key===h)?.label,'". Paste into ChatGPT/Claude.']})]}),(0,r.jsx)("button",{onClick:()=>D(T()),disabled:0===F,className:"px-5 py-2.5 bg-[var(--color-success)] text-white rounded-lg font-medium hover:bg-emerald-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:O?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Prompt"]})})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-xs text-[var(--color-text-secondary)]",children:[(0,r.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded",children:[F," quotes"]}),(0,r.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded",children:["~",Math.round(T().length/4)," tokens"]})]})]}),(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-5 py-3 bg-gray-50 border-b border-[var(--color-border)] flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-semibold text-[var(--color-text)]",children:"Step 2: Paste LLM Result"}),L?(0,r.jsx)("span",{className:"text-sm text-[var(--color-error)]",children:L}):E.trim()?(0,r.jsx)("span",{className:"text-sm text-[var(--color-success)]",children:"Valid JSON"}):null]}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsx)("textarea",{value:E,onChange:e=>{var r;S(r=e.target.value),(e=>{if(!e.trim())return $(null);try{let r=JSON.parse(e);r.paragraph_text&&r.citations_used?$(null):$("Invalid format: expected { paragraph_text, citations_used }")}catch(e){$(`JSON Parse Error: ${e.message}`)}})(r)},placeholder:`Paste the JSON result from LLM here...

{
  "paragraph_text": "...",
  "citations_used": [...]
}`,className:"w-full h-40 p-4 text-sm font-mono border border-[var(--color-border)] rounded-lg resize-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent text-[var(--color-text)] placeholder:text-gray-400"}),(0,r.jsx)("div",{className:"flex justify-end mt-4",children:(0,r.jsx)("button",{onClick:q,disabled:!E.trim()||!!L||C,className:"px-5 py-2 bg-[var(--color-primary)] text-white rounded-lg font-medium hover:bg-[var(--color-primary-hover)] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Saving..."]}):"Save Paragraph"})})]})]})]}),"auto"===x&&(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-5",children:[(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)] mb-4",children:["Automatically generate paragraph using LLM API. The AI will select relevant quotes from all ",F," available quotes."]}),(0,r.jsx)("button",{onClick:W,disabled:N||0===F,className:"px-5 py-2.5 bg-[var(--color-primary)] text-white rounded-lg font-medium hover:bg-[var(--color-primary-hover)] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Generating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Generate Paragraph"]})})]}),P&&(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-5 py-3 bg-gray-50 border-b border-[var(--color-border)] flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"font-semibold text-[var(--color-text)]",children:"Generated Paragraph"}),(0,r.jsxs)("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded",children:["v",P.version]})]}),(0,r.jsxs)("button",{onClick:async()=>{await navigator.clipboard.writeText(P.text)},className:"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] flex items-center gap-1",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})]}),(0,r.jsx)("div",{className:"p-5",children:(0,r.jsx)("div",{className:"text-sm text-[var(--color-text)] leading-relaxed whitespace-pre-wrap",children:(e=>{let t,s=/\[Exhibit ([A-Z]-\d+)(?::\s*([^\]]+))?\]/g,a=[],o=0;for(;null!==(t=s.exec(e));){t.index>o&&a.push(e.slice(o,t.index));let s=t[1],l=t[2],n=P?.citations.find(e=>e.exhibit===s);a.push((0,r.jsxs)("span",{className:"relative group inline-block",children:[(0,r.jsxs)("span",{className:"text-[var(--color-primary)] cursor-pointer hover:bg-blue-50 px-0.5 rounded font-medium",children:["[Exhibit ",s,l?`: ${l}`:"","]"]}),n&&(0,r.jsxs)("div",{className:"absolute z-50 bottom-full left-0 mb-2 w-72 bg-[var(--color-surface)] rounded-xl shadow-xl border border-[var(--color-border)] p-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute -bottom-2 left-4 w-4 h-4 bg-[var(--color-surface)] border-r border-b border-[var(--color-border)] transform rotate-45"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"font-medium text-sm text-[var(--color-text)] mb-1",children:["Exhibit ",s]}),(0,r.jsx)("div",{className:"text-xs text-[var(--color-text-secondary)] mb-2",children:n.file_name}),(0,r.jsxs)("div",{className:"text-xs text-[var(--color-text)] italic line-clamp-3",children:['"',n.quote,'"']})]})]})]},t.index)),o=t.index+t[0].length}return o<e.length&&a.push(e.slice(o)),a})(P.text)})}),P.citations.length>0&&(0,r.jsxs)("div",{className:"px-5 py-4 bg-gray-50 border-t border-[var(--color-border)]",children:[(0,r.jsxs)("h4",{className:"text-xs font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider mb-3",children:["Citations (",P.citations.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:P.citations.map((e,t)=>(0,r.jsxs)("div",{className:"text-xs bg-[var(--color-surface)] rounded-lg p-3 border border-[var(--color-border)]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"font-mono text-[var(--color-primary)]",children:["[Exhibit ",e.exhibit,"]"]}),(0,r.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:e.file_name})]}),(0,r.jsxs)("div",{className:"text-[var(--color-text-secondary)] italic line-clamp-2",children:['"',e.quote,'"']})]},t))})]})]}),!P&&(0,r.jsxs)("div",{className:"bg-[var(--color-surface)] rounded-xl border border-[var(--color-border)] p-12 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-[var(--color-text-secondary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-[var(--color-text)] mb-2",children:"No Paragraph Yet"}),(0,r.jsx)("p",{className:"text-[var(--color-text-secondary)]",children:"Use Manual mode to copy prompt to ChatGPT, or Auto mode to generate directly."})]})]})}function M({message:e,type:s,duration:a=3e3,onClose:o}){let[l,n]=(0,t.useState)(!0);(0,t.useEffect)(()=>{let e=setTimeout(()=>{n(!1),setTimeout(o,300)},a);return()=>clearTimeout(e)},[a,o]);let i={success:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),error:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),info:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),warning:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})};return(0,r.jsxs)("div",{className:`fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-3 text-white rounded-lg shadow-lg transition-all duration-300 ${{success:"bg-[var(--color-success)]",error:"bg-[var(--color-error)]",info:"bg-[var(--color-primary)]",warning:"bg-[var(--color-warning)]"}[s]} ${l?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:[i[s],(0,r.jsx)("span",{children:e}),(0,r.jsx)("button",{onClick:()=>{n(!1),setTimeout(o,300)},className:"ml-2 p-1 hover:bg-white/20 rounded",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function I({toasts:e,removeToast:t}){return(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:e.map(e=>(0,r.jsx)(M,{message:e.message,type:e.type,onClose:()=>t(e.id)},e.id))})}let A=[{key:"pipeline",label:"Pipeline",icon:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})},{key:"sidebar",label:"Sidebar",icon:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h7"})})},{key:"tabs",label:"Tabs",icon:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z"})})}];function P({current:e,onChange:t}){return(0,r.jsx)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg",children:A.map(s=>(0,r.jsxs)("button",{onClick:()=>t(s.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${e===s.key?"bg-[var(--color-surface)] text-[var(--color-text)] shadow-sm":"text-[var(--color-text-secondary)] hover:text-[var(--color-text)]"}`,title:s.label,children:[s.icon,(0,r.jsx)("span",{className:"hidden sm:inline",children:s.label})]},s.key))})}function B({projectName:e,projectId:t,beneficiaryName:s,onBeneficiaryChange:a,onBeneficiarySave:o,isSaving:l=!1,layoutMode:n,onLayoutChange:i,onBack:c}){return(0,r.jsx)("header",{className:"bg-[var(--color-surface)] border-b border-[var(--color-border)] h-16",children:(0,r.jsxs)("div",{className:"h-full max-w-7xl mx-auto px-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[c&&(0,r.jsx)("button",{onClick:c,className:"p-2 text-[var(--color-text-secondary)] hover:text-[var(--color-text)] hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Projects",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-semibold text-[var(--color-text)]",children:e}),(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)]",children:"L-1 Evidence Builder"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Beneficiary:"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:s,onChange:e=>a(e.target.value),onBlur:o,onKeyDown:e=>"Enter"===e.key&&o(),placeholder:"Enter name",className:"w-48 px-3 py-1.5 text-sm border border-[var(--color-border)] rounded-lg text-[var(--color-text)] bg-[var(--color-surface)] placeholder:text-gray-400 focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent transition-all"}),l&&(0,r.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-[var(--color-primary)] border-t-transparent"})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(P,{current:n,onChange:i}),(0,r.jsx)("span",{className:"text-xs text-[var(--color-text-secondary)] font-mono bg-gray-50 px-2 py-1 rounded",children:t.slice(0,8)})]})]})})}let F=()=>(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),R=()=>(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),T=()=>(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),D=()=>(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})});function z(){let{toasts:e,addToast:s,removeToast:n}=function(){let[e,r]=(0,t.useState)([]);return{toasts:e,addToast:(e,t="info")=>{let s=Date.now().toString();r(r=>[...r,{id:s,message:e,type:t}])},removeToast:e=>{r(r=>r.filter(r=>r.id!==e))}}}(),[c,x]=(0,t.useState)(!1),[m,h]=(0,t.useState)([]),[u,p]=(0,t.useState)(null),[g,b]=(0,t.useState)(!0),[f,j]=(0,t.useState)(!1),[N,w]=(0,t.useState)(""),[k,C]=(0,t.useState)(""),[_,E]=(0,t.useState)(""),[S,L]=(0,t.useState)(!1),[M,A]=(0,t.useState)([]),[P,z]=(0,t.useState)([]),[q,W]=(0,t.useState)(!1),[H,V]=(0,t.useState)({}),[Y,G]=(0,t.useState)(!1),[U,J]=(0,t.useState)("pipeline"),[Q,K]=(0,t.useState)("checking");(0,t.useEffect)(()=>{Z(),X()},[]),(0,t.useEffect)(()=>{u&&(er(),et(),w(u.beneficiaryName||""),C(u.petitionerName||""),E(u.foreignEntityName||""))},[u]);let X=async()=>{try{let e=await fetch("https://exempt-upc-determine-adapted.trycloudflare.com/");K(e.ok?"online":"offline")}catch{K("offline")}},Z=async()=>{try{b(!0);let e=await a("/api/projects");h(e||[]),e&&e.length>0&&!u&&p(e[0])}catch(e){console.error("Failed to load projects:",e),s("Failed to load projects","error")}finally{b(!1)}},ee=async()=>{try{let e;j(!0);let r=await (e=`Project ${m.length+1}`,a("/api/projects",{method:"POST",body:JSON.stringify({name:e})}));h(e=>[r,...e]),p(r),A([]),z([]),V({}),w(""),C(""),E(""),s("Project created","success")}catch(e){console.error("Failed to create project:",e),s("Failed to create project","error")}finally{j(!1)}},er=async()=>{if(u)try{let e;W(!0);let r=await (e=u.id,a(`/api/documents/${e}`));A(r.documents||[])}catch(e){console.error("Failed to load documents:",e),s("Failed to load documents","error")}finally{W(!1)}},et=async()=>{if(u)try{let e,r=await (e=u.id,a(`/api/l1-summary/${e}`));r?.by_standard&&V(r.by_standard)}catch{}},es=async()=>{if(u&&N.trim())try{L(!0),await o(u.id,{beneficiaryName:N.trim()}),s("Beneficiary name saved","success")}catch(e){console.error("Failed to save beneficiary name:",e),s("Failed to save","error")}finally{L(!1)}},ea=async()=>{if(u)try{await o(u.id,{petitionerName:k||void 0,foreignEntityName:_||void 0})}catch(e){console.error("Failed to save entity names:",e)}},eo=async e=>{if(u)try{var r,t;let o,l;G(!0);let n=await (r=u.id,o=(t=e)&&t.length>0?`?doc_ids=${t.join(",")}`:"",a(`/api/l1-analyze/${r}${o}`,{method:"POST"}));n.success&&(await (l=u.id,a(`/api/l1-summary/${l}`,{method:"POST"})),await et(),s(`Found ${n.total_quotes_found} quotes`,"success"))}catch(e){console.error("Analysis failed:",e),s("Analysis failed","error")}finally{G(!1)}},el=(0,t.useCallback)(e=>{s(`Viewing: "${e.quote.slice(0,50)}..."`,"info")},[s]),en=u?(0,r.jsx)(v,{projectId:u.id,documents:M,selectedDocs:P,onSelectDoc:e=>{z(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},onSelectAll:()=>{P.length===M.length?z([]):z(M.map(e=>e.id))},onRefresh:er,onError:e=>s(e,"error"),onSuccess:e=>s(e,"success"),loading:q}):null,ei=u?(0,r.jsx)(y,{projectId:u.id,documents:M,onError:e=>s(e,"error"),onSuccess:e=>s(e,"success")}):null,ec=u?(0,r.jsx)($,{projectId:u.id,documents:M,selectedDocs:P,quotesByStandard:H,onRunAnalysis:eo,isAnalyzing:Y,onViewQuote:el}):null,ed=u?(0,r.jsx)(O,{projectId:u.id,quotesByStandard:H,beneficiaryName:N,petitionerName:k,foreignEntityName:_,onPetitionerChange:C,onForeignEntityChange:E,onEntitySave:ea,onViewQuote:el}):null,ex=u?(0,r.jsx)(B,{projectName:u.name,projectId:u.id,beneficiaryName:N,onBeneficiaryChange:w,onBeneficiarySave:es,isSaving:S,layoutMode:U,onLayoutChange:J,onBack:()=>p(null)}):null;return(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden bg-[var(--color-background)]",children:[(0,r.jsxs)("aside",{className:`bg-[var(--color-surface)] border-r border-[var(--color-border)] flex flex-col transition-all duration-300 ${c?"w-16":"w-72"}`,children:[(0,r.jsxs)("div",{className:"h-16 flex items-center justify-between px-4 border-b border-[var(--color-border)]",children:[!c&&(0,r.jsx)("h1",{className:"font-semibold text-[var(--color-text)] truncate",children:"ImmigrationCraft"}),(0,r.jsx)("button",{onClick:()=>x(!c),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors text-[var(--color-text-secondary)]",children:c?(0,r.jsx)(D,{}):(0,r.jsx)(T,{})})]}),(0,r.jsx)("div",{className:"p-3",children:(0,r.jsxs)("button",{onClick:ee,disabled:f,className:`w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary-hover)] transition-colors disabled:opacity-50 ${c?"px-2":""}`,children:[(0,r.jsx)(R,{}),!c&&(0,r.jsx)("span",{children:"New Project"})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:g?(0,r.jsx)("div",{className:"space-y-2",children:[1,2,3].map(e=>(0,r.jsx)("div",{className:"h-12 bg-gray-100 animate-pulse rounded-lg"},e))}):0===m.length?!c&&(0,r.jsx)("p",{className:"text-sm text-[var(--color-text-secondary)] text-center py-4",children:"No projects yet"}):(0,r.jsx)("div",{className:"space-y-1",children:m.map(e=>(0,r.jsxs)("button",{onClick:()=>p(e),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left ${u?.id===e.id?"bg-blue-50 text-[var(--color-primary)]":"hover:bg-gray-50 text-[var(--color-text)]"}`,children:[(0,r.jsx)(F,{}),!c&&(0,r.jsx)("span",{className:"truncate text-sm font-medium",children:e.name})]},e.id))})}),(0,r.jsx)("div",{className:"p-3 border-t border-[var(--color-border)]",children:(0,r.jsxs)("div",{className:`flex items-center gap-2 ${c?"justify-center":""}`,children:[(0,r.jsx)("span",{className:`w-2 h-2 rounded-full ${"online"===Q?"bg-[var(--color-success)]":"offline"===Q?"bg-[var(--color-error)]":"bg-[var(--color-warning)] animate-pulse"}`}),!c&&(0,r.jsx)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:"online"===Q?"Connected":"offline"===Q?"Disconnected":"Checking..."})]})})]}),(0,r.jsx)("main",{className:"flex-1 flex flex-col overflow-hidden",children:u?(()=>{if(!u)return null;let e={header:ex,documents:en,highlight:ei,analysis:ec,generate:ed};switch(U){case"sidebar":return(0,r.jsx)(i,{...e});case"tabs":return(0,r.jsx)(d,{...e});default:return(0,r.jsx)(l,{...e})}})():(0,r.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center text-[var(--color-primary)] mx-auto mb-4",children:(0,r.jsx)(F,{})}),(0,r.jsx)("p",{className:"text-lg font-medium text-[var(--color-text)]",children:"No Project Selected"}),(0,r.jsx)("p",{className:"text-[var(--color-text-secondary)] mt-2",children:"Create or select a project to get started"}),(0,r.jsx)("button",{onClick:ee,disabled:f,className:"mt-4 px-6 py-3 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary-hover)] transition-colors disabled:opacity-50",children:f?"Creating...":"Create New Project"})]})})}),(0,r.jsx)(I,{toasts:e,removeToast:n})]})}e.s(["default",()=>z],52683)}]);
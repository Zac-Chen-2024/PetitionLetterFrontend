(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";e.i(47167);var t=e.i(43476),s=e.i(71645);let r="https://petigen.zacchen.win";async function a(e,t){let s=`${r}${e}`,a=await fetch(s,{...t,headers:{"Content-Type":"application/json",...t?.headers}});if(!a.ok)throw Error(await a.text()||`API error: ${a.status}`);return a.json()}let l=async(e,t,s,a,l,n)=>{let i=await fetch(`${r}/api/upload/init`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:e,file_name:t,file_size:s,total_chunks:a,exhibit_number:l||null,exhibit_title:n||null})});if(!i.ok)throw Error(`Init upload failed: ${i.status}`);return i.json()},n=async(e,t,s)=>{let a=new FormData;a.append("chunk",s);let l=await fetch(`${r}/api/upload/chunk/${e}/${t}`,{method:"POST",body:a});if(!l.ok)throw Error(`Chunk upload failed: ${l.status}`);return l.json()},i=async e=>{let t=await fetch(`${r}/api/upload/complete/${e}`,{method:"POST"});if(!t.ok)throw Error(`Complete upload failed: ${t.status}`);return t.json()},o=async e=>{await fetch(`${r}/api/upload/cancel/${e}`,{method:"DELETE"})};async function d(e,t,s,r,a){let d=Math.ceil(t.size/5242880),{upload_id:c}=await l(e,t.name,t.size,d,s,r);try{for(let e=0;e<d;e++){let s=5242880*e,r=Math.min(s+5242880,t.size),l=t.slice(s,r);await n(c,e,l);let i=Math.round((e+1)/d*100);a?.(i)}return await i(c)}catch(e){try{await o(c)}catch{}throw e}}let c=e=>a(`/api/l1-summary/${e}`),x=(e,t)=>{let s=t?`?page=${t}`:"";return a(`/api/highlight/${e}${s}`)},u=e=>a(`/api/highlight/progress/${e}`);function m(e){let{fetcher:t,shouldContinue:r,interval:a=2e3,errorRetryInterval:l=5e3,maxErrorCount:n=3,maxDuration:i,enabled:o=!1,onSuccess:d,onError:c,onTimeout:x,onMaxErrors:u}=e,[m,h]=(0,s.useState)(null),[p,g]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),[b,y]=(0,s.useState)(0),N=(0,s.useRef)(!1),v=(0,s.useRef)(0),w=(0,s.useRef)(null),k=(0,s.useRef)(null),C=(0,s.useRef)(null),L=(0,s.useRef)(!0),$=(0,s.useRef)(d),S=(0,s.useRef)(c),M=(0,s.useRef)(x),E=(0,s.useRef)(u),_=(0,s.useRef)(t),B=(0,s.useRef)(r);(0,s.useEffect)(()=>{$.current=d,S.current=c,M.current=x,E.current=u,_.current=t,B.current=r},[d,c,x,u,t,r]);let W=(0,s.useCallback)(()=>{w.current&&(clearTimeout(w.current),w.current=null),k.current&&(clearTimeout(k.current),k.current=null)},[]),R=(0,s.useCallback)(()=>{N.current=!1,f(!1),W(),C.current=null},[W]),O=(0,s.useCallback)(()=>{R(),h(null),g(null),y(0),v.current=0},[R]),z=(0,s.useCallback)(async()=>{if(N.current&&L.current)try{let e=await _.current();if(!L.current)return;v.current=0,y(0),g(null),h(e),$.current?.(e),B.current(e)&&N.current?w.current=setTimeout(z,a):R()}catch(s){if(!L.current)return;let e=s instanceof Error?s:Error(String(s));g(e),v.current+=1;let t=v.current;y(t),S.current?.(e),t>=n?(E.current?.(),R()):N.current&&(w.current=setTimeout(z,l))}},[a,l,n,R]),F=(0,s.useCallback)(()=>{N.current||(v.current=0,y(0),g(null),N.current=!0,f(!0),C.current=Date.now(),i&&(k.current=setTimeout(()=>{L.current&&N.current&&(M.current?.(),R())},i)),z())},[z,i,R]);return(0,s.useEffect)(()=>{o&&F()},[o]),(0,s.useEffect)(()=>(L.current=!0,()=>{L.current=!1,W()}),[W]),{data:m,error:p,isPolling:j,errorCount:b,start:F,stop:R,reset:O}}let h=["A","B","C","D","E","F","G","H"],p=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),g=()=>(0,t.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),j=()=>(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),f=()=>(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})}),b=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),y=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})});function N({projectId:e,documents:r,onUploadComplete:a,onError:l,onSuccess:n}){let[i,o]=(0,s.useState)([]),[c,x]=(0,s.useState)(!1),[u,m]=(0,s.useState)("A"),[N,v]=(0,s.useState)(!1),w=(0,s.useRef)(null),k=(0,s.useMemo)(()=>r.map(e=>{let t=e.exhibit_number||"N/A",s=t.split("-")[0]||"A";return{id:e.id,fileName:e.file_name,exhibitNumber:t,exhibitFolder:s,status:"completed",progress:100,isUploading:!1}}),[r]),C=(0,s.useMemo)(()=>i.map(e=>({id:e.id,fileName:e.file.name,exhibitNumber:e.exhibitNumber,exhibitFolder:e.exhibitFolder,status:e.status,progress:e.progress,isUploading:!0,error:e.error})),[i]),L=(0,s.useMemo)(()=>{let e=[...k],t=new Set(k.map(e=>e.exhibitNumber));for(let s of C)t.has(s.exhibitNumber)||e.push(s);return e},[k,C]),$=(0,s.useMemo)(()=>{let e={};return h.forEach(t=>{e[t]=L.filter(e=>e.exhibitFolder===t)}),e},[L]),S=(0,s.useCallback)(e=>{let t=L.filter(t=>t.exhibitFolder===e);return 0===t.length?1:Math.max(...t.map(e=>{let t=e.exhibitNumber.match(/-(\d+)$/);return t?parseInt(t[1]):0}))+1},[L]),M=N?"uploading":i.some(e=>"completed"===e.status)?"completed":"idle",E=(0,s.useCallback)(e=>{if(!e||0===e.length)return;let t=[],s=S(u);for(let r=0;r<e.length;r++){let a=e[r];(["application/pdf","image/png","image/jpeg","image/jpg","image/tiff"].includes(a.type)||a.name.match(/\.(pdf|png|jpg|jpeg|tiff?)$/i))&&(t.push({id:`${Date.now()}-${r}`,file:a,exhibitNumber:`${u}-${s}`,exhibitFolder:u,status:"pending",progress:0}),s++)}t.length>0&&o(e=>[...e,...t])},[u,S]),_=async()=>{let t=i.filter(e=>"pending"===e.status);if(0===t.length)return;v(!0);let s=0,r=0;for(let a of t){let t=a.id;o(e=>e.map(e=>e.id===t?{...e,status:"uploading",progress:0}:e));try{await d(e,a.file,a.exhibitNumber,a.file.name.replace(/\.[^/.]+$/,""),e=>{o(s=>s.map(s=>s.id===t?{...s,progress:e}:s))}),o(e=>e.map(e=>e.id===t?{...e,status:"completed",progress:100}:e)),s++}catch(e){o(s=>s.map(s=>s.id===t?{...s,status:"failed",error:e.message}:s)),r++}}v(!1),s>0&&(n(`${s} 个文件上传成功`),a()),r>0&&l(`${r} 个文件上传失败`)},B=$[u]||[],W=i.filter(e=>"pending"===e.status).length,R=L.length;return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-5 py-4 border-b border-gray-100 bg-gray-50/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600",children:(0,t.jsx)(p,{})}),(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"上传模块"}),R>0&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[R," 个文件"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[W>0&&(0,t.jsxs)("button",{onClick:_,disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[(0,t.jsx)(p,{}),"上传 (",W,")"]}),(0,t.jsx)(({status:e})=>{let{bg:s,text:r,label:a}={idle:{bg:"bg-gray-100",text:"text-gray-600",label:"等待上传"},uploading:{bg:"bg-blue-100",text:"text-blue-700",label:"上传中"},completed:{bg:"bg-green-100",text:"text-green-700",label:"已完成"}}[e];return(0,t.jsx)("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${s} ${r}`,children:a})},{status:M})]})]})}),(0,t.jsxs)("div",{className:"flex",style:{minHeight:"300px"},children:[(0,t.jsxs)("div",{className:"w-64 border-r border-gray-200 flex flex-col",children:[(0,t.jsx)("div",{className:"px-2 py-2 border-b border-gray-100 bg-gray-50",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:h.map(e=>{let s=$[e]?.length||0;return(0,t.jsxs)("button",{onClick:()=>m(e),className:`relative px-3 py-1.5 text-xs font-medium rounded transition-colors ${u===e?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"}`,children:[e,s>0&&(0,t.jsx)("span",{className:`absolute -top-1 -right-1 w-4 h-4 text-xs rounded-full flex items-center justify-center ${u===e?"bg-white text-blue-600":"bg-blue-500 text-white"}`,children:s})]},e)})})}),(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-100 flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:["Exhibit ",u," (",B.length,")"]}),B.length>0&&(0,t.jsx)("button",{onClick:()=>{o(e=>e.filter(e=>e.exhibitFolder!==u))},className:"text-xs text-gray-400 hover:text-red-500 transition-colors",children:"清除"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===B.length?(0,t.jsxs)("div",{className:"p-4 text-center text-xs text-gray-400",children:["暂无文件",(0,t.jsx)("p",{className:"mt-1",children:"拖拽或点击右侧区域上传"})]}):(0,t.jsx)("div",{className:"py-1",children:B.map(e=>(0,t.jsxs)("div",{className:`flex items-center gap-2 px-3 py-2 border-b border-gray-50 ${"completed"===e.status?"bg-green-50":"failed"===e.status?"bg-red-50":"uploading"===e.status?"bg-blue-50":"hover:bg-gray-50"}`,children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-4 h-4 flex items-center justify-center",children:"uploading"===e.status?(0,t.jsx)("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}):"completed"===e.status?(0,t.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",children:(0,t.jsx)(j,{})}):"failed"===e.status?(0,t.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full flex items-center justify-center text-white",children:(0,t.jsx)(f,{})}):(0,t.jsx)("div",{className:"text-gray-400",children:(0,t.jsx)(b,{})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-700 truncate",children:e.exhibitNumber}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",title:e.fileName,children:e.fileName}),"uploading"===e.status&&(0,t.jsx)("div",{className:"mt-1 h-1 bg-gray-200 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:"uploading"===e.status?(0,t.jsxs)("span",{className:"text-xs text-blue-600",children:[e.progress,"%"]}):"pending"===e.status&&e.isUploading?(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void o(e=>e.filter(e=>e.id!==t))},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",children:(0,t.jsx)(y,{})}):null})]},e.id))})})]}),(0,t.jsx)("div",{className:"flex-1 p-4 flex items-center justify-center",children:(0,t.jsxs)("div",{onDragOver:e=>{e.preventDefault(),x(!0)},onDragLeave:e=>{e.preventDefault(),x(!1)},onDrop:e=>{e.preventDefault(),x(!1),E(e.dataTransfer.files)},onClick:()=>w.current?.click(),className:`w-full h-full border-2 border-dashed rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all ${c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}`,children:[(0,t.jsx)("input",{ref:w,type:"file",multiple:!0,accept:".pdf,.png,.jpg,.jpeg,.tiff,.tif",onChange:e=>E(e.target.files),className:"hidden"}),(0,t.jsx)("div",{className:`mb-3 ${c?"text-blue-500":"text-gray-400"}`,children:(0,t.jsx)(g,{})}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"拖拽文件到这里，或点击上传"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"支持 PDF、JPG、PNG"}),(0,t.jsxs)("p",{className:"text-xs text-blue-600 mt-3 font-medium",children:["当前目标: Exhibit ",u]})]})})]})]})}function v({url:e,onMessage:t,onComplete:r,onError:a,autoConnect:l=!1}){let[n,i]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),c=(0,s.useRef)(null),x=(0,s.useRef)(!0),u=(0,s.useRef)(t),m=(0,s.useRef)(r),h=(0,s.useRef)(a);(0,s.useEffect)(()=>{u.current=t,m.current=r,h.current=a},[t,r,a]);let p=(0,s.useCallback)(()=>{c.current&&(c.current.close(),c.current=null),x.current&&i(!1)},[]),g=(0,s.useCallback)(()=>{if(!e)return;c.current&&c.current.close();let t=new EventSource(e);c.current=t,t.onopen=()=>{x.current&&i(!0)},t.onmessage=e=>{if(x.current)try{let t=JSON.parse(e.data);d(t),u.current?.(t)}catch(e){console.error("[useSSE] Failed to parse message:",e)}},t.addEventListener("progress",e=>{if(x.current)try{let t=JSON.parse(e.data);d(t),u.current?.(t)}catch(e){console.error("[useSSE] Failed to parse progress event:",e)}}),t.addEventListener("complete",e=>{if(x.current)try{let t=JSON.parse(e.data);d(t),m.current?.(t),p()}catch(e){console.error("[useSSE] Failed to parse complete event:",e)}}),t.onerror=e=>{x.current&&(console.error("[useSSE] Connection error:",e),h.current?.(e),i(!1))}},[e,p]);return(0,s.useEffect)(()=>{l&&e&&g()},[l,e,g]),(0,s.useEffect)(()=>(x.current=!0,()=>{x.current=!1,c.current&&(c.current.close(),c.current=null)}),[]),(0,s.useEffect)(()=>{!e&&c.current&&p()},[e,p]),{isConnected:n,lastData:o,connect:g,disconnect:p}}let w="undefined"!=typeof EventSource,k=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),C=()=>(0,t.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),L=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),$=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),S=({status:e})=>{switch(e){case"pending":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-gray-300 flex-shrink-0",title:"待处理"});case"queued":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-yellow-400 flex-shrink-0",title:"队列中"});case"processing":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 animate-pulse flex-shrink-0",title:"处理中"});case"completed":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 flex-shrink-0",title:"完成"});case"failed":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 flex-shrink-0",title:"失败"})}};function M({projectId:e,documents:l,onOCRComplete:n,onSuccess:i,onError:o,modelsReady:d=!0}){let c,[x,u]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[g,j]=(0,s.useState)(""),[f,b]=(0,s.useState)(!1),[y,N]=(0,s.useState)(!1),M=e?(c=e,`${r}/api/ocr/stream/${c}`):null,E=(0,s.useCallback)(e=>{u(t=>t.map(t=>{let s=e.documents?.find(e=>e.id===t.id);return s?{...t,status:s.ocr_status}:t}))},[]),_=(0,s.useCallback)(e=>{N(!1),n(),e.failed>0?o(`OCR 完成: ${e.completed} 成功, ${e.failed} 失败`):e.completed>0&&i(`OCR 完成: ${e.completed} 个文档已处理`)},[n,o,i]),{isConnected:B,connect:W,disconnect:R}=v({url:w?M:null,onMessage:E,onComplete:_,onError:e=>{console.error("[OCR SSE] Connection error:",e)}}),{isPolling:O,errorCount:z,start:F,stop:T}=m({fetcher:()=>{let t;return t=e,a(`/api/ocr/progress/${t}`)},shouldContinue:e=>e.processing>0||e.pending>0||e.queued>0,interval:2e3,errorRetryInterval:5e3,maxErrorCount:3,maxDuration:18e5,enabled:!1,onSuccess:e=>{E(e),0===e.processing&&0===e.pending&&0===e.queued&&_(e)},onError:e=>{console.error("Failed to get OCR progress:",e)},onMaxErrors:()=>{N(!1),o("无法连接后端服务，请检查后端是否运行"),u(e=>e.map(e=>"processing"===e.status||"queued"===e.status?{...e,status:"pending"}:e))},onTimeout:()=>{N(!1),o("OCR 处理超时，请检查后端状态"),u(e=>e.map(e=>"processing"===e.status||"queued"===e.status?{...e,status:"pending"}:e))}}),P=(0,s.useCallback)(()=>{N(!0),w?W():F()},[W,F]);(0,s.useCallback)(()=>{N(!1),w?R():T()},[R,T]),(0,s.useEffect)(()=>{let e=l.map(e=>({id:e.id,fileName:e.file_name,exhibitNumber:e.exhibit_number||"N/A",status:e.ocr_status||"pending",ocrText:e.ocr_text}));if(u(e),!h){let t=e.find(e=>"completed"===e.status);t&&(p(t.id),j(t.ocrText||""))}},[l,h]);let H=y||x.some(e=>"processing"===e.status)?"processing":x.length>0&&x.every(e=>"completed"===e.status)?"completed":"idle",A=x.filter(e=>"pending"===e.status).length,q=x.filter(e=>"completed"===e.status).length,D=async e=>{try{let t;u(t=>t.map(t=>t.id===e?{...t,status:"processing"}:t)),await (t=e,a(`/api/ocr/${t}`,{method:"POST"})),P()}catch(t){console.error("OCR failed:",t),o(t instanceof Error&&t.message.includes("fetch")?"无法连接后端服务":"OCR 启动失败"),u(t=>t.map(t=>t.id===e?{...t,status:"pending"}:t))}},V=async()=>{if(0!==A)try{let t;u(e=>e.map(e=>"pending"===e.status?{...e,status:"queued"}:e)),await (t=e,a(`/api/ocr/batch/${t}`,{method:"POST"})),i("OCR 处理已启动"),P()}catch(e){console.error("Batch OCR failed:",e),o(e instanceof Error&&e.message.includes("fetch")?"无法连接后端服务":"批量 OCR 启动失败"),u(e=>e.map(e=>"queued"===e.status?{...e,status:"pending"}:e))}},I=e=>{p(e.id),j(e.ocrText||"")},J=x.find(e=>e.id===h);return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-5 py-4 border-b border-gray-100 bg-gray-50/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:(0,t.jsx)(k,{})}),(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"OCR 模块"}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[q,"/",x.length," 已完成"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:V,disabled:0===A||y||!d,className:"flex items-center gap-1.5 px-3 py-1.5 bg-purple-600 text-white text-xs font-medium rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:d?void 0:"模型加载中...",children:[(0,t.jsx)(C,{}),d?"全部开始":"模型加载中..."]}),(0,t.jsx)(({status:e})=>{let{bg:s,text:r,label:a}={idle:{bg:"bg-gray-100",text:"text-gray-600",label:"等待处理"},processing:{bg:"bg-blue-100",text:"text-blue-700",label:"处理中"},completed:{bg:"bg-green-100",text:"text-green-700",label:"已完成"}}[e];return(0,t.jsx)("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${s} ${r}`,children:a})},{status:H})]})]})}),(0,t.jsxs)("div",{className:"flex",style:{height:"500px"},children:[(0,t.jsxs)("div",{className:`border-r border-gray-200 flex flex-col transition-all duration-300 ${f?"w-10":"w-64"}`,children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50 flex items-center justify-between",children:[!f&&(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"文件列表"}),(0,t.jsx)("button",{onClick:()=>b(!f),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:f?"展开":"折叠",children:f?(0,t.jsx)($,{}):(0,t.jsx)(L,{})})]}),f?(0,t.jsx)("div",{className:"flex-1 overflow-y-auto py-1",children:x.map(e=>(0,t.jsx)("div",{onClick:()=>"completed"===e.status&&I(e),className:`flex items-center justify-center py-2 cursor-pointer transition-colors ${h===e.id?"bg-purple-50":"hover:bg-gray-50"}`,title:`${e.exhibitNumber}: ${e.fileName}`,children:(0,t.jsx)(S,{status:e.status})},e.id))}):(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===x.length?(0,t.jsx)("div",{className:"p-4 text-center text-xs text-gray-400",children:"暂无文件"}):(0,t.jsx)("div",{className:"py-1",children:x.map(e=>(0,t.jsxs)("div",{onClick:()=>"completed"===e.status&&I(e),className:`flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors ${h===e.id?"bg-purple-50 border-r-2 border-purple-500":"hover:bg-gray-50"} ${"completed"!==e.status?"opacity-60":""}`,children:[(0,t.jsx)(S,{status:e.status}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-700 truncate",children:e.exhibitNumber}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",title:e.fileName,children:e.fileName})]}),"pending"===e.status&&!y&&d&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),D(e.id)},className:"px-1.5 py-0.5 text-xs text-purple-600 hover:bg-purple-100 rounded transition-colors",children:"开始"})]},e.id))})})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,t.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100 bg-gray-50 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:J?`OCR 结果 - ${J.exhibitNumber}: ${J.fileName}`:"OCR 结果预览"}),g&&(0,t.jsx)("button",{onClick:async()=>{try{await navigator.clipboard.writeText(g)}catch(e){console.error("Failed to copy:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 hover:bg-gray-200 rounded transition-colors",children:"复制"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-white",children:g?(0,t.jsx)("div",{className:"prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap font-mono text-sm leading-relaxed",children:g}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center text-gray-400",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"选择一个已完成 OCR 的文件查看结果"})]})})})]})]})]})}let E=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),_=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),B=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),W=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})}),R=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})}),O={key_fact:"rgba(59, 130, 246, 0.3)",evidence:"rgba(16, 185, 129, 0.3)",timeline:"rgba(245, 158, 11, 0.3)",entity:"rgba(139, 92, 246, 0.3)",financial:"rgba(236, 72, 153, 0.3)",default:"rgba(251, 191, 36, 0.3)"};function z({documentId:e,pageCount:a=1,currentPage:l,onPageChange:n,selectedHighlightId:i}){let[o,d]=(0,s.useState)(1),c=l??o,u=e=>{n?n(e):d(e)},[m,h]=(0,s.useState)(a),[p,g]=(0,s.useState)(null),[j,f]=(0,s.useState)([]),[b,y]=(0,s.useState)(!1),[N,v]=(0,s.useState)(null),[w,k]=(0,s.useState)(100),[C,L]=(0,s.useState)(null),[$,S]=(0,s.useState)(null);return((0,s.useEffect)(()=>{if(i){let e=j.find(e=>e.id===i);e&&L(e)}},[i,j]),(0,s.useEffect)(()=>{if(!e){g(null),f([]);return}(async()=>{y(!0),v(null),S(null);try{var t,s;let a,l=(t=e,s=c,a="",`${r}/api/highlight/page/${t}/${s}/image${a}`);g(l);let n=await x(e,c);f(n.highlights||[])}catch(e){console.error("Failed to load page data:",e),v("无法加载页面"),g(null),f([])}finally{y(!1)}})()},[e,c]),(0,s.useEffect)(()=>{h(a)},[a]),(0,s.useEffect)(()=>{l||d(1),L(null)},[e,l]),e)?(0,t.jsxs)("div",{className:"h-full flex flex-col border border-gray-200 rounded-lg overflow-hidden bg-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-50 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>{k(e=>Math.max(e-25,50))},disabled:w<=50,className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"缩小",children:(0,t.jsx)(R,{})}),(0,t.jsxs)("span",{className:"text-xs text-gray-600 min-w-[40px] text-center",children:[w,"%"]}),(0,t.jsx)("button",{onClick:()=>{k(e=>Math.min(e+25,200))},disabled:w>=200,className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"放大",children:(0,t.jsx)(W,{})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{c>1&&(u(c-1),L(null))},disabled:c<=1,className:"p-1 text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,t.jsx)(E,{})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 min-w-[60px] text-center",children:[c," / ",m]}),(0,t.jsx)("button",{onClick:()=>{c<m&&(u(c+1),L(null))},disabled:c>=m,className:"p-1 text-gray-600 hover:text-gray-900 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,t.jsx)(_,{})})]}),(0,t.jsx)("button",{onClick:()=>{p&&window.open(p,"_blank")},className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"下载当前页",children:(0,t.jsx)(B,{})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-auto bg-gray-100 relative",children:b?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin"})}):N?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-sm text-red-500",children:N})}):p?(0,t.jsx)("div",{className:"min-h-full flex items-start justify-center p-4",children:(0,t.jsxs)("div",{className:"relative shadow-lg bg-white",style:{transform:`scale(${w/100})`,transformOrigin:"top center"},children:[(0,t.jsx)("img",{src:p,alt:`Page ${c}`,className:"block",style:{maxWidth:"none"},onLoad:e=>{let t=e.target;S({width:t.naturalWidth,height:t.naturalHeight})},onError:()=>v("图片加载失败")}),$&&j.map((e,s)=>{var r;let a,l,n;if(!e.bbox||null==e.bbox.x1)return null;let{x1:i,y1:o,x2:d,y2:c}=e.bbox,x=(a={x1:i||0,y1:o||0,x2:d||0,y2:c||0},l=$.width,n=$.height,{left:a.x1/1e3*l,top:a.y1/1e3*n,width:(a.x2-a.x1)/1e3*l,height:(a.y2-a.y1)/1e3*n});return x.width<=0||x.height<=0?null:(0,t.jsx)("div",{className:`absolute cursor-pointer transition-all ${C?.id===e.id?"ring-2 ring-blue-500":"hover:ring-2 hover:ring-blue-300"}`,style:{left:`${x.left}px`,top:`${x.top}px`,width:`${x.width}px`,height:`${x.height}px`,backgroundColor:(r=e.category)&&O[r.toLowerCase()]||O.default,borderRadius:"2px"},onClick:()=>L(e),title:e.text_content||"高光区域"},e.id||s)})]})}):(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"无法加载页面"})})}),C&&(0,t.jsx)("div",{className:"px-4 py-3 bg-blue-50 border-t border-blue-200",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[C.category&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-blue-100 text-blue-700",children:C.category_cn||C.category}),C.importance&&(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${"high"===C.importance?"bg-red-100 text-red-700":"medium"===C.importance?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:"high"===C.importance?"高重要":"medium"===C.importance?"中等":"低"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2",children:C.text_content||"无文本内容"}),C.reason&&(0,t.jsxs)("p",{className:"text-xs text-gray-600 mt-1 line-clamp-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"原因:"})," ",C.reason]})]}),(0,t.jsx)("button",{onClick:()=>L(null),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),j.length>0&&(0,t.jsxs)("div",{className:"px-3 py-1.5 bg-gray-50 border-t border-gray-100 text-xs text-gray-500 text-center",children:["当前页 ",j.length," 个高光区域"]})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-50 rounded-lg border border-gray-200",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"选择文件查看预览"})]})})}let F="undefined"!=typeof EventSource,T=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),P=()=>(0,t.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),H=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),A=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),q=({status:e})=>{switch(e){case"not_started":case"pending":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-gray-300 flex-shrink-0",title:"待分析"});case"processing":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-yellow-500 animate-pulse flex-shrink-0",title:"分析中"});case"completed":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 flex-shrink-0",title:"完成"});case"failed":return(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 flex-shrink-0",title:"失败"})}};function D({projectId:e,documents:l,onHighlightComplete:n,onSuccess:i,onError:o,modelsReady:d=!0}){let c,[h,p]=(0,s.useState)([]),[g,j]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),[y,N]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[C,L]=(0,s.useState)([]),[$,S]=(0,s.useState)(!1),[M,E]=(0,s.useState)(1),[_,B]=(0,s.useState)(null),W=e?(c=e,`${r}/api/highlight/stream/${c}`):null,R=(0,s.useCallback)(e=>{p(t=>{let s=!1,r=t.map(t=>{let r=e.documents?.find(e=>e.id===t.id);if(r){let e=r.highlight_status||"pending";if(t.status!==e)return s=!0,{...t,status:e}}return t});return s?r:t})},[]),O=(0,s.useCallback)(e=>{k(!1),n(),e.failed>0?o(`高光分析完成: ${e.completed} 成功, ${e.failed} 失败`):e.completed>0&&i(`高光分析完成: ${e.completed} 个文档已处理`)},[n,o,i]),{isConnected:D,connect:V,disconnect:I}=v({url:F?W:null,onMessage:R,onComplete:O,onError:e=>{console.error("[Highlight SSE] Connection error:",e)}}),{isPolling:J,errorCount:U,start:G,stop:K}=m({fetcher:()=>u(e),shouldContinue:e=>e.processing>0||e.pending>0,interval:2e3,errorRetryInterval:5e3,maxErrorCount:3,maxDuration:18e5,enabled:!1,onSuccess:e=>{R(e),0===e.processing&&0===e.pending&&O(e)},onError:e=>{console.error("Failed to get highlight progress:",e)},onMaxErrors:()=>{k(!1),o("无法连接后端服务，请检查后端是否运行"),p(e=>e.map(e=>"processing"===e.status?{...e,status:"pending"}:e))},onTimeout:()=>{k(!1),o("高光分析处理超时，请检查后端状态"),p(e=>e.map(e=>"processing"===e.status?{...e,status:"pending"}:e))}}),Q=(0,s.useCallback)(()=>{k(!0),F?V():G()},[V,G]);(0,s.useCallback)(()=>{k(!1),F?I():K()},[I,K]),(0,s.useEffect)(()=>{let e=l.filter(e=>"completed"===e.ocr_status);p(t=>e.map(e=>{let s=t.find(t=>t.id===e.id);return{id:e.id,fileName:e.file_name,exhibitNumber:e.exhibit_number||"N/A",status:s?.status||"pending",pageCount:e.page_count||1}}))},[l]),(0,s.useEffect)(()=>{!g&&h.length>0&&j(h[0])},[g,h]),(0,s.useEffect)(()=>{if(g){let e=h.find(e=>e.id===g.id);e&&e.status!==g.status&&j(e)}},[h,g]),(0,s.useEffect)(()=>{(async()=>{if(0!==h.length)try{let t=await u(e);p(e=>e.map(e=>{let s=t.documents?.find(t=>t.id===e.id);return s?{...e,status:s.highlight_status||"pending",pageCount:s.page_count||e.pageCount}:e}))}catch(e){console.error("Failed to load highlight status:",e)}})()},[e,h.length]);let Y=w||h.some(e=>"processing"===e.status)?"processing":h.length>0&&h.every(e=>"completed"===e.status)?"completed":"idle",X=h.filter(e=>"pending"===e.status||"not_started"===e.status).length,Z=h.filter(e=>"completed"===e.status).length,ee=async e=>{try{let t;p(t=>t.map(t=>t.id===e.id?{...t,status:"processing"}:t)),await (t=e.id,a(`/api/highlight/${t}`,{method:"POST"})),Q()}catch(t){console.error("Highlight failed:",t),o(t instanceof Error&&t.message.includes("fetch")?"无法连接后端服务":"高光分析启动失败"),p(t=>t.map(t=>t.id===e.id?{...t,status:"pending"}:t))}},et=async()=>{if(0!==X)try{let t;p(e=>e.map(e=>"pending"===e.status||"not_started"===e.status?{...e,status:"processing"}:e)),await (t=e,a(`/api/highlight/batch/${t}`,{method:"POST"})),i("高光分析已启动"),Q()}catch(e){console.error("Batch highlight failed:",e),o(e instanceof Error&&e.message.includes("fetch")?"无法连接后端服务":"批量高光分析启动失败"),p(e=>e.map(e=>"processing"===e.status?{...e,status:"pending"}:e))}},es=h.find(e=>e.id===g?.id)?.status;(0,s.useEffect)(()=>{(async()=>{if(!g||"completed"!==es)return L([]);S(!0);try{let e=await x(g.id);L(e.highlights||[])}catch(e){console.error("Failed to load highlights:",e),L([])}finally{S(!1)}})(),E(1),B(null)},[g?.id,es]);let er=e=>{j(e)};return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-5 py-4 border-b border-gray-100 bg-gray-50/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center text-yellow-600",children:(0,t.jsx)(T,{})}),(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"高光模块"}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[Z,"/",h.length," 已完成"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:et,disabled:0===X||w||!d,className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-500 text-white text-xs font-medium rounded-lg hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:d?void 0:"模型加载中...",children:[(0,t.jsx)(P,{}),d?"全部分析":"模型加载中..."]}),(0,t.jsx)(({status:e})=>{let{bg:s,text:r,label:a}={idle:{bg:"bg-gray-100",text:"text-gray-600",label:"等待分析"},processing:{bg:"bg-yellow-100",text:"text-yellow-700",label:"分析中"},completed:{bg:"bg-green-100",text:"text-green-700",label:"已完成"}}[e];return(0,t.jsx)("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${s} ${r}`,children:a})},{status:Y})]})]})}),(0,t.jsxs)("div",{className:"flex",style:{height:"500px"},children:[(0,t.jsxs)("div",{className:`border-r border-gray-200 flex flex-col transition-all duration-300 ${f?"w-10":"w-56"}`,children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50 flex items-center justify-between",children:[!f&&(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"文件列表"}),(0,t.jsx)("button",{onClick:()=>b(!f),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:f?"展开":"折叠",children:f?(0,t.jsx)(A,{}):(0,t.jsx)(H,{})})]}),f?(0,t.jsx)("div",{className:"flex-1 overflow-y-auto py-1",children:h.map(e=>(0,t.jsx)("div",{onClick:()=>er(e),className:`flex items-center justify-center py-2 cursor-pointer transition-colors ${g?.id===e.id?"bg-yellow-50":"hover:bg-gray-50"}`,title:`${e.exhibitNumber}: ${e.fileName}`,children:(0,t.jsx)(q,{status:e.status})},e.id))}):(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===h.length?(0,t.jsxs)("div",{className:"p-4 text-center text-xs text-gray-400",children:["暂无可分析的文件",(0,t.jsx)("p",{className:"mt-1",children:"请先完成 OCR"})]}):(0,t.jsx)("div",{className:"py-1",children:h.map(e=>(0,t.jsxs)("div",{onClick:()=>er(e),className:`flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors ${g?.id===e.id?"bg-yellow-50 border-r-2 border-yellow-500":"hover:bg-gray-50"}`,children:[(0,t.jsx)(q,{status:e.status}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-700 truncate",children:e.exhibitNumber}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",title:e.fileName,children:e.fileName})]}),("pending"===e.status||"not_started"===e.status)&&!w&&d&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),ee(e)},className:"px-1.5 py-0.5 text-xs text-yellow-600 hover:bg-yellow-100 rounded transition-colors",children:"分析"})]},e.id))})})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,t.jsx)("div",{className:"px-4 py-2 border-b border-gray-100 bg-gray-50",children:(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:g?`PDF 预览 - ${g.exhibitNumber}: ${g.fileName}`:"PDF 预览"})}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden p-2",children:(0,t.jsx)(z,{documentId:g?.id||null,documentName:g?.fileName,pageCount:g?.pageCount||1,currentPage:M,onPageChange:E,selectedHighlightId:_})})]}),(0,t.jsxs)("div",{className:`border-l border-gray-200 flex flex-col transition-all duration-300 ${y?"w-10":"w-64"}`,children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50 flex items-center justify-between",children:[(0,t.jsx)("button",{onClick:()=>N(!y),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:y?"展开":"折叠",children:y?(0,t.jsx)(H,{}):(0,t.jsx)(A,{})}),!y&&(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:["高光列表 ",C.length>0&&`(${C.length})`]})]}),y?(0,t.jsx)("div",{className:"flex-1 flex flex-col items-center py-4",children:(0,t.jsx)("span",{className:"text-xs text-gray-500 [writing-mode:vertical-lr]",children:C.length>0?`${C.length} 高光`:"无高光"})}):(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:$?(0,t.jsx)("div",{className:"p-4 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-yellow-500 border-t-transparent rounded-full animate-spin"})}):0===C.length?(0,t.jsx)("div",{className:"p-4 text-center text-xs text-gray-400",children:g?.status==="completed"?"暂无高光":"完成分析后显示高光"}):(0,t.jsx)("div",{className:"py-1",children:C.map((e,s)=>(0,t.jsxs)("div",{onClick:()=>{E(e.page_number),B(e.id)},className:`px-3 py-2 cursor-pointer transition-colors border-b border-gray-50 ${_===e.id?"bg-yellow-50 border-l-2 border-l-yellow-500":"hover:bg-gray-50"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-400",children:["#",s+1]}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["P.",e.page_number]}),e.category_cn&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 text-xs rounded bg-yellow-100 text-yellow-700",children:e.category_cn}),"high"===e.importance&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 text-xs rounded bg-red-100 text-red-600",children:"重要"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-700 line-clamp-2",children:e.text_content||"无文本内容"})]},e.id||s))})})]})]})]})}let V={qualifying_relationship:{chinese:"合格的公司关系",english:"Qualifying Corporate Relationship",description:"美国公司与海外公司必须是母/子/分/关联公司关系",keywords:["母公司","子公司","关联公司","分公司","所有权","股权","持股","控股","共同控制"]},qualifying_employment:{chinese:"海外合格任职",english:"Qualifying Employment Abroad",description:"受益人过去3年中在海外关联公司连续工作至少1年",keywords:["任职","工作","职位","入职","离职","任期","年限","海外","境外"]},qualifying_capacity:{chinese:"合格的职位性质",english:"Qualifying Capacity",description:"L-1A: 高管/经理; L-1B: 专业知识人员",keywords:["高管","经理","管理","决策","战略","专业知识","专有技术","指导","监督","人事权","预算"]},doing_business:{chinese:"持续运营",english:"Doing Business",description:"美国和海外公司都必须持续、积极运营",keywords:["收入","利润","员工","雇员","银行","存款","合同","业务","办公","注册"]}},I=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),J=()=>(0,t.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),U=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),G=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),K=({status:e})=>{let{bg:s,text:r,label:a}={idle:{bg:"bg-gray-100",text:"text-gray-600",label:"等待分析"},processing:{bg:"bg-indigo-100",text:"text-indigo-700",label:"分析中"},completed:{bg:"bg-green-100",text:"text-green-700",label:"已完成"},error:{bg:"bg-red-100",text:"text-red-700",label:"分析失败"}}[e];return(0,t.jsx)("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${s} ${r}`,children:a})},Q=({quote:e,index:r})=>{let[a,l]=(0,s.useState)(!1);return(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-indigo-200 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-400 mt-0.5",children:["#",r+1]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("p",{className:`text-sm text-gray-700 ${a?"":"line-clamp-2"}`,children:['"',e.quote,'"']}),e.quote.length>100&&(0,t.jsx)("button",{onClick:()=>l(!a),className:"text-xs text-indigo-600 hover:text-indigo-800 mt-1",children:a?"收起":"展开"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-600",children:e.source?.exhibit_id||"N/A"}),e.page&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["P.",e.page]})]}),e.relevance&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1 italic",children:["相关性: ",e.relevance]})]})]})})},Y=({standardKey:e,quotes:r,defaultExpanded:a=!1})=>{let[l,n]=(0,s.useState)(a),i=V[e];return i?(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>n(!l),className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 flex items-center justify-between transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-indigo-100 text-indigo-700",children:r.length}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:i.chinese}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:i.english})]})]}),l?(0,t.jsx)(G,{}):(0,t.jsx)(U,{})]}),l&&(0,t.jsx)("div",{className:"p-4 space-y-3 bg-white",children:0===r.length?(0,t.jsx)("p",{className:"text-sm text-gray-400 text-center py-4",children:"暂无相关引用"}):r.map((e,s)=>(0,t.jsx)(Q,{quote:e,index:s},s))})]}):null};function X({projectId:e,onSuccess:l,onError:n}){let i,[o,d]=(0,s.useState)("idle"),[x,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(null),{isConnected:j,connect:f,disconnect:b}=v({url:e?(i=e,`${r}/api/l1-analyze/stream/${i}`):null,onMessage:(0,s.useCallback)(e=>{g(e),"processing"===e.status&&d("processing")},[]),onComplete:(0,s.useCallback)(async t=>{if(g(t),"completed"===t.status&&e)try{let s;await (s=e,a(`/api/l1-summary/${s}`,{method:"POST"}));let r=await c(e);u(r),d("completed"),l?.(`L-1 分析完成: 分析了 ${t.completed} 个文档，找到 ${t.total_quotes_found} 条引用`)}catch(e){console.error("Failed to generate summary:",e),d("completed")}},[e,l]),onError:(0,s.useCallback)(()=>{console.warn("L1 SSE connection error")},[]),autoConnect:!1});(0,s.useEffect)(()=>(e?y():(u(null),d("idle"),g(null)),()=>{b()}),[e,b]);let y=async()=>{if(e)try{let t;h(!0);let s=await (t=e,a(`/api/l1-status/${t}`));if(s.has_summary&&s.summary_quotes>0){let t=await c(e);u(t),d("completed")}else u(null),d("idle")}catch(e){console.error("Failed to load existing analysis:",e),u(null),d("idle")}finally{h(!1)}},N=async()=>{if(e)try{var t;let s;if(d("processing"),g(null),(await (t=e,s="",a(`/api/l1-analyze/${t}${s}`,{method:"POST"}))).success)f();else throw Error("Failed to start analysis")}catch(t){console.error("L-1 analysis failed:",t);let e=t instanceof Error&&t.message.includes("fetch")?"无法连接后端服务":"L-1 分析启动失败";n?.(e),d("error")}},w=x?.total_quotes||0,k=e=>x?.by_standard&&x.by_standard[e]||[];return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-5 py-4 border-b border-gray-100 bg-gray-50/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center text-indigo-600",children:(0,t.jsx)(I,{})}),(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"L-1 关键原文引用分析"}),w>0&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[w," 条引用"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:N,disabled:!e||"processing"===o,className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 text-white text-xs font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"processing"===o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"分析中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(J,{}),"completed"===o?"重新分析":"开始分析"]})}),(0,t.jsx)(K,{status:o})]})]})}),(0,t.jsx)("div",{className:"p-4",children:e?m?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"加载中..."})]}):"processing"===o?(0,t.jsxs)("div",{className:"py-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:["分析进度: ",p?.completed||0,"/",p?.total||0," 个文档"]}),(0,t.jsxs)("span",{className:"text-indigo-600 font-medium",children:[p?.progress_percent||0,"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${p?.progress_percent||0}%`}})})]}),p?.current_doc&&(0,t.jsx)("div",{className:"bg-indigo-50 rounded-lg p-3 mb-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),(0,t.jsxs)("span",{className:"text-sm text-indigo-700",children:["正在分析: ",p.current_doc.exhibit_id," - ",p.current_doc.file_name]})]})}),p&&p.total_quotes_found>0&&(0,t.jsxs)("div",{className:"text-center text-sm text-gray-500",children:["已找到 ",p.total_quotes_found," 条引用"]}),p?.errors&&p.errors.length>0&&(0,t.jsxs)("div",{className:"mt-3 text-sm text-red-600",children:[p.errors.length," 个文档分析失败"]})]}):"idle"===o?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,t.jsx)("p",{className:"mt-3 text-sm",children:'点击"开始分析"提取 L-1 关键原文引用'}),(0,t.jsx)("p",{className:"mt-1 text-xs",children:"将从 OCR 结果中自动识别符合 L-1 标准的关键引用"})]}):"error"===o?(0,t.jsxs)("div",{className:"text-center py-8 text-red-400",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,t.jsx)("p",{className:"mt-3 text-sm",children:"分析失败，请重试"})]}):x&&w>0?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"grid grid-cols-4 gap-3 mb-4",children:Object.keys(V).map(e=>{let s=k(e).length,r=V[e];return(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-indigo-600",children:s}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",title:r.chinese,children:r.chinese})]},e)})}),(0,t.jsx)("div",{className:"space-y-3",children:Object.keys(V).map((e,s)=>(0,t.jsx)(Y,{standardKey:e,quotes:k(e),defaultExpanded:0===s},e))})]}):(0,t.jsx)("div",{className:"text-center py-8 text-gray-400",children:(0,t.jsx)("p",{className:"text-sm",children:"分析完成，但未找到符合条件的引用"})}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)(I,{}),(0,t.jsx)("p",{className:"mt-2 text-sm",children:"请先选择一个项目"})]})})]})}let Z=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),ee=()=>(0,t.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),et=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),es=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),er={person:"人物",organization:"组织",company:"公司",date:"日期",location:"地点",position:"职位",event:"事件",document:"文档"},ea={works_for:"任职于",owns:"拥有",subsidiary_of:"子公司",affiliated_with:"关联",employed_by:"受雇于",manages:"管理",reports_to:"汇报给",founded:"创立",located_in:"位于"},el=({status:e})=>{let{bg:s,text:r,label:a}={idle:{bg:"bg-gray-100",text:"text-gray-600",label:"等待分析"},processing:{bg:"bg-rose-100",text:"text-rose-700",label:"分析中"},completed:{bg:"bg-green-100",text:"text-green-700",label:"已完成"},error:{bg:"bg-red-100",text:"text-red-700",label:"分析失败"}}[e];return(0,t.jsx)("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${s} ${r}`,children:a})},en=({entity:e})=>{let s=er[e.type]||e.type,r={person:"bg-blue-100 text-blue-700",organization:"bg-purple-100 text-purple-700",company:"bg-green-100 text-green-700",date:"bg-yellow-100 text-yellow-700",location:"bg-orange-100 text-orange-700",position:"bg-pink-100 text-pink-700",event:"bg-cyan-100 text-cyan-700",document:"bg-gray-100 text-gray-700"}[e.type]||"bg-gray-100 text-gray-700";return(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-rose-200 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${r}`,children:s}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),e.documents.length>0&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["来源: ",e.documents.slice(0,3).join(", "),e.documents.length>3&&` +${e.documents.length-3}`]})]})]})})},ei=({relation:e,entities:s})=>{let r=s.find(t=>t.id===e.source_id),a=s.find(t=>t.id===e.target_id),l=ea[e.relation_type]||e.relation_type;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-rose-200 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-rose-50 text-rose-700 border border-rose-200",children:r?.name||e.source_id}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:(0,t.jsx)("svg",{className:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-100 text-gray-700",children:l}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:(0,t.jsx)("svg",{className:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})}),(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-rose-50 text-rose-700 border border-rose-200",children:a?.name||e.target_id})]}),e.description&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:e.description})]})},eo=({chain:e})=>{let[r,a]=(0,s.useState)(!1);return(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-rose-200 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded flex-shrink-0 ${{strong:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",weak:"bg-red-100 text-red-700"}[e.strength]||"bg-gray-100 text-gray-700"}`,children:{strong:"强",medium:"中",weak:"弱"}[e.strength]||e.strength}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`text-sm text-gray-700 ${r?"":"line-clamp-2"}`,children:e.claim}),e.claim.length>100&&(0,t.jsx)("button",{onClick:()=>a(!r),className:"text-xs text-rose-600 hover:text-rose-800 mt-1",children:r?"收起":"展开"}),e.documents.length>0&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["证据来源: ",e.documents.join(", ")]}),e.reasoning&&r&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1 italic",children:["推理: ",e.reasoning]})]})]})})},ed=({title:e,count:r,children:a,defaultExpanded:l=!1})=>{let[n,i]=(0,s.useState)(l);return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>i(!n),className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 flex items-center justify-between transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-rose-100 text-rose-700",children:r}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e})]}),n?(0,t.jsx)(es,{}):(0,t.jsx)(et,{})]}),n&&(0,t.jsx)("div",{className:"p-4 space-y-3 bg-white",children:a})]})};function ec({projectId:e,onSuccess:l,onError:n}){let i,[o,d]=(0,s.useState)("idle"),[c,x]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),{connect:h,disconnect:p}=v({url:e?(i=e,`${r}/api/relationship/stream/${i}`):null,onMessage:(0,s.useCallback)(e=>{"processing"===e.status&&d("processing")},[]),onComplete:(0,s.useCallback)(e=>{"completed"===e.status&&e.result?(x(e.result),d("completed"),l?.(`关系分析完成: 识别了 ${e.result.entities?.length||0} 个实体，${e.result.relations?.length||0} 条关系`)):"failed"===e.status&&(d("error"),n?.(e.error||"关系分析失败"))},[l,n]),onError:(0,s.useCallback)(()=>{console.warn("Relationship SSE connection error")},[]),autoConnect:!1});(0,s.useEffect)(()=>(e?g():(x(null),d("idle")),()=>{p()}),[e,p]);let g=async()=>{if(e)try{let t;m(!0);let s=await (t=e,a(`/api/projects/${t}/relationship`));s.data&&(s.data.entities.length>0||s.data.relations.length>0)?(x(s.data),d("completed")):(x(null),d("idle"))}catch(e){console.error("Failed to load existing relationship analysis:",e),x(null),d("idle")}finally{m(!1)}},j=async()=>{if(e)try{var t;let s;if(d("processing"),(await (t=e,s="",a(`/api/relationship/${t}${s}`,{method:"POST"}))).success)h();else throw Error("Failed to start analysis")}catch(t){console.error("Relationship analysis failed:",t);let e=t instanceof Error&&t.message.includes("fetch")?"无法连接后端服务":"关系分析启动失败";n?.(e),d("error")}},f=c?.entities.length||0,b=c?.relations.length||0,y=c?.evidence_chains.length||0,N=c?.entities.reduce((e,t)=>{let s=t.type||"other";return e[s]||(e[s]=[]),e[s].push(t),e},{})||{};return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-5 py-4 border-b border-gray-100 bg-gray-50/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-rose-100 rounded-lg flex items-center justify-center text-rose-600",children:(0,t.jsx)(Z,{})}),(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"关系分析"}),(f>0||b>0)&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[f," 实体 | ",b," 关系"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:j,disabled:!e||"processing"===o,className:"flex items-center gap-1.5 px-3 py-1.5 bg-rose-600 text-white text-xs font-medium rounded-lg hover:bg-rose-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"processing"===o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"分析中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee,{}),"completed"===o?"重新分析":"开始分析"]})}),(0,t.jsx)(el,{status:o})]})]})}),(0,t.jsx)("div",{className:"p-4",children:e?u?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"w-6 h-6 border-2 border-rose-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"加载中..."})]}):"idle"===o?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,t.jsx)("p",{className:"mt-3 text-sm",children:'点击"开始分析"提取实体关系'}),(0,t.jsx)("p",{className:"mt-1 text-xs",children:"将分析文档中的人物、组织、时间等实体及其关系"})]}):"error"===o?(0,t.jsxs)("div",{className:"text-center py-8 text-red-400",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,t.jsx)("p",{className:"mt-3 text-sm",children:"分析失败，请重试"})]}):c&&(f>0||b>0)?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-rose-600",children:f}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"实体"})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-rose-600",children:b}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"关系"})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-rose-600",children:y}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"证据链"})]})]}),f>0&&(0,t.jsx)(ed,{title:"实体列表",count:f,defaultExpanded:!0,children:Object.entries(N).map(([e,s])=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-xs font-medium text-gray-500 uppercase",children:[er[e]||e," (",s.length,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.map(e=>(0,t.jsx)(en,{entity:e},e.id))})]},e))}),b>0&&(0,t.jsx)(ed,{title:"关系列表",count:b,children:(0,t.jsx)("div",{className:"space-y-2",children:c.relations.map((e,s)=>(0,t.jsx)(ei,{relation:e,entities:c.entities},s))})}),y>0&&(0,t.jsx)(ed,{title:"证据链",count:y,children:(0,t.jsx)("div",{className:"space-y-2",children:c.evidence_chains.map((e,s)=>(0,t.jsx)(eo,{chain:e},s))})})]}):(0,t.jsx)("div",{className:"text-center py-8 text-gray-400",children:(0,t.jsx)("p",{className:"text-sm",children:"分析完成，但未识别到实体或关系"})}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)(Z,{}),(0,t.jsx)("p",{className:"mt-2 text-sm",children:"请先选择一个项目"})]})})]})}let ex=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),eu=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),em=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),eh=()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),ep=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),eg=()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})});function ej({message:e,type:r,onClose:a}){return(0,s.useEffect)(()=>{let e=setTimeout(a,3e3);return()=>clearTimeout(e)},[a]),(0,t.jsxs)("div",{className:`fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg ${"success"===r?"bg-green-500":"error"===r?"bg-red-500":"bg-blue-500"} text-white flex items-center gap-3 animate-slide-in z-50`,children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("button",{onClick:a,className:"text-white/80 hover:text-white",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function ef(){let[e,r]=(0,s.useState)(!1),[l,n]=(0,s.useState)([]),[i,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0),[x,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)([]),[g,j]=(0,s.useState)(!1),[f,b]=(0,s.useState)("checking"),[y,v]=(0,s.useState)(null),w=(0,s.useCallback)(async()=>{try{let e=await fetch("https://petigen.zacchen.win/");b(e.ok?"online":"offline")}catch{b("offline")}},[]),{data:k}=m({fetcher:()=>a("/api/preload-status"),shouldContinue:e=>e.is_loading&&!e.is_ready,interval:2e3,errorRetryInterval:5e3,maxErrorCount:5,enabled:!0,onError:e=>{console.error("Failed to get preload status:",e)}});(0,s.useEffect)(()=>{console.log(`%cPetitionLetter Frontend v0.2.0%c
Build: 01/24/2026, 23:43 (New York Time)
%c三模块布局版本`,"color: #2563EB; font-size: 14px; font-weight: bold;","color: #64748B; font-size: 12px;","color: #10B981; font-size: 12px;"),C(),w()},[w]),(0,s.useEffect)(()=>{i?S():p([])},[i]);let C=async()=>{try{c(!0);let e=await a("/api/projects");n(e||[]),e&&e.length>0&&!i&&o(e[0])}catch(e){console.error("Failed to load projects:",e),E("加载项目失败","error")}finally{c(!1)}},L=async()=>{try{let e;u(!0);let t=await (e=`Project ${l.length+1}`,a("/api/projects",{method:"POST",body:JSON.stringify({name:e})}));n(e=>[t,...e]),o(t),p([]),E("项目已创建","success")}catch(e){console.error("Failed to create project:",e),E("创建项目失败","error")}finally{u(!1)}},$=async e=>{if(confirm("确定要删除此项目吗？此操作无法撤销。"))try{let t;await (t=e,a(`/api/projects/${t}`,{method:"DELETE"})),n(t=>t.filter(t=>t.id!==e)),i?.id===e&&o(l.find(t=>t.id!==e)||null),E("项目已删除","success")}catch(e){console.error("Failed to delete project:",e),E("删除项目失败","error")}},S=async()=>{if(i)try{let e;j(!0);let t=await (e=i.id,a(`/api/documents/${e}`));p(t.documents||[])}catch(e){console.error("Failed to load documents:",e)}finally{j(!1)}},E=(e,t)=>{v({message:e,type:t})},_=async()=>{await new Promise(e=>setTimeout(e,500)),await S()},B=e=>{E(e,"success")},W=e=>{E(e,"error")};return(0,t.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-50",children:[(0,t.jsxs)("aside",{className:`bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ${e?"w-16":"w-72"}`,children:[(0,t.jsxs)("div",{className:"h-16 flex items-center justify-between px-4 border-b border-gray-200",children:[!e&&(0,t.jsx)("h1",{className:"font-semibold text-gray-900 truncate",children:"PetitionLetter"}),(0,t.jsx)("button",{onClick:()=>r(!e),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e?(0,t.jsx)(eh,{}):(0,t.jsx)(em,{})})]}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsxs)("button",{onClick:L,disabled:x,className:`w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 ${e?"px-2":""}`,children:[(0,t.jsx)(eu,{}),!e&&(0,t.jsx)("span",{children:"新建项目"})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:d?(0,t.jsx)("div",{className:"space-y-2",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-12 bg-gray-100 rounded-lg animate-pulse"},e))}):0===l.length?!e&&(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"暂无项目"}):(0,t.jsx)("div",{className:"space-y-1",children:l.map(s=>(0,t.jsxs)("div",{className:`group flex items-center gap-2 rounded-lg transition-colors ${i?.id===s.id?"bg-blue-50 text-blue-600":"hover:bg-gray-100 text-gray-700"}`,children:[(0,t.jsxs)("button",{onClick:()=>o(s),className:"flex-1 flex items-center gap-3 px-3 py-2.5 text-left",children:[(0,t.jsx)(ex,{}),!e&&(0,t.jsx)("span",{className:"truncate text-sm font-medium",children:s.name})]}),!e&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),$(s.id)},className:"p-1.5 mr-2 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-all",children:(0,t.jsx)(eg,{})})]},s.id))})}),(0,t.jsx)("div",{className:"p-3 border-t border-gray-200",children:(0,t.jsxs)("div",{className:`flex items-center gap-2 ${e?"justify-center":""}`,children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${"online"===f?"bg-green-500":"offline"===f?"bg-red-500":"bg-yellow-500 animate-pulse"}`}),!e&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"online"===f?"已连接":"offline"===f?"已断开":"检查中..."})]})})]}),(0,t.jsxs)("main",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,t.jsxs)("header",{className:"h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 flex-shrink-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:i?.name||"选择一个项目"}),i&&(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[h.length," 个文档 | 三模块流水线"]})]}),i&&(0,t.jsxs)("button",{onClick:S,disabled:g,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:[(0,t.jsx)(ep,{}),"刷新"]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[k&&!k.is_ready&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto mb-4",children:(0,t.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("svg",{className:"w-5 h-5 text-amber-600 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-amber-800",children:"模型加载中，请稍候..."}),(0,t.jsxs)("div",{className:"flex gap-4 mt-1 text-xs text-amber-600",children:[(0,t.jsxs)("span",{children:["OCR: ","loaded"===k.models.ocr.status?"✓ 已加载":"loading"===k.models.ocr.status?`加载中 ${k.models.ocr.progress}%`:"error"===k.models.ocr.status?`✗ 错误`:"等待"]}),(0,t.jsxs)("span",{children:["LLM: ","loaded"===k.models.llm.status?"✓ 已加载":"loading"===k.models.llm.status?`加载中 ${k.models.llm.progress}%`:"error"===k.models.llm.status?`✗ 错误`:"等待"]})]})]})]})})}),i?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,t.jsx)(N,{projectId:i.id,documents:h,onUploadComplete:_,onSuccess:B,onError:W}),(0,t.jsx)(M,{projectId:i.id,documents:h,onOCRComplete:()=>{S()},onSuccess:B,onError:W,modelsReady:k?.models?.ocr?.status==="loaded"}),(0,t.jsx)(D,{projectId:i.id,documents:h,onHighlightComplete:()=>{S()},onSuccess:B,onError:W,modelsReady:k?.models?.llm?.status==="loaded"}),(0,t.jsx)(X,{projectId:i.id,onSuccess:B,onError:W}),(0,t.jsx)(ec,{projectId:i.id,onSuccess:B,onError:W}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"后续模块"}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Petition Letter 写作"})]})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center text-blue-500 mx-auto mb-4",children:(0,t.jsx)(ex,{})}),(0,t.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"未选择项目"}),(0,t.jsx)("p",{className:"text-gray-500 mt-2",children:"创建或选择一个项目开始使用"}),(0,t.jsx)("button",{onClick:L,className:"mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"创建新项目"})]})})]})]}),y&&(0,t.jsx)(ej,{message:y.message,type:y.type,onClose:()=>v(null)})]})}e.s(["default",()=>ef],52683)}]);
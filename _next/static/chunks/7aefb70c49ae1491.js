(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20468,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566);let a=["A","B","C"];function l({folderName:e,documents:r,selectedDocs:a,onSelectDoc:l,onViewOCR:n,defaultExpanded:i=!0}){let[o,d]=(0,s.useState)(i),c=r.filter(e=>a.includes(e.id)).length,x=r.filter(e=>"completed"===e.ocr_status).length;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>d(!o),className:"w-full px-4 py-3 bg-gray-50 flex items-center justify-between hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform ${o?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,t.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})}),(0,t.jsxs)("span",{className:"font-semibold text-gray-900",children:["Folder ",e]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["(",r.length," files)"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[c>0&&(0,t.jsxs)("span",{className:"text-xs text-blue-600 font-medium",children:[c," selected"]}),(0,t.jsxs)("span",{className:"text-xs text-gray-600",children:[x,"/",r.length," OCR done"]})]})]}),o&&r.length>0&&(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:r.map(e=>{var s;let r;return(0,t.jsxs)("div",{className:`flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 ${a.includes(e.id)?"bg-blue-50":""}`,children:[(0,t.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>l(e.id),className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,t.jsx)("span",{className:"font-mono text-sm text-blue-600 w-12",children:e.exhibit_number||"-"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm text-gray-900 truncate",title:e.file_name,children:e.file_name}),e.exhibit_title&&e.exhibit_title!==e.file_name&&(0,t.jsx)("div",{className:"text-xs text-gray-600 truncate",title:e.exhibit_title,children:e.exhibit_title})]}),(0,t.jsxs)("span",{className:"text-xs text-gray-600 w-12 text-center",children:[e.page_count||1," pg"]}),(0,t.jsx)("div",{className:"w-24",children:(s=e.ocr_status,r={completed:"bg-green-100 text-green-800",processing:"bg-yellow-100 text-yellow-800",pending:"bg-gray-100 text-gray-800",failed:"bg-red-100 text-red-800"},(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${r[s]||r.pending}`,children:{completed:"Completed",processing:"Processing...",pending:"Pending",failed:"Failed"}[s]||s}))}),(0,t.jsx)("button",{onClick:()=>n(e),disabled:"completed"!==e.ocr_status,className:"text-xs text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed px-2 py-1",children:"View"})]},e.id)})}),o&&0===r.length&&(0,t.jsxs)("div",{className:"px-4 py-6 text-center text-gray-500 text-sm",children:['No documents in this folder. Upload files with exhibit numbers starting with "',e,'-".']})]})}function n({documents:e,selectedDocs:r,onSelectDoc:n,onSelectAll:i,onViewOCR:o,loading:d=!1}){let c=(0,s.useMemo)(()=>{let t={};return a.forEach(e=>{t[e]=[]}),e.forEach(e=>{let s=(e=>{if(!e)return"Other";let t=e.match(/^([A-Z])-\d+$/i);return t?t[1].toUpperCase():"Other"})(e.exhibit_number);t[s]||(t[s]=[]),t[s].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>parseInt(e.exhibit_number?.match(/-(\d+)$/)?.[1]||"0")-parseInt(t.exhibit_number?.match(/-(\d+)$/)?.[1]||"0"))}),t},[e]),x=(0,s.useMemo)(()=>{let e=new Set(a);return Object.keys(c).forEach(t=>e.add(t)),Array.from(e).sort((e,t)=>"Other"===e?1:"Other"===t?-1:e.localeCompare(t))},[c]),m=e.length>0&&r.length===e.length;return d?(0,t.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,t.jsx)("span",{className:"ml-3 text-gray-800",children:"Loading documents..."})]})}):(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"checkbox",checked:m,onChange:i,className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-900",children:["Documents (",e.length,")"]})]}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[r.length," selected"]})]})}),(0,t.jsxs)("div",{className:"p-4 space-y-3",children:[x.map(e=>(0,t.jsx)(l,{folderName:e,documents:c[e]||[],selectedDocs:r,onSelectDoc:n,onViewOCR:o,defaultExpanded:!1},e)),0===e.length&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-600",children:"No documents yet. Upload files to get started."})]})]})}var i=e.i(18279);let o=["A","B","C","D","E","F","G","H"];function d({projectId:e,onUploadComplete:r,onError:a,onSuccess:l}){let[n,d]=(0,s.useState)(!1),[c,x]=(0,s.useState)([]),[m,u]=(0,s.useState)(!1),[h,g]=(0,s.useState)("A"),[p,b]=(0,s.useState)(1),y=(0,s.useRef)(null),f=(0,s.useCallback)(e=>{if(!e||0===e.length)return;let t=[],s=p;for(let r=0;r<e.length;r++){let a=e[r];(["application/pdf","image/png","image/jpeg","image/jpg","image/tiff"].includes(a.type)||a.name.match(/\.(pdf|png|jpg|jpeg|tiff?)$/i))&&(t.push({file:a,exhibitNumber:`${h}-${s}`,status:"pending"}),s++)}t.length>0&&(x(e=>[...e,...t]),b(s),d(!0))},[h,p]),j=async()=>{if(0===c.filter(e=>"pending"===e.status).length)return;let t=0,s=0;for(let r=0;r<c.length;r++){let a=c[r];if("pending"===a.status){x(e=>{let t=[...e];return t[r]={...t[r],status:"uploading"},t});try{await i.documentApi.upload(e,a.file,a.exhibitNumber,a.file.name.replace(/\.[^/.]+$/,"")),x(e=>{let t=[...e];return t[r]={...t[r],status:"completed"},t}),t++}catch(e){x(t=>{let s=[...t];return s[r]={...s[r],status:"failed",error:e.message},s}),s++}}}t>0&&(l(`Uploaded ${t} file(s). Click "Start OCR" to begin processing.`),r()),s>0&&a(`${s} file(s) failed to upload.`),setTimeout(()=>{x(e=>e.filter(e=>"completed"!==e.status))},2e3)};return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Upload Documents"}),c.length>0&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded-full",children:[c.length," file(s)"]})]}),(0,t.jsx)("button",{onClick:()=>d(!n),className:"text-gray-500 hover:text-gray-700",children:(0,t.jsx)("svg",{className:`w-5 h-5 transition-transform ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),n&&(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{onDragOver:e=>{e.preventDefault(),u(!0)},onDragLeave:e=>{e.preventDefault(),u(!1)},onDrop:e=>{e.preventDefault(),u(!1),f(e.dataTransfer.files)},onClick:()=>y.current?.click(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${m?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:[(0,t.jsx)("input",{ref:y,type:"file",multiple:!0,accept:".pdf,.png,.jpg,.jpeg,.tiff,.tif",onChange:e=>f(e.target.files),className:"hidden"}),(0,t.jsx)("svg",{className:"w-10 h-10 mx-auto text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,t.jsx)("p",{className:"text-sm text-gray-700 font-medium",children:"Drop files here or click to browse"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Supports PDF, PNG, JPG, TIFF"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium",children:"Target Folder:"}),(0,t.jsx)("div",{className:"flex gap-1",children:o.map(e=>(0,t.jsx)("button",{onClick:()=>{g(e),b(1)},className:`w-8 h-8 text-xs font-semibold rounded transition-colors ${h===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e},e))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium",children:"Starting #:"}),(0,t.jsx)("input",{type:"number",min:"1",value:p,onChange:e=>b(parseInt(e.target.value)||1),className:"w-16 text-xs border border-gray-300 rounded px-2 py-1 text-gray-900 bg-white text-center"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["Next: ",(0,t.jsxs)("span",{className:"font-mono font-semibold text-blue-600",children:[h,"-",p]})]})]}),c.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-700",children:"Files to upload:"}),(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2",children:c.map((e,s)=>(0,t.jsxs)("div",{className:`flex items-center gap-2 p-2 rounded border ${"completed"===e.status?"bg-green-50 border-green-200":"failed"===e.status?"bg-red-50 border-red-200":"uploading"===e.status?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:"uploading"===e.status?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):"completed"===e.status?(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):"failed"===e.status?(0,t.jsx)("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,t.jsx)("input",{type:"text",value:e.exhibitNumber,onChange:e=>{var t;return t=e.target.value,void x(e=>{let r=[...e];return r[s]={...r[s],exhibitNumber:t},r})},disabled:"pending"!==e.status,className:"w-16 text-xs border border-gray-300 rounded px-1.5 py-0.5 text-gray-900 bg-white disabled:bg-gray-100"}),(0,t.jsx)("span",{className:"flex-1 text-xs text-gray-800 truncate",title:e.file.name,children:e.file.name}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[(e.file.size/1024).toFixed(0)," KB"]}),"pending"===e.status&&(0,t.jsx)("button",{onClick:()=>{x(e=>e.filter((e,t)=>t!==s))},className:"text-gray-400 hover:text-red-600",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,t.jsx)("button",{onClick:()=>{x([])},className:"px-3 py-1.5 text-xs text-gray-600 hover:text-gray-800",children:"Clear All"}),(0,t.jsxs)("button",{onClick:j,disabled:0===c.filter(e=>"pending"===e.status).length,className:"px-4 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload Files"]})]})]})]})]})}var c=e.i(24994);function x({documents:e,selectedDocs:r,onAnalysisComplete:a,onAutoAnalyze:l,isAnalyzing:n=!1}){let[i,o]=(0,s.useState)("manual"),[d,x]=(0,s.useState)(""),[m,u]=(0,s.useState)(""),[h,g]=(0,s.useState)(null),[p,b]=(0,s.useState)(0),[y,f]=(0,s.useState)(!1),[j,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),k=e.find(e=>e.id===d),C=(0,s.useCallback)(()=>k?(0,c.generateAnalysisPrompt)({exhibitId:k.exhibit_number||"X-1",fileName:k.file_name,documentText:""}):"",[k]),S=(0,s.useCallback)(()=>k?(0,c.generateCombinedPrompt)({exhibitId:k.exhibit_number||"X-1",fileName:k.file_name,documentText:k.ocr_text||""}):"",[k]),_=async(e,t)=>{await navigator.clipboard.writeText(e),"prompt"===t?(f(!0),setTimeout(()=>f(!1),2e3)):"ocr"===t?(v(!0),setTimeout(()=>v(!1),2e3)):(w(!0),setTimeout(()=>w(!1),2e3))},L=e.filter(e=>"completed"===e.ocr_status);return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"L-1 Analysis"}),(0,t.jsxs)("select",{value:d,onChange:e=>x(e.target.value),className:"text-sm border border-gray-300 rounded-lg px-3 py-1.5 bg-white text-gray-900 font-medium min-w-[280px]",children:[(0,t.jsx)("option",{value:"",className:"text-gray-900",children:"Select document..."}),L.map(e=>(0,t.jsxs)("option",{value:e.id,className:"text-gray-900",children:[e.exhibit_number||"X-?",": ",e.file_name.substring(0,40),e.file_name.length>40?"...":""]},e.id))]})]}),(0,t.jsxs)("div",{className:"flex bg-gray-200 rounded-lg p-0.5",children:[(0,t.jsx)("button",{onClick:()=>o("manual"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"manual"===i?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Manual"}),(0,t.jsx)("button",{onClick:()=>o("auto"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"auto"===i?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Auto"})]})]})}),(0,t.jsx)("div",{className:"p-4",children:"manual"===i?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-2 border-purple-200 bg-purple-50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Step 1: Copy to LLM"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"One click to copy both prompt instructions and OCR text. Paste directly into ChatGPT/Claude."})]}),(0,t.jsx)("button",{onClick:()=>_(S(),"combined"),disabled:!k?.ocr_text,className:"px-5 py-2.5 text-sm font-medium bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm",children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Prompt + OCR"]})})]}),k&&(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-xs text-gray-600",children:[(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:["Exhibit: ",k.exhibit_number]}),(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:["Pages: ",k.page_count]}),(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:["~",Math.round((k.ocr_text?.length||0)/4)," tokens"]})]})]}),(0,t.jsxs)("details",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsx)("summary",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer text-sm font-semibold text-gray-900 hover:bg-gray-100",children:"Preview: Prompt Template"}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("div",{className:"flex justify-end mb-2",children:(0,t.jsx)("button",{onClick:()=>_(C(),"prompt"),disabled:!k,className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 flex items-center gap-1",children:y?"Copied!":"Copy Prompt Only"})}),(0,t.jsx)("div",{className:"bg-gray-100 rounded p-3 max-h-48 overflow-y-auto border border-gray-200",children:(0,t.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap font-mono leading-relaxed",children:k?C():"Select a document from the dropdown above to see the prompt"})})]})]}),(0,t.jsxs)("details",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsx)("summary",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer text-sm font-semibold text-gray-900 hover:bg-gray-100",children:"Preview: OCR Text"}),(0,t.jsx)("div",{className:"p-3",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 font-medium",children:[(0,t.jsxs)("span",{children:["Exhibit: ",k.exhibit_number]}),(0,t.jsx)("span",{className:"text-gray-400",children:"|"}),(0,t.jsxs)("span",{children:["Pages: ",k.page_count]})]}),(0,t.jsx)("button",{onClick:()=>_(k?.ocr_text||"","ocr"),disabled:!k?.ocr_text,className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 flex items-center gap-1",children:j?"Copied!":"Copy OCR Only"})]}),(0,t.jsx)("div",{className:"bg-gray-100 rounded p-3 max-h-48 overflow-y-auto border border-gray-200",children:(0,t.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap font-mono leading-relaxed",children:k.ocr_text||"No OCR text available"})})]}):(0,t.jsx)("div",{className:"text-sm text-gray-600 text-center py-4 font-medium",children:"Select a document from the dropdown above to view its OCR text"})})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Step 2: Paste LLM Result"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:h?(0,t.jsx)("span",{className:"text-sm text-red-600 font-medium",children:h}):p>0?(0,t.jsxs)("span",{className:"text-sm text-green-600 font-medium",children:["Valid JSON - ",p," quotes found"]}):null})]}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("textarea",{value:m,onChange:e=>{var t;u(t=e.target.value),(e=>{if(!e.trim()){g(null),b(0);return}try{let t=JSON.parse(e),s=t.quotes||t;Array.isArray(s)?(g(null),b(s.length)):Array.isArray(t)?(g(null),b(t.length)):(g('Invalid format: expected { "quotes": [...] } or [...]'),b(0))}catch(e){g(`JSON Parse Error: ${e.message}`),b(0)}})(t)},placeholder:'Paste the JSON result from LLM here...  { "quotes": [ { "standard": "合格的公司关系", "standard_key": "qualifying_relationship", ... } ] }',className:"w-full h-40 p-3 text-sm font-mono border border-gray-300 rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder:text-gray-500"}),(0,t.jsx)("div",{className:"flex justify-end mt-3",children:(0,t.jsx)("button",{onClick:()=>{if(k&&m.trim()&&!h)try{let e=JSON.parse(m),t=e.quotes||e,s=(Array.isArray(t)?t:[]).map(e=>({...e,source:{exhibit_id:e.source?.exhibit_id||k.exhibit_number||"X-1",file_name:e.source?.file_name||k.file_name}})),r={document_id:k.id,exhibit_id:k.exhibit_number||"X-1",file_name:k.file_name,quotes:s};a([r]),u(""),b(0)}catch(e){g(`Failed to save: ${e.message}`)}},disabled:!k||!m.trim()||!!h,className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Save Analysis"})})]})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-800",children:"Select documents to analyze automatically using LLM API. This will cost API credits."}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Documents to Analyze"}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:r.length>0?`${r.length} selected`:`All ${L.length} documents`})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:L.map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:r.includes(e.id),onChange:()=>{},className:"w-4 h-4 text-blue-600 rounded border-gray-300",disabled:!0}),(0,t.jsx)("span",{className:"font-mono text-blue-700 font-medium",children:e.exhibit_number||"X-?"}),(0,t.jsx)("span",{className:"text-gray-900 truncate",children:e.file_name})]},e.id))}),(0,t.jsx)("p",{className:"text-sm text-gray-700 mt-3",children:"Use the document table above to select specific documents, or leave empty to analyze all."})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:()=>{let t=r.length>0?r:e.filter(e=>"completed"===e.ocr_status).map(e=>e.id);0!==t.length&&l(t)},disabled:n||0===L.length,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Analyzing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Start Analysis"]})})})]})})]})}function m(e){let t={};return Object.values(e).flat().forEach(e=>{let s=e.source.exhibit_id;t[s]||(t[s]={exhibit_id:s,file_name:e.source.file_name,quotes:[]}),t[s].quotes.push(e)}),JSON.stringify(Object.values(t),null,2)}function u({projectId:e,documentsCount:r,beneficiaryName:a="",quotesByStandard:l,onError:n,onSuccess:o,onAnalysisComplete:d}){let[c,x]=(0,s.useState)(!0),[u,h]=(0,s.useState)("manual"),[g,p]=(0,s.useState)(!1),[b,y]=(0,s.useState)(null),[f,j]=(0,s.useState)("entities"),[v,N]=(0,s.useState)(""),[w,k]=(0,s.useState)(null),[C,S]=(0,s.useState)(!1),[_,L]=(0,s.useState)(!1),A=Object.values(l).flat().length;(0,s.useEffect)(()=>{P()},[e]);let P=async()=>{try{let t=await i.relationshipApi.getLatest(e);t&&t.data&&t.data.entities&&y(t.data)}catch{}},E=(0,s.useCallback)(()=>{let e=`You are a Senior L-1 Immigration Paralegal. Analyze relationships between entities across the following L-1 visa evidence documents.

**L-1 Visa: 4 Core Legal Requirements:**
1. **Qualifying Corporate Relationship** - Parent/subsidiary/affiliate relationship between foreign and U.S. entities
2. **Qualifying Employment Abroad** - At least 1 year of continuous employment with the foreign entity in the past 3 years
3. **Qualifying Capacity** - L-1A (Executive/Managerial) or L-1B (Specialized Knowledge) role
4. **Doing Business (Active Operations)** - Both entities must be actively doing business
${a?`
Beneficiary: ${a}
`:""}
**DOCUMENTS WITH EXTRACTED QUOTES:**
[ANALYSIS_RESULTS_HERE]

**Your Task:**
Based on the quotes extracted from the documents above, identify:
1. **Entities**: People, companies, positions mentioned across documents
2. **Relations**: Relationships between entities (e.g., "employed_by", "owns", "subsidiary_of", "manages")
3. **Evidence Chains**: How the documents support each L-1 standard (qualifying_relationship, qualifying_employment, qualifying_capacity, doing_business)

**Return JSON:**
{
  "entities": [
    {"id": "e1", "type": "person|company|position", "name": "...", "documents": ["exhibit_id"], "attributes": {"role": "...", "title": "..."}}
  ],
  "relations": [
    {"source_id": "e1", "target_id": "e2", "relation_type": "employed_by|owns|subsidiary_of|manages|founded", "evidence": ["exhibit_id"], "description": "..."}
  ],
  "evidence_chains": [
    {"claim": "Qualifying Corporate Relationship|Qualifying Employment Abroad|Qualifying Capacity|Doing Business", "documents": ["exhibit_id"], "strength": "strong|moderate|weak", "reasoning": "..."}
  ]
}`,t=m(l);return e.replace("[ANALYSIS_RESULTS_HERE]",t)},[a,l]),M=async e=>{await navigator.clipboard.writeText(e),S(!0),setTimeout(()=>S(!1),2e3)},O=async()=>{if(v.trim()&&!w&&!_)try{L(!0);let t=JSON.parse(v),s=await i.relationshipApi.saveManual(e,{entities:t.entities||[],relations:t.relations||[],evidence_chains:t.evidence_chains||[]});s.success&&(y(t),o(`Saved relationship analysis: ${s.saved.entities} entities, ${s.saved.relations} relations`),N(""),d?.(t))}catch(t){let e=t.message;k(`Failed to save: ${e}`),n(`Failed to save relationship analysis: ${e}`)}finally{L(!1)}},T=async()=>{if(0===A)return void n("No analysis results to analyze. Run L-1 Analysis first.");try{p(!0);let t=await i.relationshipApi.analyze(e,a||void 0);t.success&&t.graph&&(y(t.graph),o(`Analyzed relationships: ${t.graph.entities.length} entities, ${t.graph.relations.length} relations`),d?.(t.graph))}catch(e){console.error("Relationship analysis failed:",e),n("Relationship analysis failed. Check your API connection.")}finally{p(!1)}},$=e=>({strong:"bg-green-100 text-green-800 border-green-300",moderate:"bg-yellow-100 text-yellow-800 border-yellow-300",weak:"bg-red-100 text-red-800 border-red-300"})[e.toLowerCase()]||"bg-gray-100 text-gray-800 border-gray-300";return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Relationship Analysis"}),b&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-700 rounded-full",children:[b.entities.length," entities"]})]}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:a?(0,t.jsxs)("span",{children:["Beneficiary: ",(0,t.jsx)("strong",{className:"text-gray-900",children:a})]}):(0,t.jsx)("span",{className:"text-yellow-600",children:"Set beneficiary name in header"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex bg-gray-200 rounded-lg p-0.5",children:[(0,t.jsx)("button",{onClick:()=>h("manual"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"manual"===u?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Manual"}),(0,t.jsx)("button",{onClick:()=>h("auto"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"auto"===u?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Auto"})]}),(0,t.jsx)("button",{onClick:()=>x(!c),className:"text-gray-500 hover:text-gray-700",children:(0,t.jsx)("svg",{className:`w-5 h-5 transition-transform ${c?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),c&&(0,t.jsxs)("div",{className:"p-4 space-y-4",children:["manual"===u?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-2 border-purple-200 bg-purple-50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Step 1: Copy to LLM"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Copy prompt + all analysis quotes. Paste directly into ChatGPT/Claude."})]}),(0,t.jsx)("button",{onClick:()=>M(E()),disabled:0===A,className:"px-5 py-2.5 text-sm font-medium bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm",children:C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Prompt + Analysis"]})})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-xs text-gray-600",children:[(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:[A," quotes from ",Object.keys(l).length," standards"]}),(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:["~",Math.round(E().length/4)," tokens"]})]})]}),(0,t.jsxs)("details",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("summary",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer text-sm font-semibold text-gray-900 hover:bg-gray-100",children:["Preview: Analysis Results (",A," quotes)"]}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)("div",{className:"bg-gray-100 rounded p-3 max-h-48 overflow-y-auto border border-gray-200",children:(0,t.jsx)("pre",{className:"text-xs text-gray-900 whitespace-pre-wrap font-mono leading-relaxed",children:A>0?m(l):"No analysis results yet. Run L-1 Analysis first."})})})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Step 2: Paste LLM Result"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:w?(0,t.jsx)("span",{className:"text-sm text-red-600 font-medium",children:w}):v.trim()&&!w?(0,t.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"Valid JSON"}):null})]}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("textarea",{value:v,onChange:e=>{var t;N(t=e.target.value),(e=>{if(!e.trim())return k(null);try{let t=JSON.parse(e);t.entities&&t.relations&&t.evidence_chains?k(null):k("Invalid format: expected { entities, relations, evidence_chains }")}catch(e){k(`JSON Parse Error: ${e.message}`)}})(t)},placeholder:`Paste the JSON result from LLM here...

{
  "entities": [...],
  "relations": [...],
  "evidence_chains": [...]
}`,className:"w-full h-40 p-3 text-sm font-mono border border-gray-300 rounded resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-500"}),(0,t.jsx)("div",{className:"flex justify-end mt-3",children:(0,t.jsx)("button",{onClick:O,disabled:!v.trim()||!!w||_,className:"px-4 py-2 text-sm font-medium bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):"Save Analysis"})})]})]})]}):(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-800 mb-4",children:["Automatically analyze relationships using LLM API. This will use the ",A," quotes from Analysis Results."]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:T,disabled:g||0===A,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Analyzing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Analyze Relationships"]})})})]})}),b&&(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Results"}),(0,t.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,t.jsxs)("button",{onClick:()=>j("entities"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${"entities"===f?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:["Entities (",b.entities.length,")"]}),(0,t.jsxs)("button",{onClick:()=>j("relations"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${"relations"===f?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:["Relations (",b.relations.length,")"]}),(0,t.jsxs)("button",{onClick:()=>j("chains"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${"chains"===f?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:["Evidence Chains (",b.evidence_chains.length,")"]})]}),"entities"===f&&(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:0===b.entities.length?(0,t.jsx)("p",{className:"text-sm text-gray-600 text-center py-4",children:"No entities found"}):b.entities.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${{person:"bg-blue-100 text-blue-800",company:"bg-green-100 text-green-800",position:"bg-purple-100 text-purple-800",amount:"bg-yellow-100 text-yellow-800",date:"bg-gray-100 text-gray-800"}[e.type.toLowerCase()]||"bg-gray-100 text-gray-800"}`,children:e.type}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.documents&&e.documents.length>0&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["Found in: ",e.documents.slice(0,3).join(", "),e.documents.length>3&&` +${e.documents.length-3} more`]})]})]},e.id||s))}),"relations"===f&&(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:0===b.relations.length?(0,t.jsx)("p",{className:"text-sm text-gray-600 text-center py-4",children:"No relations found"}):b.relations.map((e,s)=>{let r=b.entities.find(t=>t.id===e.source_id),a=b.entities.find(t=>t.id===e.target_id);return(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:r?.name||e.source_id}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 rounded",children:e.relation_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:a?.name||e.target_id})]}),e.description&&(0,t.jsx)("p",{className:"text-xs text-gray-700 mt-2",children:e.description}),e.evidence&&e.evidence.length>0&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["Evidence: ",e.evidence.slice(0,2).join(", "),e.evidence.length>2&&` +${e.evidence.length-2} more`]})]},s)})}),"chains"===f&&(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:0===b.evidence_chains.length?(0,t.jsx)("p",{className:"text-sm text-gray-600 text-center py-4",children:"No evidence chains found"}):b.evidence_chains.map((e,s)=>(0,t.jsxs)("div",{className:`p-3 rounded-lg border ${$(e.strength)}`,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.claim}),(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${$(e.strength)}`,children:e.strength})]}),e.reasoning&&(0,t.jsx)("p",{className:"text-xs text-gray-700 mt-2",children:e.reasoning}),e.documents&&e.documents.length>0&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-2",children:["Documents: ",e.documents.slice(0,3).join(", "),e.documents.length>3&&` +${e.documents.length-3} more`]})]},s))})]}),!b&&!g&&"auto"===u&&(0,t.jsxs)("div",{className:"text-center py-6 text-gray-600",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,t.jsx)("p",{className:"text-sm",children:'Click "Analyze Relationships" to discover entities and their connections.'}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Documents must be analyzed first (L-1 Analysis)."})]})]})]})}function h({quote:e,onViewDocument:r}){let[a,l]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded cursor-pointer hover:bg-blue-200 transition-colors",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.source.exhibit_id,e.page&&(0,t.jsxs)("span",{className:"text-blue-500",children:["p.",e.page]})]}),a&&(0,t.jsxs)("div",{className:"absolute z-50 bottom-full left-0 mb-2 w-72 bg-white rounded-lg shadow-xl border border-gray-200 p-3 animate-in fade-in slide-in-from-bottom-2 duration-200",children:[(0,t.jsx)("div",{className:"absolute -bottom-2 left-4 w-4 h-4 bg-white border-r border-b border-gray-200 transform rotate-45"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,t.jsx)("div",{className:"p-1.5 bg-blue-100 rounded",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"font-medium text-sm text-gray-900",children:["Exhibit ",e.source.exhibit_id]}),(0,t.jsx)("div",{className:"text-xs text-gray-700 truncate",children:e.source.file_name})]})]}),e.page&&(0,t.jsxs)("div",{className:"text-xs text-gray-700 mb-2",children:["Page ",e.page]}),(0,t.jsx)("div",{className:"text-xs text-gray-700 mb-3 line-clamp-2",children:e.relevance}),r&&(0,t.jsx)("button",{onClick:()=>r(e.source.exhibit_id),className:"w-full px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"View Document"})]})]})]})}function g({quote:e,onViewDocument:s}){return(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-800 mb-2 italic",children:["“",e.quote,"”"]}),(0,t.jsx)("div",{className:"text-xs text-gray-700 mb-2",children:e.relevance}),(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)(h,{quote:e,onViewDocument:s})})]})}function p({standardKey:e,quotes:r,onViewDocument:a}){let[l,n]=(0,s.useState)(!1),i=c.STANDARD_DISPLAY_NAMES[e]||{chinese:e,english:e};return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>n(!l),className:"w-full px-4 py-3 bg-gray-50 flex items-center justify-between hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform ${l?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:i.english}),(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["(",i.chinese,")"]})]}),(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded-full",children:[r.length," quotes"]})]}),l&&(0,t.jsx)("div",{className:"p-4 space-y-3",children:r.map((e,s)=>(0,t.jsx)(g,{quote:e,onViewDocument:a},s))})]})}function b({quotesByStandard:e,documents:r,onViewDocument:a}){let[l,n]=(0,s.useState)(""),i=new Set;Object.values(e).flat().forEach(e=>{i.add(e.source.exhibit_id)});let o=Object.entries(e).reduce((e,[t,s])=>{let r=l?s.filter(e=>e.source.exhibit_id===l):s;return r.length>0&&(e[t]=r),e},{}),d=Object.values(e).flat().length,c=Object.values(o).flat().length,x=["qualifying_relationship","qualifying_employment","qualifying_capacity","doing_business"],m=x.filter(e=>o[e]).map(e=>[e,o[e]]);return Object.entries(o).filter(([e])=>!x.includes(e)).forEach(e=>m.push(e)),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Analysis Results"}),(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-700 rounded-full",children:[c," / ",d," quotes"]})]}),(0,t.jsxs)("select",{value:l,onChange:e=>n(e.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 text-gray-900 bg-white",children:[(0,t.jsx)("option",{value:"",children:"All Documents"}),Array.from(i).sort().map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]})}),(0,t.jsx)("div",{className:"p-4 space-y-4",children:0===m.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-700",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"No analysis results yet."}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Run analysis on documents to see results here."})]}):m.map(([e,s])=>(0,t.jsx)(p,{standardKey:e,quotes:s,onViewDocument:a},e))})]})}function y({selectedSection:e,onTemplateSelect:r,activeTemplate:a}){let[l,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)([]),[x,m]=(0,s.useState)(!1),[u,h]=(0,s.useState)("auto"),[g,p]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),[f,j]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(""),[C,S]=(0,s.useState)(""),[_,L]=(0,s.useState)(""),[A,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{E()},[e]);let E=async()=>{try{m(!0);let t=await i.styleTemplateApi.list(e);d(t.templates)}catch(e){console.error("Failed to load templates:",e)}finally{m(!1)}},M=async()=>{if(g.trim())try{y(!0),N(null);let t=await i.styleTemplateApi.parse(e,g);j(t.parsed)}catch(e){N(e.message)}finally{y(!1)}},O=async()=>{if(f&&_.trim())try{P(!0),await i.styleTemplateApi.create({section:e,name:_,original_text:g,parsed_structure:JSON.stringify(f)}),p(""),j(null),L(""),await E()}catch(e){console.error("Failed to save template:",e)}finally{P(!1)}},T=async()=>{if(w.trim()&&_.trim())try{P(!0),await i.styleTemplateApi.create({section:e,name:_,original_text:w,parsed_structure:JSON.stringify({structure_analysis:C||"Manually created template",template:w,placeholders:[]})}),k(""),S(""),L(""),await E()}catch(e){console.error("Failed to save template:",e)}finally{P(!1)}},$=async e=>{if(confirm("Delete this template?"))try{await i.styleTemplateApi.delete(e),a?.id===e&&r(null),await E()}catch(e){console.error("Failed to delete template:",e)}},B=c.SECTION_TYPES.find(t=>t.key===e)?.label||e;return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden mb-4",children:[(0,t.jsxs)("button",{onClick:()=>n(!l),className:"w-full px-4 py-3 bg-purple-50 border-b border-purple-100 flex items-center justify-between hover:bg-purple-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})}),(0,t.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:"Style Templates"}),a&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-purple-200 text-purple-800 rounded-full",children:["Active: ",a.name]}),o.length>0&&!a&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-gray-200 text-gray-600 rounded-full",children:[o.length," saved"]})]}),(0,t.jsx)("svg",{className:`w-5 h-5 text-purple-600 transition-transform ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"text-xs text-gray-600 bg-gray-50 rounded p-3",children:["Paste a sample paragraph to extract its writing style. The template will guide LLM to write in a similar structure for ",(0,t.jsx)("strong",{children:B}),"."]}),o.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-700",children:"Saved Templates"}),(0,t.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:o.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-2 rounded border ${a?.id===e.id?"border-purple-400 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsxs)("button",{onClick:()=>{a?.id===e.id?r(null):r(e)},className:"flex-1 text-left",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[a?.id===e.id&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-purple-600 text-white rounded",children:"Active"}),(0,t.jsx)("button",{onClick:()=>$(e.id),className:"p-1 text-gray-400 hover:text-red-500",title:"Delete",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id))})]}),o.length>0&&(0,t.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Create New Template"})}),(0,t.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1 w-fit",children:[(0,t.jsx)("button",{onClick:()=>h("auto"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${"auto"===u?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Auto Parse"}),(0,t.jsx)("button",{onClick:()=>h("manual"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${"manual"===u?"bg-white text-purple-700 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Manual Input"})]}),"auto"===u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Paste Sample Paragraph"}),(0,t.jsx)("textarea",{value:g,onChange:e=>p(e.target.value),placeholder:"Paste a well-written paragraph from an approved petition letter...",className:"w-full h-32 p-3 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-400"})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:M,disabled:!g.trim()||b,className:"px-4 py-2 text-sm font-medium bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Parsing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Parse Structure"]})})})]}):(0,t.jsxs)("div",{className:"space-y-3 border border-purple-200 rounded-lg p-4 bg-purple-50/30",children:[(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Directly paste or type your template structure with placeholders like [COMPANY_NAME], [DATE], etc."}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Template Structure (with placeholders)"}),(0,t.jsx)("textarea",{value:w,onChange:e=>k(e.target.value),placeholder:"[COMPANY_NAME], a [STATE] corporation, was established on [DATE] as a wholly-owned subsidiary of [PARENT_COMPANY]...",className:"w-full h-32 p-3 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-400 font-mono"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Description (optional)"}),(0,t.jsx)("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"e.g., Formal two-paragraph structure with ownership details first...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-400"})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsx)("input",{type:"text",value:_,onChange:e=>L(e.target.value),placeholder:"Template name...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-400"}),(0,t.jsx)("button",{onClick:T,disabled:!w.trim()||!_.trim()||A,className:"px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save"]})})]})]}),v&&(0,t.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:v}),f&&(0,t.jsxs)("div",{className:"space-y-3 border border-purple-200 rounded-lg p-4 bg-purple-50/50",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-purple-900",children:"Parsed Structure"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Analysis"}),(0,t.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:f.structure_analysis})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Template with Placeholders"}),(0,t.jsx)("div",{className:"mt-1 p-3 bg-white rounded border border-gray-200 text-sm text-gray-800 whitespace-pre-wrap max-h-48 overflow-y-auto",children:f.template})]}),f.placeholders&&f.placeholders.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Placeholders"}),(0,t.jsx)("div",{className:"mt-1 space-y-1",children:f.placeholders.map((e,s)=>(0,t.jsxs)("div",{className:"text-xs bg-white p-2 rounded border border-gray-200",children:[(0,t.jsx)("span",{className:"font-mono text-purple-600",children:e.name}),(0,t.jsxs)("span",{className:"text-gray-500 ml-2",children:["- ",e.description]})]},s))})]}),(0,t.jsxs)("div",{className:"border-t border-purple-200 pt-3 mt-3",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Template Name"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:_,onChange:e=>L(e.target.value),placeholder:"e.g., Formal Corporate Style",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900 placeholder:text-gray-400"}),(0,t.jsx)("button",{onClick:O,disabled:!_.trim()||A,className:"px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save Template"]})})]})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:()=>{j(null),L("")},className:"text-xs text-gray-500 hover:text-gray-700",children:"Discard"})})]})]})]})}function f(e){return JSON.stringify(e.map(e=>({quote:e.quote,relevance:e.relevance,l1_standard:e.standard_en||e.standard||"unknown",source:{exhibit_id:e.source.exhibit_id,file_name:e.source.file_name}})),null,2)}function j({projectId:e,onGenerate:r,isGenerating:a=!1,beneficiaryName:l="",quotesByStandard:n,initialPetitionerName:o="",initialForeignEntityName:d="",onEntityNamesChange:x}){let[m,u]=(0,s.useState)("manual"),[h,g]=(0,s.useState)(c.SECTION_TYPES[0].key),[p,b]=(0,s.useState)({}),[j,v]=(0,s.useState)({}),[N,w]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!0),[L,A]=(0,s.useState)(o),[P,E]=(0,s.useState)(d),M=p[h]||[],O=j[h]||null;(0,s.useEffect)(()=>{T()},[e]);let T=async()=>{try{_(!0);let t=await i.writingApi.getAllWriting(e);if(t?.sections){let e={},s={};for(let[r,a]of Object.entries(t.sections)){let t={id:a.version_id||`saved-${r}`,version:1,text:a.text,citations:a.citations||[],created_at:a.timestamp||new Date().toISOString()};e[r]=[t],s[r]=t.id}b(e),v(s)}}catch(e){console.log("No saved writing yet")}finally{_(!1)}};(0,s.useEffect)(()=>{o&&A(o)},[o]),(0,s.useEffect)(()=>{d&&E(d)},[d]);let $=()=>{x?.(L,P)},[B,F]=(0,s.useState)(""),[R,D]=(0,s.useState)(null),[z,q]=(0,s.useState)(!1),[W,V]=(0,s.useState)(!1),[I,H]=(0,s.useState)(null),J=M.find(e=>e.id===O),U=function(e){let t=[];for(let s of Object.keys(e))e[s]&&t.push(...e[s]);return t}(n),G=U.length,Y=(0,s.useCallback)(()=>{let e,t=f(U);if(I)try{e=JSON.parse(I.parsed_structure).template}catch{e=I.parsed_structure}return(0,c.generateSectionWritingPrompt)(h,t,{petitionerName:L,foreignEntityName:P,beneficiaryName:l},e)},[h,l,L,P,U,I]),X=async e=>{await navigator.clipboard.writeText(e),q(!0),setTimeout(()=>q(!1),2e3)},Q=e=>{b(t=>({...t,[h]:[...t[h]||[],e]})),v(t=>({...t,[h]:e.id}))},K=async()=>{if(B.trim()&&!R&&!W)try{V(!0);let t=JSON.parse(B);if((await i.writingApi.saveManual(e,h,t.paragraph_text,t.citations_used||[])).success){let e={id:`v${Date.now()}`,version:M.length+1,text:t.paragraph_text,citations:t.citations_used||[],created_at:new Date().toISOString()};Q(e),F("")}}catch(t){let e=t.message;D(`Failed to save: ${e}`)}finally{V(!1)}},Z=async()=>{try{let e=await r(h,l||void 0),t={id:`v${Date.now()}`,version:M.length+1,text:e.text,citations:e.citations,created_at:new Date().toISOString()};Q(t)}catch(e){console.error("Generate failed:",e)}},ee=async()=>{if(N.trim()&&J)try{let e=await r(h,l||void 0),t={id:`v${Date.now()}`,version:M.length+1,text:e.text,citations:e.citations,created_at:new Date().toISOString(),revision_instruction:N};Q(t),w("")}catch(e){console.error("Regenerate failed:",e)}},et=async()=>{J&&await navigator.clipboard.writeText(J.text)};return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Paragraph Generation"}),M.length>0&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full",children:[M.length," version",M.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex bg-gray-200 rounded-lg p-0.5",children:[(0,t.jsx)("button",{onClick:()=>u("manual"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"manual"===m?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Manual"}),(0,t.jsx)("button",{onClick:()=>u("auto"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"auto"===m?"bg-white text-gray-900 shadow-sm":"text-gray-700 hover:text-gray-900"}`,children:"Auto"})]}),M.length>0&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>C(!k),className:"px-2 py-1 text-xs bg-gray-100 rounded flex items-center gap-1 hover:bg-gray-200",children:[(0,t.jsxs)("span",{children:["v",J?.version||1]}),(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&(0,t.jsxs)("div",{className:"absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[(0,t.jsx)("div",{className:"p-2 border-b border-gray-100",children:(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Version History"})}),(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto",children:M.map(e=>(0,t.jsxs)("button",{onClick:()=>{var t;return t=e.id,void(v(e=>({...e,[h]:t})),C(!1))},className:`w-full px-3 py-2 text-left text-xs hover:bg-gray-50 ${e.id===O?"bg-blue-50 text-blue-600":"text-gray-800"}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"font-medium",children:["Version ",e.version]}),e.revision_instruction&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-800 rounded text-[10px]",children:"Revised"})]}),(0,t.jsx)("div",{className:"text-gray-600 text-[10px] mt-0.5",children:new Date(e.created_at).toLocaleTimeString()})]},e.id))})]})]})]})]})}),(0,t.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium",children:"Section:"}),(0,t.jsx)("select",{value:h,onChange:e=>g(e.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 text-gray-900 bg-white",children:c.SECTION_TYPES.map(e=>(0,t.jsx)("option",{value:e.key,children:e.label},e.key))})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[G," total quotes available"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium whitespace-nowrap",children:"Petitioner (US):"}),(0,t.jsx)("input",{type:"text",value:L,onChange:e=>{A(e.target.value)},onBlur:$,placeholder:"e.g., ABC Corp.",className:"w-40 px-2 py-1 text-xs border border-gray-300 rounded text-gray-900 bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium whitespace-nowrap",children:"Foreign Entity:"}),(0,t.jsx)("input",{type:"text",value:P,onChange:e=>{E(e.target.value)},onBlur:$,placeholder:"e.g., XYZ Ltd.",className:"w-40 px-2 py-1 text-xs border border-gray-300 rounded text-gray-900 bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:l?(0,t.jsxs)("span",{children:["Beneficiary: ",(0,t.jsx)("strong",{className:"text-gray-900",children:l})]}):(0,t.jsx)("span",{className:"text-yellow-600",children:"Set beneficiary name in header ↑"})})]})]}),(0,t.jsx)("div",{className:"px-4 pt-4",children:(0,t.jsx)(y,{selectedSection:h,onTemplateSelect:H,activeTemplate:I})}),(0,t.jsxs)("div",{className:"p-4 space-y-4",children:["manual"===m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-2 border-green-200 bg-green-50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Step 1: Copy to LLM"}),(0,t.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:['Copy prompt + evidence for "',c.SECTION_TYPES.find(e=>e.key===h)?.label,'". Paste into ChatGPT/Claude.']})]}),(0,t.jsx)("button",{onClick:()=>X(Y()),disabled:0===G,className:"px-5 py-2.5 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm",children:z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Prompt + Evidence"]})})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-xs text-gray-600",children:[(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:[G," total quotes (LLM will select relevant ones)"]}),(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-white rounded border border-gray-200",children:["~",Math.round(Y().length/4)," tokens"]})]})]}),(0,t.jsxs)("details",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("summary",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer text-sm font-semibold text-gray-900 hover:bg-gray-100",children:["Preview: All Evidence (",G," quotes)"]}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)("div",{className:"bg-gray-100 rounded p-3 max-h-48 overflow-y-auto border border-gray-200",children:(0,t.jsx)("pre",{className:"text-xs text-gray-900 whitespace-pre-wrap font-mono leading-relaxed",children:G>0?f(U):"No quotes available. Run L-1 Analysis first."})})})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Step 2: Paste LLM Result"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:R?(0,t.jsx)("span",{className:"text-sm text-red-600 font-medium",children:R}):B.trim()&&!R?(0,t.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"Valid JSON"}):null})]}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("textarea",{value:B,onChange:e=>{var t;F(t=e.target.value),(e=>{if(!e.trim())return D(null);try{let t=JSON.parse(e);t.paragraph_text&&t.citations_used?D(null):D("Invalid format: expected { paragraph_text, citations_used }")}catch(e){D(`JSON Parse Error: ${e.message}`)}})(t)},placeholder:`Paste the JSON result from LLM here...

{
  "paragraph_text": "...",
  "citations_used": [...]
}`,className:"w-full h-40 p-3 text-sm font-mono border border-gray-300 rounded resize-none focus:ring-2 focus:ring-green-500 focus:border-green-500 text-gray-900 placeholder:text-gray-500"}),(0,t.jsx)("div",{className:"flex justify-end mt-3",children:(0,t.jsx)("button",{onClick:K,disabled:!B.trim()||!!R||W,className:"px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:W?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):"Save Paragraph"})})]})]})]}):(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-800 mb-4",children:["Automatically generate paragraph using LLM API. LLM will select relevant quotes from all ",G,' available quotes for "',c.SECTION_TYPES.find(e=>e.key===h)?.label,'".']}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:Z,disabled:a||0===G,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Generate Paragraph"]})})})]})}),J&&(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Generated Paragraph"}),(0,t.jsxs)("button",{onClick:et,className:"px-3 py-1 text-xs text-gray-700 hover:text-gray-900 flex items-center gap-1 hover:bg-gray-100 rounded",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})]}),(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:(0,t.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",children:(e=>{let s,r=/\[Exhibit ([A-Z]-\d+)(?::\s*([^\]]+))?\]/g,a=[],l=0;for(;null!==(s=r.exec(e));){s.index>l&&a.push(e.slice(l,s.index));let r=s[1],n=s[2],i=J?.citations.find(e=>e.exhibit===r);a.push((0,t.jsxs)("span",{className:"relative group inline-block",children:[(0,t.jsxs)("span",{className:"text-blue-600 cursor-pointer hover:bg-blue-50 px-0.5 rounded",children:["[Exhibit ",r,n?`: ${n}`:"","]"]}),(0,t.jsxs)("div",{className:"absolute z-50 bottom-full left-0 mb-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute -bottom-2 left-4 w-4 h-4 bg-white border-r border-b border-gray-200 transform rotate-45"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsxs)("span",{className:"font-medium text-sm text-gray-900",children:["Exhibit ",r]})]}),i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:i.file_name}),(0,t.jsxs)("div",{className:"text-xs text-gray-600 line-clamp-3 italic",children:["“",i.quote,"”"]}),i.claim&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supports: ",i.claim]})]})]})]})]},s.index)),l=s.index+s[0].length}return l<e.length&&a.push(e.slice(l)),a})(J.text)})}),(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,t.jsx)("label",{className:"text-xs text-gray-700 font-medium mb-2 block",children:"Revision Instructions"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"e.g., Make it more formal, add more specific dates...",className:"flex-1 text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500 text-gray-900 bg-white placeholder:text-gray-500"}),(0,t.jsxs)("button",{onClick:ee,disabled:a||!N.trim(),className:"px-4 py-2 text-sm bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerate"]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Enter instructions to revise the current version. This creates a new version based on your feedback."})]}),J.citations.length>0&&(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold text-gray-800 mb-2",children:["Citations Used (",J.citations.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:J.citations.map((e,s)=>(0,t.jsxs)("div",{className:"text-xs bg-gray-50 rounded p-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"font-mono text-blue-600",children:["[Exhibit ",e.exhibit,"]"]}),(0,t.jsx)("span",{className:"text-gray-700",children:e.file_name})]}),(0,t.jsxs)("div",{className:"text-gray-700 mt-1 italic line-clamp-2",children:["“",e.quote,"”"]})]},s))})]})]}),!J&&"auto"===m&&(0,t.jsxs)("div",{className:"text-center py-12 text-gray-700",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),(0,t.jsx)("p",{className:"text-sm",children:"No paragraph generated yet."}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Select a section and click Generate to create a paragraph."})]})]})]})}function v({isOpen:e,onClose:r,title:a,children:l,size:n="md"}){let i=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let t=e=>{"Escape"===e.key&&r()};return e&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow="unset"}},[e,r]),e)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),(0,t.jsxs)("div",{ref:i,className:`relative bg-white rounded-lg shadow-xl ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-6xl"}[n]} w-full mx-4 max-h-[90vh] flex flex-col`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:a}),(0,t.jsx)("button",{onClick:r,className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:l})]})]}):null}var N=e.i(83036);function w(){let e=(0,r.useParams)(),a=(0,r.useRouter)(),l=e.id,[o,c]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),[g,p]=(0,s.useState)([]),[y,f]=(0,s.useState)([]),[w,k]=(0,s.useState)({}),[C,S]=(0,s.useState)(!0),[_,L]=(0,s.useState)(!1),[A,P]=(0,s.useState)(!1),[E,M]=(0,s.useState)(null),[O,T]=(0,s.useState)(null),[$,B]=(0,s.useState)(""),[F,R]=(0,s.useState)(!1),[D,z]=(0,s.useState)({petitionerName:"",foreignEntityName:"",beneficiaryName:""});(0,s.useEffect)(()=>{l&&(q(),V(),I())},[l]);let q=async()=>{try{h(!0);let e=await i.projectApi.getProject(l);e&&(c(e),e.beneficiaryName&&B(e.beneficiaryName),z({petitionerName:e.petitionerName||"",foreignEntityName:e.foreignEntityName||"",beneficiaryName:e.beneficiaryName||""}))}catch(e){console.error("Failed to load project:",e),a.push("/")}finally{h(!1)}},W=async()=>{if($.trim())try{R(!0),await i.projectApi.updateProject(l,{beneficiaryName:$.trim()}),U("Beneficiary name saved","success")}catch(e){console.error("Failed to save beneficiary name:",e),U("Failed to save beneficiary name","error")}finally{R(!1)}},V=async()=>{try{S(!0);let e=await i.documentApi.getDocuments(l);p(e.documents||[])}catch(e){console.error("Failed to load documents:",e),U("Failed to load documents","error")}finally{S(!1)}},I=async()=>{try{let e=await i.analysisApi.getSummary(l);e?.by_standard&&k(e.by_standard)}catch(e){console.log("No analysis results yet")}},H=(0,s.useCallback)(async e=>{let t=e.entities,s=t.find(e=>("Organization"===e.type||"company"===e.type)&&(e.attributes?.role==="U.S. Petitioner"||e.attributes?.role==="Subsidiary"||String(e.attributes?.role||"").includes("Petitioner")||String(e.attributes?.role||"").includes("Subsidiary"))),r=t.find(e=>("Organization"===e.type||"company"===e.type)&&(e.attributes?.role==="Foreign Parent"||e.attributes?.role==="Parent Company"||String(e.attributes?.role||"").includes("Parent")||String(e.attributes?.role||"").includes("Foreign"))),a=t.find(e=>("Person"===e.type||"person"===e.type)&&(e.attributes?.role==="Beneficiary"||String(e.attributes?.role||"").includes("Beneficiary"))),n={petitionerName:s?.name||"",foreignEntityName:r?.name||"",beneficiaryName:a?.name||""};z(n),a?.name&&!$&&B(a.name);try{await i.projectApi.updateProject(l,{petitionerName:n.petitionerName||void 0,foreignEntityName:n.foreignEntityName||void 0,beneficiaryName:n.beneficiaryName||void 0})}catch(e){console.error("Failed to save entity names:",e)}},[$,l]),J=(0,s.useCallback)(async(e,t)=>{z(s=>({...s,petitionerName:e,foreignEntityName:t}));try{await i.projectApi.updateProject(l,{petitionerName:e||void 0,foreignEntityName:t||void 0})}catch(e){console.error("Failed to save entity names:",e)}},[l]),U=(e,t)=>{T({message:e,type:t})},G=(0,s.useCallback)(async e=>{try{await i.analysisApi.saveManualAnalysis(l,e.map(e=>({document_id:e.document_id,exhibit_id:e.exhibit_id,file_name:e.file_name,quotes:e.quotes}))),await i.analysisApi.generateSummary(l),await I(),U(`Saved ${e.length} document analysis`,"success")}catch(e){console.error("Failed to save analysis:",e),U("Failed to save analysis","error")}},[l]),Y=async e=>{try{L(!0);let t=await i.analysisApi.analyzeDocuments(l,e);t.success&&(await i.analysisApi.generateSummary(l),await I(),U(`Analyzed ${t.total_docs_analyzed} documents, found ${t.total_quotes_found} quotes`,"success"))}catch(e){console.error("Auto analysis failed:",e),U("Auto analysis failed","error")}finally{L(!1)}},X=async(e,t)=>{try{P(!0);let s=await i.writingApi.generateParagraph(l,e,t);if(s.success)return{text:s.paragraph.text,citations:s.paragraph.citations};throw Error("Generation failed")}catch(e){throw console.error("Generation failed:",e),U("Paragraph generation failed","error"),e}finally{P(!1)}};return m?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>a.push("/"),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Projects",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:o.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"L-1 Visa Evidence Analyzer"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-600",children:"Beneficiary:"}),(0,t.jsx)("input",{type:"text",value:$,onChange:e=>B(e.target.value),onBlur:W,onKeyDown:e=>"Enter"===e.key&&W(),placeholder:"Enter beneficiary name",className:"w-40 px-2 py-1 text-sm border border-gray-300 rounded text-gray-900 bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),F&&(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})]}),(0,t.jsx)("span",{className:"text-xs text-gray-400 font-mono",children:l}),(0,t.jsx)("button",{onClick:V,className:"px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Refresh"})]})]})})}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[(0,t.jsx)("section",{children:(0,t.jsx)(d,{projectId:l,onUploadComplete:V,onError:e=>U(e,"error"),onSuccess:e=>U(e,"success")})}),(0,t.jsx)("section",{children:(0,t.jsx)(n,{documents:g,selectedDocs:y,onSelectDoc:e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onSelectAll:()=>{y.length===g.length?f([]):f(g.map(e=>e.id))},onViewOCR:e=>{M(e)},loading:C})}),(0,t.jsx)("section",{children:(0,t.jsx)(x,{documents:g,selectedDocs:y,onAnalysisComplete:G,onAutoAnalyze:Y,isAnalyzing:_})}),(0,t.jsx)("section",{children:(0,t.jsx)(b,{quotesByStandard:w,documents:g,onViewDocument:e=>{let t=g.find(t=>t.exhibit_number===e);t&&M(t)}})}),(0,t.jsx)("section",{children:(0,t.jsx)(u,{projectId:l,documentsCount:g.length,beneficiaryName:$,quotesByStandard:w,onError:e=>U(e,"error"),onSuccess:e=>U(e,"success"),onAnalysisComplete:H})}),(0,t.jsx)("section",{children:(0,t.jsx)(j,{projectId:l,onGenerate:X,isGenerating:A,beneficiaryName:$,quotesByStandard:w,initialPetitionerName:D.petitionerName,initialForeignEntityName:D.foreignEntityName,onEntityNamesChange:J})})]}),(0,t.jsx)(v,{isOpen:!!E,onClose:()=>M(null),title:`OCR Text - ${E?.exhibit_number||""}: ${E?.file_name||""}`,size:"xl",children:E&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-700",children:[(0,t.jsxs)("span",{children:["Exhibit: ",E.exhibit_number]}),(0,t.jsxs)("span",{children:["Pages: ",E.page_count]}),(0,t.jsxs)("span",{children:["~",Math.round((E.ocr_text?.length||0)/4)," tokens"]})]}),(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 max-h-[60vh] overflow-y-auto",children:(0,t.jsx)("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono",children:E.ocr_text||"No OCR text available"})}),(0,t.jsx)("div",{className:"flex justify-end gap-2",children:(0,t.jsx)("button",{onClick:async()=>{await navigator.clipboard.writeText(E.ocr_text||""),U("OCR text copied!","success")},className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Copy OCR Text"})})]})}),O&&(0,t.jsx)(N.default,{message:O.message,type:O.type,onClose:()=>T(null)})]}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Project not found"}),(0,t.jsx)("button",{onClick:()=>a.push("/"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Projects"})]})})}e.s(["default",()=>w],20468)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,563,e=>{"use strict";var t=e.i(43476),i=e.i(71645),r=e.i(81917);let n=[{key:"all",labelKey:"all"},{key:"relationship",labelKey:"qualifying_relationship"},{key:"employment",labelKey:"qualifying_employment"},{key:"capacity",labelKey:"qualifying_capacity"},{key:"business",labelKey:"doing_business"}],o={all:[],relationship:["subsidiary_of","owns","affiliated_with"],employment:["employed_by","works_for"],capacity:["manages","reports_to"],business:["located_in","founded"]},s={all:[],relationship:["company","organization"],employment:["person","company","organization"],capacity:["person","position"],business:["company","organization","location"]},a=(e,t)=>({works_for:t.relationship.relationTypes.works_for,employed_by:t.relationship.relationTypes.employed_by,owns:t.relationship.relationTypes.owns,subsidiary_of:t.relationship.relationTypes.subsidiary_of,affiliated_with:t.relationship.relationTypes.affiliated_with,manages:t.relationship.relationTypes.manages,reports_to:t.relationship.relationTypes.reports_to,founded:t.relationship.relationTypes.founded,located_in:t.relationship.relationTypes.located_in})[e]||e,l=(e,t)=>({companies:t.relationship.entityTypes.company,persons:t.relationship.entityTypes.person,others:t.relationship.graphLayers?.others||"Other"})[e]||e,d=()=>(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),p=()=>(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),c=(0,i.forwardRef)(({entity:e,t:r,onDelete:n,onRename:o},s)=>{var a;let[l,c]=(0,i.useState)(!1),[h,u]=(0,i.useState)(!1),[m,y]=(0,i.useState)(e.name),g={person:"border-blue-400",organization:"border-purple-400",company:"border-green-400",location:"border-orange-400",position:"border-pink-400",date:"border-cyan-400",event:"border-indigo-400",document:"border-amber-400"}[e.type]||"border-gray-300",x={person:"bg-blue-50",organization:"bg-purple-50",company:"bg-green-50",location:"bg-orange-50",position:"bg-pink-50",date:"bg-cyan-50",event:"bg-indigo-50",document:"bg-amber-50"}[e.type]||"bg-gray-50",f=(a=e.type,({person:r.relationship.entityTypes.person,organization:r.relationship.entityTypes.organization,company:r.relationship.entityTypes.company,location:r.relationship.entityTypes.location,position:r.relationship.entityTypes.position})[a]||a),b=()=>{m.trim()&&m!==e.name&&o&&o(m.trim()),u(!1)};return(0,t.jsxs)("div",{ref:s,className:`relative px-4 py-3 rounded-lg border-2 ${g} ${x} min-w-[120px] max-w-[180px] z-10`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[(0,t.jsx)("span",{className:"absolute -top-2.5 left-3 px-2 text-xs bg-white text-gray-500 whitespace-nowrap",children:f}),h?(0,t.jsx)("input",{type:"text",value:m,onChange:e=>y(e.target.value),onBlur:b,onKeyDown:t=>{"Enter"===t.key?b():"Escape"===t.key&&(y(e.name),u(!1))},className:"text-sm font-medium text-gray-800 text-center w-full bg-white border border-gray-300 rounded px-1 py-0.5 focus:outline-none focus:border-rose-400",autoFocus:!0}):(0,t.jsx)("p",{className:"text-sm font-medium text-gray-800 text-center truncate",children:e.name}),l&&!h&&(n||o)&&(0,t.jsxs)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 flex items-center gap-1 bg-white rounded-lg shadow-lg border border-gray-200 px-1 py-0.5 z-20",children:[o&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),u(!0)},className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:r.relationship.edit?.rename||"Rename",children:(0,t.jsx)(d,{})}),n&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm(r.relationship.edit?.confirmDeleteEntity||"Delete this entity and all related relations?")&&n()},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:r.relationship.edit?.delete||"Delete",children:(0,t.jsx)(p,{})})]})]})});c.displayName="EntityNode";let h=({title:e,children:i})=>(0,t.jsxs)("div",{className:"relative py-6",children:[(0,t.jsx)("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 text-xs text-gray-400 bg-white px-1 z-20",style:{writingMode:"vertical-rl",textOrientation:"mixed",transform:"rotate(180deg) translateY(50%)"},children:e}),(0,t.jsx)("div",{className:"flex justify-center gap-8 flex-wrap pl-6",children:i})]}),u=()=>(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),m=({relation:e,entities:r,t:n,onDelete:o})=>{let[s,l]=(0,i.useState)(!1),d=r.find(t=>t.id===e.source_id),p=r.find(t=>t.id===e.target_id);return d&&p?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-50 rounded text-xs text-gray-600 relative group",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[(0,t.jsx)("span",{className:"font-medium",children:d.name}),(0,t.jsx)("span",{className:"text-rose-500",children:"→"}),(0,t.jsx)("span",{className:"text-rose-600",children:a(e.relation_type,n)}),(0,t.jsx)("span",{className:"text-rose-500",children:"→"}),(0,t.jsx)("span",{className:"font-medium",children:p.name}),s&&o&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm(n.relationship.edit?.confirmDeleteRelation||"Delete this relation?")&&o()},className:"ml-1 p-0.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:n.relationship.edit?.delete||"Delete",children:(0,t.jsx)(u,{})})]}):null};function y({entities:e,relations:d,onDeleteEntity:p,onRenameEntity:u,onDeleteRelation:y}){let{t:g}=(0,r.useLanguage)(),[x,f]=(0,i.useState)("all"),b=(0,i.useRef)(null),[j,v]=(0,i.useState)(null),w=(0,i.useRef)(new Map),[,k]=(0,i.useState)({}),[_,N]=(0,i.useState)(null),{entities:$,relations:T}=(0,i.useMemo)(()=>((e,t,i)=>{if("all"===e)return{entities:t,relations:i};let r=o[e],n=s[e],a=i.filter(e=>r.includes(e.relation_type)),l=new Set;return a.forEach(e=>{l.add(e.source_id),l.add(e.target_id)}),{entities:a.length>0?t.filter(e=>l.has(e.id)):t.filter(e=>n.includes(e.type)),relations:a}})(x,e,d),[x,e,d]),M=(0,i.useMemo)(()=>({companies:$.filter(e=>["company","organization"].includes(e.type)),persons:$.filter(e=>"person"===e.type),others:$.filter(e=>!["company","organization","person"].includes(e.type))}),[$]),C=(0,i.useCallback)((e,t)=>{t?w.current.set(e,t):w.current.delete(e)},[]);(0,i.useEffect)(()=>{let e=setTimeout(()=>{b.current&&(v(b.current.getBoundingClientRect()),k({}))},100);return()=>clearTimeout(e)},[$,T,x]),(0,i.useEffect)(()=>{let e=()=>{b.current&&(v(b.current.getBoundingClientRect()),k({}))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let z=(0,i.useMemo)(()=>{let e=new Map,t=new Map;return T.forEach((i,r)=>{let n=[i.source_id,i.target_id].sort().join("-"),o=e.get(n)||0;t.set(r,o),e.set(n,o+1)}),{pairCount:e,pairIndex:t}},[T]);if(0===e.length)return(0,t.jsx)("div",{className:"h-[200px] flex items-center justify-center text-gray-400",children:(0,t.jsx)("p",{className:"text-sm",children:g.relationship.noEntitiesOrRelations})});let L=M.companies.length>0||M.persons.length>0||M.others.length>0;return(0,t.jsxs)("div",{className:"bg-white border border-gray-100 rounded-lg",children:[(0,t.jsx)("div",{className:"border-b border-gray-100 px-4 pt-4",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:n.map(e=>{var i;let r;return(0,t.jsx)("button",{onClick:()=>f(e.key),className:`px-3 py-2 text-xs font-medium rounded-t-lg transition-colors ${x===e.key?"bg-rose-50 text-rose-700 border-b-2 border-rose-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:(i=e.labelKey,(r=g.relationship.graphTabs)&&"object"==typeof r&&i in r?r[i]:({all:"Overview",qualifying_relationship:"Corporate",qualifying_employment:"Employment",qualifying_capacity:"Capacity",doing_business:"Operations"})[i]||i)},e.key)})})}),(0,t.jsx)("div",{ref:b,className:"relative p-6 min-h-[400px]",children:L?(0,t.jsxs)(t.Fragment,{children:[j&&(0,t.jsxs)("svg",{className:"absolute inset-0 pointer-events-none z-0",style:{overflow:"visible",width:"100%",height:"100%"},children:[(0,t.jsx)("defs",{children:(0,t.jsx)("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:(0,t.jsx)("path",{d:"M0,0 L0,6 L8,3 z",fill:"#94a3b8"})})}),T.map((e,i)=>{let r=w.current.get(e.source_id),n=w.current.get(e.target_id);if(!r||!n||!b.current)return null;let o=r.getBoundingClientRect(),s=n.getBoundingClientRect(),l=b.current.getBoundingClientRect(),d=[e.source_id,e.target_id].sort().join("-"),p=z.pairCount.get(d)||1,{path:c,labelX:h,labelY:u}=((e,t,i,r,n)=>{let o,s,a,l,d,p,c,h=e.left+e.width/2-i.left,u=e.top+e.height/2-i.top,m=t.left+t.width/2-i.left,y=t.top+t.height/2-i.top,g=y-u,x=m-h,f=g>20,b=n>1?(r-(n-1)/2)*15:0;if(f||g<-20)if(f){o=h+b,s=e.bottom-i.top,a=m+b;let r=(s+(l=t.top-i.top))/2,n=.3*x;d=`M ${o} ${s} C ${o+.5*n} ${r}, ${a-.5*n} ${r}, ${a} ${l}`,p=(o+a)/2,c=r}else{o=h+b,s=e.top-i.top,a=m+b;let r=(s+(l=t.bottom-i.top))/2,n=.3*x;d=`M ${o} ${s} C ${o+.5*n} ${r}, ${a-.5*n} ${r}, ${a} ${l}`,p=(o+a)/2,c=r}else{x>0?(o=e.right-i.left,a=t.left-i.left):(o=e.left-i.left,a=t.right-i.left),s=u+b,l=y+b;let r=(o+a)/2,n=.1*Math.abs(x)+20;d=`M ${o} ${s} Q ${r} ${s-n}, ${a} ${l}`,p=r,c=s-n/2}return{path:d,labelX:p,labelY:c}})(o,s,l,z.pairIndex.get(i)||0,p),m=a(e.relation_type,g),y=Math.max(8*m.length+12,60);return(0,t.jsxs)("g",{children:[(0,t.jsx)("path",{d:c,stroke:"#cbd5e1",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"}),(0,t.jsx)("rect",{x:h-y/2,y:u-9,width:y,height:"18",fill:"white",rx:"3",stroke:"#e2e8f0",strokeWidth:"1"}),(0,t.jsx)("text",{x:h,y:u+4,textAnchor:"middle",fontSize:"10",fill:"#be123c",children:m})]},i)})]}),(0,t.jsxs)("div",{className:"space-y-4 relative z-10",children:[M.companies.length>0&&(0,t.jsx)(h,{title:l("companies",g),children:M.companies.map(e=>(0,t.jsx)(c,{entity:e,t:g,ref:t=>C(e.id,t),onDelete:p?()=>p(e.id):void 0,onRename:u?t=>u(e.id,t):void 0},e.id))}),M.persons.length>0&&(0,t.jsx)(h,{title:l("persons",g),children:M.persons.map(e=>(0,t.jsx)(c,{entity:e,t:g,ref:t=>C(e.id,t),onDelete:p?()=>p(e.id):void 0,onRename:u?t=>u(e.id,t):void 0},e.id))}),M.others.length>0&&(0,t.jsx)(h,{title:l("others",g),children:M.others.map(e=>(0,t.jsx)(c,{entity:e,t:g,ref:t=>C(e.id,t),onDelete:p?()=>p(e.id):void 0,onRename:u?t=>u(e.id,t):void 0},e.id))})]}),T.length>0&&(0,t.jsxs)("div",{className:"mt-8 pt-4 border-t border-gray-100 relative z-10",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-500 mb-2",children:[g.relationship.relationDetails||"Relation Details",":"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:T.map((i,r)=>(0,t.jsx)(m,{relation:i,entities:e,t:g,onDelete:y?()=>y(i.source_id,i.target_id,i.relation_type):void 0},r))})]})]}):(0,t.jsx)("div",{className:"h-[200px] flex items-center justify-center text-gray-400",children:(0,t.jsx)("p",{className:"text-sm",children:g.relationship.noEntitiesOrRelations})})})]})}e.s(["default",()=>y])},66673,e=>{e.n(e.i(563))}]);
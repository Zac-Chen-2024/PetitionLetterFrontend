(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75283,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),l=e.i(18279),a=e.i(83036);function n({header:e,documents:s,highlight:r,analysis:l,generate:a}){return(0,t.jsxs)("div",{className:"min-h-screen bg-[#FAFAFA]",children:[(0,t.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,t.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold",children:"1"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-[#1A1A1A]",children:"Upload Documents"})]}),s]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"w-px h-8 bg-gray-300"})}),(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-yellow-500 text-white flex items-center justify-center text-sm font-semibold",children:"2"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-[#1A1A1A]",children:"Document Highlights"})]}),r]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"w-px h-8 bg-gray-300"})}),(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold",children:"3"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-[#1A1A1A]",children:"Evidence Analysis"})]}),l]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"w-px h-8 bg-gray-300"})}),(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold",children:"4"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-[#1A1A1A]",children:"Generate Paragraphs"})]}),a]})]})})]})}let i=[{key:"documents",label:"Documents",icon:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})},{key:"analysis",label:"Analysis",icon:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})},{key:"generate",label:"Generate",icon:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}];function o({header:e,documents:r,analysis:l,generate:a}){let[n,o]=(0,s.useState)("documents");return(0,t.jsxs)("div",{className:"min-h-screen bg-[#FAFAFA]",children:[(0,t.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("aside",{className:"w-64 min-h-[calc(100vh-64px)] bg-white border-r border-[#E5E7EB] sticky top-16 self-start",children:[(0,t.jsx)("nav",{className:"p-4 space-y-1",children:i.map(e=>(0,t.jsxs)("button",{onClick:()=>o(e.key),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all ${n===e.key?"bg-blue-50 text-blue-600":"text-[#6B7280] hover:bg-gray-50 hover:text-[#1A1A1A]"}`,children:[e.icon,(0,t.jsx)("span",{className:"font-medium",children:e.label}),n===e.key&&(0,t.jsx)("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-blue-600"})]},e.key))}),(0,t.jsxs)("div",{className:"p-4 border-t border-[#E5E7EB] mt-4",children:[(0,t.jsx)("div",{className:"text-xs text-[#6B7280] mb-2",children:"Progress"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:`w-3 h-3 rounded-full ${"documents"===n||"analysis"===n||"generate"===n?"bg-blue-600":"bg-gray-200"}`}),(0,t.jsx)("div",{className:"flex-1 h-0.5 bg-gray-200",children:(0,t.jsx)("div",{className:`h-full bg-blue-600 transition-all ${"documents"===n?"w-0":"analysis"===n?"w-1/2":"w-full"}`})}),(0,t.jsx)("div",{className:`w-3 h-3 rounded-full ${"analysis"===n||"generate"===n?"bg-blue-600":"bg-gray-200"}`}),(0,t.jsx)("div",{className:"flex-1 h-0.5 bg-gray-200",children:(0,t.jsx)("div",{className:`h-full bg-blue-600 transition-all ${"generate"===n?"w-full":"w-0"}`})}),(0,t.jsx)("div",{className:`w-3 h-3 rounded-full ${"generate"===n?"bg-blue-600":"bg-gray-200"}`})]})]})]}),(0,t.jsx)("main",{className:"flex-1 p-8",children:(0,t.jsx)("div",{className:"max-w-5xl mx-auto",children:(()=>{switch(n){case"documents":return r;case"analysis":return l;case"generate":return a}})()})})]})]})}let c=[{key:"documents",label:"Documents"},{key:"analysis",label:"Evidence Analysis"},{key:"generate",label:"Generate"}];function d({header:e,documents:r,analysis:l,generate:a}){let[n,i]=(0,s.useState)("documents");return(0,t.jsxs)("div",{className:"min-h-screen bg-[#FAFAFA]",children:[(0,t.jsx)("div",{className:"sticky top-0 z-50",children:e}),(0,t.jsx)("div",{className:"bg-white border-b border-[#E5E7EB] sticky top-16 z-40",children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto px-6",children:(0,t.jsx)("nav",{className:"flex gap-1",children:c.map((e,s)=>(0,t.jsxs)("button",{onClick:()=>i(e.key),className:`relative px-6 py-4 text-sm font-medium transition-colors ${n===e.key?"text-blue-600":"text-[#6B7280] hover:text-[#1A1A1A]"}`,children:[(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${n===e.key?"bg-blue-600 text-white":"bg-gray-100 text-[#6B7280]"}`,children:s+1}),e.label]}),n===e.key&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"})]},e.key))})})}),(0,t.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:(()=>{switch(n){case"documents":return r;case"analysis":return l;case"generate":return a}})()})]})}let x=[{key:"pipeline",label:"Pipeline",icon:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})},{key:"sidebar",label:"Sidebar",icon:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h7"})})},{key:"tabs",label:"Tabs",icon:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z"})})}];function h({current:e,onChange:s}){return(0,t.jsx)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg",children:x.map(r=>(0,t.jsxs)("button",{onClick:()=>s(r.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${e===r.key?"bg-white text-[#1A1A1A] shadow-sm":"text-[#6B7280] hover:text-[#1A1A1A]"}`,title:r.label,children:[r.icon,(0,t.jsx)("span",{className:"hidden sm:inline",children:r.label})]},r.key))})}function m({projectName:e,projectId:s,beneficiaryName:l,onBeneficiaryChange:a,onBeneficiarySave:n,isSaving:i=!1,layoutMode:o,onLayoutChange:c}){let d=(0,r.useRouter)();return(0,t.jsx)("header",{className:"bg-white border-b border-[#E5E7EB] h-16",children:(0,t.jsxs)("div",{className:"h-full max-w-7xl mx-auto px-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>d.push("/"),className:"p-2 text-[#6B7280] hover:text-[#1A1A1A] hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Projects",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-lg font-semibold text-[#1A1A1A]",children:e}),(0,t.jsx)("p",{className:"text-xs text-[#6B7280]",children:"L-1 Evidence Builder"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("label",{className:"text-sm text-[#6B7280]",children:"Beneficiary:"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"text",value:l,onChange:e=>a(e.target.value),onBlur:n,onKeyDown:e=>"Enter"===e.key&&n(),placeholder:"Enter name",className:"w-48 px-3 py-1.5 text-sm border border-[#E5E7EB] rounded-lg text-[#1A1A1A] bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),i&&(0,t.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(h,{current:o,onChange:c}),(0,t.jsx)("span",{className:"text-xs text-[#6B7280] font-mono bg-gray-50 px-2 py-1 rounded",children:s.slice(0,8)})]})]})})}var u=e.i(47167);let g=(e,t)=>{let s=e=>"pending"===e||"failed"===e||"partial"===e;return t.length>0?e.some(e=>t.includes(e.id)&&s(e.ocr_status)):e.some(e=>s(e.ocr_status))};function p({documents:e,selectedDocs:r,activeDocId:l,onSelectDoc:a,onViewDoc:n,onDeleteDoc:i,folders:o,ocrProgress:c,isOcrRunning:d,onStartOcr:x,onPauseOcr:h,onCancelOcr:m,onResumeOcr:u,onBatchDelete:p}){let[b,f]=(0,s.useState)(new Set(["A"])),j={};o.forEach(e=>{j[e]=[]}),e.forEach(e=>{let t=(e=>{if(!e)return"Other";let t=e.match(/^([A-Za-z0-9]+)-\d+$/i);return t?t[1].toUpperCase():"Other"})(e.exhibit_number);j[t]||(j[t]=[]),j[t].push(e)}),Object.keys(j).forEach(e=>{j[e].sort((e,t)=>parseInt(e.exhibit_number?.match(/-(\d+)$/)?.[1]||"0")-parseInt(t.exhibit_number?.match(/-(\d+)$/)?.[1]||"0"))});let v=Array.from(new Set([...o,...Object.keys(j)])).sort((e,t)=>"Other"===e?1:"Other"===t?-1:e.localeCompare(t));return(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white",children:[(0,t.jsxs)("div",{className:"flex-shrink-0 p-3 border-b border-[#E5E7EB]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-[#6B7280]",children:[e.length," files",c&&` | ${c.completed} OCR done`]}),(0,t.jsx)("button",{onClick:x,disabled:d||!g(e,r),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors flex items-center gap-1.5 ${d||!g(e,r)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border border-white border-t-transparent"}),"OCR..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})}),r.length>0?`OCR Selected (${r.length})`:"Start OCR"]})})]}),d&&c&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-[#6B7280]",children:[(0,t.jsxs)("span",{children:[c.completed+c.failed,"/",c.total]}),(0,t.jsxs)("span",{children:[c.progress_percent,"%"]})]}),(0,t.jsx)("div",{className:"w-full h-1.5 bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${c.progress_percent}%`}})}),c.current_processing&&c.current_processing.total_pages>0&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-xs text-blue-600 truncate flex-1",title:c.current_processing.file_name,children:[c.current_processing.file_name," (",c.current_processing.current_page,"/",c.current_processing.total_pages,")"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:[(0,t.jsx)("button",{onClick:h,className:"p-1 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Pause OCR",children:(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})})}),(0,t.jsx)("button",{onClick:m,className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancel OCR",children:(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),c&&(c.paused>0||c.partial>0)&&!d&&(0,t.jsxs)("div",{className:"mt-2 text-xs text-purple-600",children:[c.paused>0&&(0,t.jsxs)("span",{children:[c.paused," paused"]}),c.paused>0&&c.partial>0&&(0,t.jsx)("span",{children:" | "}),c.partial>0&&(0,t.jsxs)("span",{children:[c.partial," partial"]}),(0,t.jsx)("span",{className:"text-[#6B7280] ml-1",children:"(can resume)"})]}),r.length>0&&(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-blue-600 font-medium",children:[r.length," selected"]}),(0,t.jsxs)("button",{onClick:p,className:"px-2 py-1 text-xs font-medium text-red-600 hover:bg-red-50 rounded transition-colors flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:v.map(e=>{let s=j[e]||[],o=b.has(e),c=s.filter(e=>"completed"===e.ocr_status).length;return(0,t.jsxs)("div",{className:"border-b border-[#E5E7EB] last:border-b-0",children:[(0,t.jsxs)("button",{onClick:()=>{f(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},className:"w-full px-3 py-2 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:`w-3 h-3 text-[#6B7280] transition-transform duration-200 ${o?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,t.jsx)("span",{className:"w-5 h-5 rounded bg-amber-100 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-amber-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})})}),(0,t.jsx)("span",{className:"text-sm font-medium text-[#1A1A1A]",children:e}),(0,t.jsxs)("span",{className:"text-xs text-[#6B7280]",children:["(",s.length,")"]})]}),s.length>0&&(0,t.jsx)("div",{className:"w-12 h-1 bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-[#10B981]",style:{width:`${c/s.length*100}%`}})})]}),o&&(0,t.jsx)("div",{className:"bg-gray-50/50",children:0===s.length?(0,t.jsxs)("div",{className:"px-3 py-4 text-xs text-[#6B7280] text-center",children:["No files in folder ",e]}):s.map(e=>{let s;return(0,t.jsxs)("div",{onClick:()=>n(e.id),className:`px-3 py-2 flex items-center gap-2 cursor-pointer transition-colors border-l-2 ${l===e.id?"bg-blue-50 border-l-blue-600":"border-l-transparent hover:bg-gray-100"}`,children:[(0,t.jsx)("input",{type:"checkbox",checked:r.includes(e.id),onChange:t=>{t.stopPropagation(),a(e.id)},onClick:e=>e.stopPropagation(),className:"w-3.5 h-3.5 text-blue-600 rounded border-gray-300 cursor-pointer flex-shrink-0"}),(0,t.jsx)("span",{className:"text-xs font-mono text-blue-600 w-10 flex-shrink-0",children:e.exhibit_number||"-"}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-[#1A1A1A] truncate",title:e.file_name,children:e.file_name})}),(0,t.jsx)("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${(e=>{switch(e){case"completed":return"bg-[#10B981]";case"processing":return"bg-[#F59E0B]";case"queued":return"bg-blue-400";case"partial":return"bg-yellow-500";case"paused":return"bg-purple-500";case"cancelled":return"bg-gray-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}})(e.ocr_status)}`,title:e.ocr_status}),("paused"===(s=e.ocr_status)||"partial"===s)&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),u(e.id)},className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors flex-shrink-0",title:"Resume OCR",children:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm(`Delete "${e.file_name}"?`)&&i(e.id)},className:"p-1 text-[#6B7280] hover:text-red-500 rounded transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id)})})]},e)})})]})}let b=u.default.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function f({document:e,projectId:r,onCopyText:l}){let[a,n]=(0,s.useState)("ocr"),[i,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[x,h]=(0,s.useState)(null),[m,u]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[f,j]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&"highlight"===a&&(v(),y())},[e?.id,a]);let v=async()=>{if(e){u(!0);try{let t=await fetch(`${b}/api/text-blocks/${e.id}`);if(t.ok){let e=await t.json();o(e.text_blocks||[])}}catch(e){console.error("Failed to fetch text blocks:",e)}finally{u(!1)}}},y=async()=>{if(e){p(!0);try{let t=await fetch(`${b}/api/document/${e.id}/file`);if(t.ok){let e=await t.blob(),s=URL.createObjectURL(e);d(s);let r=new Image;r.onload=()=>{h({width:r.naturalWidth,height:r.naturalHeight})},r.src=s}}catch(e){console.error("Failed to fetch document image:",e)}finally{p(!1)}}};(0,s.useEffect)(()=>()=>{c&&URL.revokeObjectURL(c)},[c]);let N=async e=>{await navigator.clipboard.writeText(e),l()};return e?(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white",children:[(0,t.jsx)("div",{className:"flex-shrink-0 border-b border-[#E5E7EB]",children:(0,t.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("span",{className:"text-sm font-mono text-blue-600 flex-shrink-0",children:e.exhibit_number||"-"}),(0,t.jsx)("span",{className:"text-sm text-[#1A1A1A] truncate",title:e.file_name,children:e.file_name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,t.jsx)("button",{onClick:()=>n("highlight"),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${"highlight"===a?"bg-blue-100 text-blue-700":"text-[#6B7280] hover:bg-gray-100"}`,children:"Highlight"}),(0,t.jsx)("button",{onClick:()=>n("ocr"),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${"ocr"===a?"bg-blue-100 text-blue-700":"text-[#6B7280] hover:bg-gray-100"}`,children:"OCR Text"})]})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden",children:"ocr"===a?(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex-shrink-0 px-4 py-2 bg-gray-50 border-b border-[#E5E7EB] flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-[#6B7280]",children:[(0,t.jsxs)("span",{children:["Pages: ",e.page_count||1]}),(0,t.jsxs)("span",{children:["~",Math.round((e.ocr_text?.length||0)/4)," tokens"]})]}),(0,t.jsx)("button",{onClick:()=>N(e.ocr_text||""),disabled:!e.ocr_text,className:"px-3 py-1 text-xs font-medium text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:text-gray-400 disabled:hover:bg-transparent",children:"Copy All"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:"completed"===e.ocr_status&&e.ocr_text?(0,t.jsx)("pre",{className:"text-sm text-[#1A1A1A] whitespace-pre-wrap font-mono leading-relaxed",children:e.ocr_text}):"processing"===e.ocr_status?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-sm text-[#6B7280]",children:"OCR in progress..."})]})}):"failed"===e.ocr_status?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center text-red-500",children:[(0,t.jsx)("svg",{className:"w-10 h-10 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,t.jsx)("p",{className:"text-sm",children:"OCR failed"})]})}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center text-[#6B7280]",children:[(0,t.jsx)("svg",{className:"w-10 h-10 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"OCR not started"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:'Click "Start OCR" to process'})]})})})]}):(0,t.jsx)("div",{className:"h-full flex flex-col",children:g||m?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent"})}):c&&x?(0,t.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,t.jsxs)("div",{className:"relative inline-block",style:{maxWidth:"100%"},children:[(0,t.jsx)("img",{src:c,alt:e.file_name,className:"max-w-full h-auto"}),(0,t.jsx)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",viewBox:`0 0 ${x.width} ${x.height}`,preserveAspectRatio:"xMidYMid meet",children:i.map((e,s)=>{let{x1:r,y1:l,x2:a,y2:n}=e.bbox,i=f===s;return(0,t.jsx)("g",{children:(0,t.jsx)("rect",{x:r,y:l,width:a-r,height:n-l,fill:i?"rgba(37, 99, 235, 0.3)":"rgba(37, 99, 235, 0.1)",stroke:i?"#2563EB":"#93C5FD",strokeWidth:i?2:1,className:"cursor-pointer pointer-events-auto transition-all",onMouseEnter:()=>j(s),onMouseLeave:()=>j(null),onClick:()=>N(e.text_content)})},s)})}),null!==f&&i[f]&&(0,t.jsxs)("div",{className:"absolute z-10 bg-white border border-[#E5E7EB] rounded-lg shadow-lg p-3 max-w-xs pointer-events-none",style:{left:i[f].bbox.x1,top:i[f].bbox.y2+5},children:[(0,t.jsx)("p",{className:"text-xs text-[#6B7280] mb-1",children:i[f].block_type}),(0,t.jsx)("p",{className:"text-sm text-[#1A1A1A] line-clamp-3",children:i[f].text_content}),(0,t.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Click to copy"})]})]})}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-[#6B7280]",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"Preview not available"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Run OCR to see text blocks"})]})})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center text-[#6B7280]",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"Select a document to preview"})]})})}let j=u.default.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function v({projectId:e,folders:r,selectedFolder:l,onFolderSelect:a,onAddFolder:n,onUploadComplete:i,onError:o,onSuccess:c,disabled:d=!1}){let[x,h]=(0,s.useState)(!1),[m,u]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null),b=(0,s.useRef)(null),f=()=>{for(let e of"ABCDEFGHIJKLMNOPQRSTUVWXYZ")if(!r.includes(e))return e;let e=1;for(;r.includes(`F${e}`);)e++;return`F${e}`},v=(0,s.useCallback)(e=>{e.preventDefault(),d||h(!0)},[d]),y=(0,s.useCallback)(e=>{e.preventDefault(),h(!1)},[]),N=async(t,s,r)=>{let l=new FormData;l.append("file",t),l.append("project_id",e),l.append("folder",s);let a=await fetch(`${j}/api/upload`,{method:"POST",body:l});if(!a.ok)throw Error(`Upload failed: ${a.status}`);return a.json()},w=async e=>{if(d||m)return;let t=Array.from(e);if(0===t.length)return;u(!0),p({current:0,total:t.length});let s=0,r=0;for(let e=0;e<t.length;e++){let a=t[e];try{await N(a,l,e),s++}catch{r++}p({current:e+1,total:t.length})}u(!1),p(null),s>0&&(c(`Uploaded ${s} file${s>1?"s":""} to folder ${l}`),i()),r>0&&o(`Failed to upload ${r} file${r>1?"s":""}`)},k=(0,s.useCallback)(e=>{e.preventDefault(),h(!1),!d&&e.dataTransfer.files.length>0&&w(e.dataTransfer.files)},[d,e]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsx)("label",{className:"text-sm text-[#6B7280] font-medium",children:"Upload to folder:"}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[r.map(e=>(0,t.jsx)("button",{onClick:()=>a(e),disabled:d||m,className:`min-w-[40px] h-10 px-3 rounded-lg font-semibold text-sm transition-all ${l===e?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-[#6B7280] hover:bg-gray-200"} ${d||m?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e},e)),(0,t.jsx)("button",{onClick:()=>{let e=f();n(e),a(e)},disabled:d||m,className:"w-10 h-10 rounded-lg border-2 border-dashed border-[#E5E7EB] text-[#6B7280] hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center",title:`Add folder ${f()}`,children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),(0,t.jsxs)("span",{className:"text-xs text-[#6B7280]",children:["Files will be auto-numbered (e.g., ",l,"-1, ",l,"-2...)"]})]}),(0,t.jsxs)("div",{onDragOver:v,onDragLeave:y,onDrop:k,onClick:()=>{!d&&b.current&&b.current.click()},className:`relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${x?"border-blue-500 bg-blue-50":"border-[#E5E7EB] hover:border-blue-400 hover:bg-gray-50"} ${d||m?"opacity-50 cursor-not-allowed":""}`,children:[(0,t.jsx)("input",{ref:b,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{e.target.files&&e.target.files.length>0&&w(e.target.files)},className:"hidden",disabled:d||m}),m?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-3 border-blue-600 border-t-transparent mx-auto"}),(0,t.jsxs)("div",{className:"text-sm text-[#1A1A1A]",children:["Uploading ",g?.current," of ",g?.total,"..."]}),(0,t.jsx)("div",{className:"w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${g?g.current/g.total*100:0}%`}})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,t.jsx)("div",{className:"text-sm text-[#1A1A1A] font-medium mb-1",children:"Drop files here or click to upload"}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280]",children:"PDF, JPG, PNG supported"})]})]})]})}let y=["A","B","C","D"],N=u.default.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function w({projectId:e,documents:r,selectedDocs:l,onSelectDoc:a,onSelectAll:n,onRefresh:i,onError:o,onSuccess:c,loading:d=!1}){let[x,h]=(0,s.useState)(y),[m,u]=(0,s.useState)("A"),[g,b]=(0,s.useState)(null),[j,w]=(0,s.useState)(!1),[k,A]=(0,s.useState)(null),[E,B]=(0,s.useState)(null),[C,_]=(0,s.useState)(320),[S,L]=(0,s.useState)(!1),$=(0,s.useRef)(null),M=(0,s.useRef)(null),P=(0,s.useMemo)(()=>r.find(e=>e.id===E)||null,[r,E]);(0,s.useEffect)(()=>{let t=localStorage.getItem(`folders_${e}`);if(t)try{let e=JSON.parse(t);Array.isArray(e)&&e.length>0&&(h(e),e.includes(m)||u(e[0]))}catch{}},[e]);let F=async e=>{try{if(!(await fetch(`${N}/api/document/${e}`,{method:"DELETE"})).ok)throw Error("Delete failed");c("File deleted"),E===e&&B(null),i()}catch{o("Failed to delete file")}},O=async()=>{if(0!==l.length&&confirm(`Delete ${l.length} selected files?`))try{let t=await fetch(`${N}/api/document/batch/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!t.ok)throw Error("Batch delete failed");let s=await t.json();c(`Deleted ${s.deleted_count} files`),E&&l.includes(E)&&B(null),i()}catch{o("Batch delete failed")}},D=(0,s.useCallback)(async()=>{try{let t=await fetch(`${N}/api/ocr/progress/${e}`);if(t.ok){let e=await t.json();b(e),e.processing>0&&!j&&(w(!0),A(`auto-${Date.now()}`)),j&&0===e.processing&&(w(!1),A(null),i(),e.failed>0?c(`OCR complete: ${e.completed} done, ${e.failed} failed`):e.completed>0&&c(`OCR complete: ${e.completed} files processed`))}}catch{}},[e,j,i,c]);(0,s.useEffect)(()=>(j?M.current=setInterval(()=>{D()},5e3):M.current&&(clearInterval(M.current),M.current=null),()=>{M.current&&clearInterval(M.current)}),[j,D,i]),(0,s.useEffect)(()=>{D()},[e]);let R=async()=>{try{let e=l.length>0?l:r.filter(e=>"pending"===e.ocr_status).map(e=>e.id);if(0===e.length)return void c("No files to process");let t=0,s=0;for(let r of e)try{(await fetch(`${N}/api/ocr/${r}`,{method:"POST"})).ok?t++:s++}catch{s++}t>0&&(A(`manual-${Date.now()}`),w(!0),c(`Starting OCR for ${t} file(s)`),D(),i()),s>0&&o(`Failed to start OCR for ${s} file(s)`)}catch{o("Failed to start OCR")}},z=async()=>{if(!g?.current_processing?.document_id)return void o("No document currently processing");try{let e=await fetch(`${N}/api/ocr/pause/${g.current_processing.document_id}`,{method:"POST"}),t=await e.json();t.success?(c("Pause requested - will stop after current page"),D()):o(t.message||"Failed to pause OCR")}catch{o("Failed to pause OCR")}},I=async()=>{if(!g?.current_processing?.document_id)return void o("No document currently processing");if(confirm("Cancel OCR? Progress will be saved and can be resumed later."))try{let e=await fetch(`${N}/api/ocr/cancel/${g.current_processing.document_id}`,{method:"POST"}),t=await e.json();t.success?(c("Cancel requested - will stop after current page"),w(!1),D(),i()):o(t.message||"Failed to cancel OCR")}catch{o("Failed to cancel OCR")}},W=async e=>{try{let t=await fetch(`${N}/api/ocr/resume/${e}`,{method:"POST"}),s=await t.json();s.success?(w(!0),c(s.message),D(),i()):o(s.message||"Failed to resume OCR")}catch{o("Failed to resume OCR")}};return((0,s.useEffect)(()=>{let e=e=>{if(!S||!$.current)return;let t=$.current.getBoundingClientRect();_(Math.max(240,Math.min(e.clientX-t.left,.5*t.width)))},t=()=>{L(!1)};return S&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[S]),d)?(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-12 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"ml-3 text-[#6B7280]",children:"Loading documents..."})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-4",children:(0,t.jsx)(v,{projectId:e,folders:x,selectedFolder:m,onFolderSelect:u,onAddFolder:t=>{let s=[...x,t];h(s),localStorage.setItem(`folders_${e}`,JSON.stringify(s))},onUploadComplete:i,onError:o,onSuccess:c})}),(0,t.jsxs)("div",{ref:$,className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden flex",style:{height:"600px"},children:[(0,t.jsx)("div",{className:"flex-shrink-0 border-r border-[#E5E7EB] overflow-hidden",style:{width:C},children:(0,t.jsx)(p,{documents:r,selectedDocs:l,activeDocId:E,onSelectDoc:a,onViewDoc:B,onDeleteDoc:F,folders:x,ocrProgress:g,isOcrRunning:j,onStartOcr:R,onPauseOcr:z,onCancelOcr:I,onResumeOcr:W,onBatchDelete:O})}),(0,t.jsx)("div",{className:`w-1 flex-shrink-0 cursor-col-resize transition-colors ${S?"bg-blue-400":"bg-transparent hover:bg-blue-200"}`,onMouseDown:e=>{e.preventDefault(),L(!0)}}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,t.jsx)(f,{document:P,projectId:e,onCopyText:()=>c("Copied!")})})]})]})}var k=e.i(24994);function A({quote:e,onView:r}){let[l,a]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-[#E5E7EB] hover:border-blue-300 transition-colors cursor-pointer",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:r,children:[(0,t.jsxs)("div",{className:"text-sm text-[#1A1A1A] mb-3 line-clamp-3",children:['"',e.quote,'"']}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280] mb-3",children:e.relevance}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-blue-600 text-xs font-medium rounded",children:e.source.exhibit_id}),e.page&&(0,t.jsxs)("span",{className:"text-xs text-[#6B7280]",children:["p.",e.page]})]}),l&&(0,t.jsx)("span",{className:"text-xs text-blue-600",children:"View in PDF"})]})]})}function E({standardKey:e,quotes:r,onViewQuote:l}){let[a,n]=(0,s.useState)(!0),i=k.STANDARD_DISPLAY_NAMES[e]||{chinese:e,english:e};return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>n(!a),className:"w-full px-5 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("svg",{className:`w-4 h-4 text-[#6B7280] transition-transform duration-200 ${a?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${r.length>=5?"bg-[#10B981]":r.length>=2?"bg-[#F59E0B]":r.length>=1?"bg-blue-500":"bg-gray-300"}`}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("div",{className:"font-semibold text-[#1A1A1A]",children:i.english}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280]",children:i.chinese})]})]}),(0,t.jsxs)("span",{className:"px-3 py-1 text-sm font-medium bg-gray-100 text-[#6B7280] rounded-full",children:[r.length," quote",1!==r.length?"s":""]})]}),a&&(0,t.jsx)("div",{className:"p-5 border-t border-[#E5E7EB] space-y-3",children:r.length>0?r.map((e,s)=>(0,t.jsx)(A,{quote:e,onView:()=>l?.(e)},s)):(0,t.jsx)("div",{className:"text-center py-8 text-[#6B7280] text-sm",children:"No evidence found for this standard yet."})})]})}function B({quotesByStandard:e,onViewQuote:s}){let r=["qualifying_relationship","qualifying_employment","qualifying_capacity","doing_business"],l=Object.values(e).flat().length;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,t.jsxs)("span",{className:"text-[#1A1A1A] font-medium",children:[l," Total Quotes"]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:r.map(s=>{let r=e[s]?.length||0;return(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${r>=5?"bg-[#10B981]":r>=2?"bg-[#F59E0B]":r>=1?"bg-blue-500":"bg-gray-300"}`}),(0,t.jsx)("span",{className:"text-xs text-[#6B7280]",children:r})]},s)})})]}),r.map(r=>(0,t.jsx)(E,{standardKey:r,quotes:e[r]||[],onViewQuote:s},r))]})}let C=["qualifying_relationship","qualifying_employment","qualifying_capacity","doing_business"],_={qualifying_relationship:"Relationship",qualifying_employment:"Employment",qualifying_capacity:"Capacity",doing_business:"Operations"};function S({quotesByStandard:e,documents:r,onViewQuote:l}){let[a,n]=(0,s.useState)(null),i=(0,s.useMemo)(()=>{let t=new Set;return Object.values(e).flat().forEach(e=>{t.add(e.source.exhibit_id)}),t},[e]),o=(0,s.useMemo)(()=>{let t={};return r.forEach(e=>{e.exhibit_number&&(t[e.exhibit_number]={},C.forEach(s=>{t[e.exhibit_number][s]=[]}))}),Object.entries(e).forEach(([e,s])=>{s.forEach(s=>{let r=s.source.exhibit_id;t[r]&&(t[r][e]=t[r][e]||[],t[r][e].push(s))})}),t},[e,r]),c=r.filter(e=>e.exhibit_number&&i.has(e.exhibit_number)),d=(0,s.useMemo)(()=>a&&o[a.docId]?.[a.standard]||[],[a,o]);return 0===r.length?(0,t.jsx)("div",{className:"text-center py-12 text-[#6B7280]",children:"No documents uploaded yet."}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-[#E5E7EB]",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider w-32",children:"Document"}),C.map(e=>(0,t.jsxs)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-[#6B7280] uppercase tracking-wider",children:[(0,t.jsx)("div",{children:_[e]}),(0,t.jsx)("div",{className:"text-[10px] font-normal normal-case text-gray-400",children:k.STANDARD_DISPLAY_NAMES[e]?.chinese})]},e)),(0,t.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-[#6B7280] uppercase tracking-wider w-20",children:"Total"})]})}),(0,t.jsx)("tbody",{children:0===c.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-[#6B7280] text-sm",children:"No analysis results yet. Run analysis to see the matrix."})}):c.map(e=>{let s=e.exhibit_number,r=o[s]||{},l=C.reduce((e,t)=>e+(r[t]?.length||0),0);return(0,t.jsxs)("tr",{className:"border-b border-[#E5E7EB] hover:bg-gray-50",children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-mono text-sm text-blue-600",children:s}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280] truncate max-w-32",title:e.file_name,children:e.file_name})]}),C.map(e=>{let l=r[e]?.length||0,i=a?.docId===s&&a?.standard===e;return(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("button",{onClick:()=>l>0&&n({docId:s,standard:e}),disabled:0===l,className:`w-full py-2 px-3 rounded-lg text-sm font-medium transition-all ${l>=3?"bg-[#10B981] text-white":2===l?"bg-emerald-300 text-emerald-900":1===l?"bg-emerald-100 text-emerald-700":"bg-gray-50 text-gray-400"} ${l>0?"cursor-pointer hover:ring-2 hover:ring-blue-400":"cursor-default"} ${i?"ring-2 ring-blue-600":""}`,children:l})},e)}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:(0,t.jsx)("span",{className:"text-sm font-semibold text-[#1A1A1A]",children:l})})]},e.id)})}),c.length>0&&(0,t.jsx)("tfoot",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-t border-[#E5E7EB]",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-xs font-semibold text-[#6B7280] uppercase",children:"Total"}),C.map(s=>{let r=e[s]?.length||0;return(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:(0,t.jsx)("span",{className:"text-sm font-semibold text-[#1A1A1A]",children:r})},s)}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:(0,t.jsx)("span",{className:"text-sm font-bold text-blue-600",children:Object.values(e).flat().length})})]})})]})})}),a&&d.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-blue-600 text-sm font-medium rounded",children:a.docId}),(0,t.jsx)("span",{className:"text-[#6B7280]",children:"/"}),(0,t.jsx)("span",{className:"text-sm font-medium text-[#1A1A1A]",children:k.STANDARD_DISPLAY_NAMES[a.standard]?.english||a.standard})]}),(0,t.jsx)("button",{onClick:()=>n(null),className:"text-[#6B7280] hover:text-[#1A1A1A] transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"space-y-3",children:d.map((e,s)=>(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-[#E5E7EB] cursor-pointer hover:border-blue-300 transition-colors",onClick:()=>l?.(e),children:[(0,t.jsxs)("div",{className:"text-sm text-[#1A1A1A] mb-2",children:['"',e.quote,'"']}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs text-[#6B7280]",children:e.relevance}),e.page&&(0,t.jsxs)("span",{className:"text-xs text-blue-600",children:["Page ",e.page]})]})]},s))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-[#6B7280]",children:[(0,t.jsx)("span",{children:"Legend:"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded bg-[#10B981]"}),(0,t.jsx)("span",{children:"3+ quotes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded bg-emerald-300"}),(0,t.jsx)("span",{children:"2 quotes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded bg-emerald-100"}),(0,t.jsx)("span",{children:"1 quote"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded bg-gray-50 border border-gray-200"}),(0,t.jsx)("span",{children:"No quotes"})]})]})]})}function L({projectId:e,documents:r,selectedDocs:l,quotesByStandard:a,onRunAnalysis:n,isAnalyzing:i,onViewQuote:o}){let[c,d]=(0,s.useState)("standard"),x=Object.values(a).flat().length,h=r.filter(e=>"completed"===e.ocr_status),m=l.length>0||h.length>0;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg",children:[(0,t.jsx)("button",{onClick:()=>d("standard"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${"standard"===c?"bg-white text-[#1A1A1A] shadow-sm":"text-[#6B7280] hover:text-[#1A1A1A]"}`,children:"By Standard"}),(0,t.jsx)("button",{onClick:()=>d("matrix"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${"matrix"===c?"bg-white text-[#1A1A1A] shadow-sm":"text-[#6B7280] hover:text-[#1A1A1A]"}`,children:"Matrix View"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,t.jsxs)("span",{className:"text-[#6B7280]",children:[x," quote",1!==x?"s":""," found"]}),l.length>0&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs font-medium",children:[l.length," doc",1!==l.length?"s":""," selected"]})]})]}),(0,t.jsx)("button",{onClick:()=>{n(l.length>0?l:h.map(e=>e.id))},disabled:!m||i,className:"px-5 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Analyzing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),l.length>0?`Analyze ${l.length} Selected`:"Analyze All"]})})]}),0===h.length&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:"Upload and OCR documents first to run analysis."})]}),"standard"===c?(0,t.jsx)(B,{quotesByStandard:a,onViewQuote:o}):(0,t.jsx)(S,{quotesByStandard:a,documents:r,onViewQuote:o}),0===x&&r.length>0&&h.length>0&&!i&&(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-12 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-[#6B7280]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-[#1A1A1A] mb-2",children:"No Analysis Yet"}),(0,t.jsx)("p",{className:"text-[#6B7280] mb-4",children:'Click "Analyze All" to extract L-1 evidence from your documents.'})]})]})}function $({projectId:e,quotesByStandard:r,beneficiaryName:a,petitionerName:n,foreignEntityName:i,onPetitionerChange:o,onForeignEntityChange:c,onEntitySave:d,onViewQuote:x}){let[h,m]=(0,s.useState)("manual"),[u,g]=(0,s.useState)(k.SECTION_TYPES[0].key),[p,b]=(0,s.useState)({}),[f,j]=(0,s.useState)({}),[v,y]=(0,s.useState)(!0),[N,w]=(0,s.useState)(!1),[A,E]=(0,s.useState)(!1),[B,C]=(0,s.useState)(""),[_,S]=(0,s.useState)(null),[L,$]=(0,s.useState)(!1),M=p[u]||[],P=f[u]||null,F=M.find(e=>e.id===P),O=Object.values(r).flat(),D=O.length;(0,s.useEffect)(()=>{R()},[e]);let R=async()=>{try{y(!0);let t=await l.writingApi.getAllWriting(e);if(t?.sections){let e={},s={};for(let[r,l]of Object.entries(t.sections)){let t={id:l.version_id||`saved-${r}`,version:1,text:l.text,citations:l.citations||[],created_at:l.timestamp||new Date().toISOString()};e[r]=[t],s[r]=t.id}b(e),j(s)}}catch{console.log("No saved writing yet")}finally{y(!1)}},z=(0,s.useCallback)(()=>{let e=JSON.stringify(O.map(e=>({quote:e.quote,relevance:e.relevance,l1_standard:e.standard_en||e.standard||"unknown",source:{exhibit_id:e.source.exhibit_id,file_name:e.source.file_name}})),null,2);return(0,k.generateSectionWritingPrompt)(u,e,{petitionerName:n,foreignEntityName:i,beneficiaryName:a})},[u,a,n,i,O]),I=async e=>{await navigator.clipboard.writeText(e),$(!0),setTimeout(()=>$(!1),2e3)},W=e=>{b(t=>({...t,[u]:[...t[u]||[],e]})),j(t=>({...t,[u]:e.id}))},T=async()=>{if(B.trim()&&!_&&!A)try{E(!0);let t=JSON.parse(B);if((await l.writingApi.saveManual(e,u,t.paragraph_text,t.citations_used||[])).success){let e={id:`v${Date.now()}`,version:M.length+1,text:t.paragraph_text,citations:t.citations_used||[],created_at:new Date().toISOString()};W(e),C("")}}catch(e){S(`Failed to save: ${e.message}`)}finally{E(!1)}},V=async()=>{try{w(!0);let t=await l.writingApi.generateParagraph(e,u,a||void 0);if(t.success){let e={id:`v${Date.now()}`,version:M.length+1,text:t.paragraph.text,citations:t.paragraph.citations,created_at:new Date().toISOString()};W(e)}}catch(e){console.error("Generate failed:",e)}finally{w(!1)}};return v?(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-12 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"ml-3 text-[#6B7280]",children:"Loading..."})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("label",{className:"text-sm text-[#6B7280] font-medium",children:"Section:"}),(0,t.jsx)("select",{value:u,onChange:e=>g(e.target.value),className:"flex-1 max-w-md px-3 py-2 text-sm border border-[#E5E7EB] rounded-lg text-[#1A1A1A] bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:k.SECTION_TYPES.map(e=>(0,t.jsx)("option",{value:e.key,children:e.label},e.key))}),(0,t.jsxs)("span",{className:"text-sm text-[#6B7280]",children:[D," quotes available"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-[#6B7280]",children:"Petitioner (US):"}),(0,t.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),onBlur:d,placeholder:"e.g., ABC Corp.",className:"w-40 px-3 py-1.5 text-sm border border-[#E5E7EB] rounded-lg text-[#1A1A1A] bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-[#6B7280]",children:"Foreign Entity:"}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),onBlur:d,placeholder:"e.g., XYZ Ltd.",className:"w-40 px-3 py-1.5 text-sm border border-[#E5E7EB] rounded-lg text-[#1A1A1A] bg-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a&&(0,t.jsxs)("span",{className:"text-sm text-[#6B7280]",children:["Beneficiary: ",(0,t.jsx)("strong",{className:"text-[#1A1A1A]",children:a})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg w-fit",children:[(0,t.jsx)("button",{onClick:()=>m("manual"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"manual"===h?"bg-white text-[#1A1A1A] shadow-sm":"text-[#6B7280] hover:text-[#1A1A1A]"}`,children:"Manual (Copy & Paste)"}),(0,t.jsx)("button",{onClick:()=>m("auto"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"auto"===h?"bg-white text-[#1A1A1A] shadow-sm":"text-[#6B7280] hover:text-[#1A1A1A]"}`,children:"Auto Generate"})]}),"manual"===h&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border-2 border-green-200 p-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-[#1A1A1A] mb-1",children:"Step 1: Copy to LLM"}),(0,t.jsxs)("p",{className:"text-sm text-[#6B7280]",children:['Copy prompt + evidence for "',k.SECTION_TYPES.find(e=>e.key===u)?.label,'". Paste into ChatGPT/Claude.']})]}),(0,t.jsx)("button",{onClick:()=>I(z()),disabled:0===D,className:"px-5 py-2.5 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Prompt"]})})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-xs text-[#6B7280]",children:[(0,t.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded",children:[D," quotes"]}),(0,t.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded",children:["~",Math.round(z().length/4)," tokens"]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-5 py-3 bg-gray-50 border-b border-[#E5E7EB] flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-semibold text-[#1A1A1A]",children:"Step 2: Paste LLM Result"}),_?(0,t.jsx)("span",{className:"text-sm text-red-600",children:_}):B.trim()?(0,t.jsx)("span",{className:"text-sm text-green-600",children:"Valid JSON"}):null]}),(0,t.jsxs)("div",{className:"p-5",children:[(0,t.jsx)("textarea",{value:B,onChange:e=>{var t;C(t=e.target.value),(e=>{if(!e.trim())return S(null);try{let t=JSON.parse(e);t.paragraph_text&&t.citations_used?S(null):S("Invalid format: expected { paragraph_text, citations_used }")}catch(e){S(`JSON Parse Error: ${e.message}`)}})(t)},placeholder:`Paste the JSON result from LLM here...

{
  "paragraph_text": "...",
  "citations_used": [...]
}`,className:"w-full h-40 p-4 text-sm font-mono border border-[#E5E7EB] rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-[#1A1A1A] placeholder:text-gray-400"}),(0,t.jsx)("div",{className:"flex justify-end mt-4",children:(0,t.jsx)("button",{onClick:T,disabled:!B.trim()||!!_||A,className:"px-5 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Saving..."]}):"Save Paragraph"})})]})]})]}),"auto"===h&&(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-5",children:[(0,t.jsxs)("p",{className:"text-sm text-[#6B7280] mb-4",children:["Automatically generate paragraph using LLM API. The AI will select relevant quotes from all ",D," available quotes."]}),(0,t.jsx)("button",{onClick:V,disabled:N||0===D,className:"px-5 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Generate Paragraph"]})})]}),F&&(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-5 py-3 bg-gray-50 border-b border-[#E5E7EB] flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"font-semibold text-[#1A1A1A]",children:"Generated Paragraph"}),(0,t.jsxs)("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded",children:["v",F.version]})]}),(0,t.jsxs)("button",{onClick:async()=>{await navigator.clipboard.writeText(F.text)},className:"text-sm text-[#6B7280] hover:text-[#1A1A1A] flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})]}),(0,t.jsx)("div",{className:"p-5",children:(0,t.jsx)("div",{className:"text-sm text-[#1A1A1A] leading-relaxed whitespace-pre-wrap",children:(e=>{let s,r=/\[Exhibit ([A-Z]-\d+)(?::\s*([^\]]+))?\]/g,l=[],a=0;for(;null!==(s=r.exec(e));){s.index>a&&l.push(e.slice(a,s.index));let r=s[1],n=s[2],i=F?.citations.find(e=>e.exhibit===r);l.push((0,t.jsxs)("span",{className:"relative group inline-block",children:[(0,t.jsxs)("span",{className:"text-blue-600 cursor-pointer hover:bg-blue-50 px-0.5 rounded font-medium",children:["[Exhibit ",r,n?`: ${n}`:"","]"]}),i&&(0,t.jsxs)("div",{className:"absolute z-50 bottom-full left-0 mb-2 w-72 bg-white rounded-xl shadow-xl border border-[#E5E7EB] p-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute -bottom-2 left-4 w-4 h-4 bg-white border-r border-b border-[#E5E7EB] transform rotate-45"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:"font-medium text-sm text-[#1A1A1A] mb-1",children:["Exhibit ",r]}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280] mb-2",children:i.file_name}),(0,t.jsxs)("div",{className:"text-xs text-[#1A1A1A] italic line-clamp-3",children:['"',i.quote,'"']})]})]})]},s.index)),a=s.index+s[0].length}return a<e.length&&l.push(e.slice(a)),l})(F.text)})}),F.citations.length>0&&(0,t.jsxs)("div",{className:"px-5 py-4 bg-gray-50 border-t border-[#E5E7EB]",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold text-[#6B7280] uppercase tracking-wider mb-3",children:["Citations (",F.citations.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:F.citations.map((e,s)=>(0,t.jsxs)("div",{className:"text-xs bg-white rounded-lg p-3 border border-[#E5E7EB]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsxs)("span",{className:"font-mono text-blue-600",children:["[Exhibit ",e.exhibit,"]"]}),(0,t.jsx)("span",{className:"text-[#6B7280]",children:e.file_name})]}),(0,t.jsxs)("div",{className:"text-[#6B7280] italic line-clamp-2",children:['"',e.quote,'"']})]},s))})]})]}),!F&&(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-12 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-[#6B7280]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-[#1A1A1A] mb-2",children:"No Paragraph Yet"}),(0,t.jsx)("p",{className:"text-[#6B7280]",children:"Use Manual mode to copy prompt to ChatGPT, or Auto mode to generate directly."})]})]})}let M={company_name:"bg-blue-100 border-blue-300 text-blue-800",person_name:"bg-green-100 border-green-300 text-green-800",date:"bg-purple-100 border-purple-300 text-purple-800",amount:"bg-yellow-100 border-yellow-300 text-yellow-800",address:"bg-orange-100 border-orange-300 text-orange-800",position:"bg-pink-100 border-pink-300 text-pink-800",key_fact:"bg-red-100 border-red-300 text-red-800",legal_term:"bg-indigo-100 border-indigo-300 text-indigo-800",signature:"bg-gray-100 border-gray-300 text-gray-800",other:"bg-gray-100 border-gray-300 text-gray-600"},P={high:"bg-red-500 text-white",medium:"bg-yellow-500 text-white",low:"bg-gray-400 text-white"};function F({projectId:e,documents:r,onError:a,onSuccess:n}){let[i,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[x,h]=(0,s.useState)(1),[m,u]=(0,s.useState)(1),[g,p]=(0,s.useState)([]),[b,f]=(0,s.useState)({}),[j,v]=(0,s.useState)(null),[y,N]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[A,E]=(0,s.useState)(null),B=(0,s.useRef)(null),C=(0,s.useRef)(null),_=(0,s.useCallback)(async()=>{if(e)try{let t=(await l.highlightApi.getProgress(e)).documents.filter(e=>"completed"===e.ocr_status);o(t),!c&&t.length>0&&d(t[0].id)}catch(e){console.error("Failed to load documents:",e)}},[e,c]);(0,s.useEffect)(()=>{_()},[_]);let S=(0,s.useCallback)(async()=>{if(c){N(!0);try{let e=await l.highlightApi.getHighlightsByPage(c);f(e.highlights_by_page),u(e.page_count||1),v(e.highlight_status);let t=[];Object.values(e.highlights_by_page).forEach(e=>{t.push(...e)}),p(t),h(1)}catch(e){console.error("Failed to load highlights:",e)}finally{N(!1)}}},[c]);(0,s.useEffect)(()=>{S()},[S]);let L=async()=>{if(c){k(!0);try{await l.highlightApi.trigger(c);let e=setInterval(async()=>{let t=await l.highlightApi.getStatus(c);("completed"===t.highlight_status||"failed"===t.highlight_status)&&(clearInterval(e),k(!1),S(),_(),"completed"===t.highlight_status?n?.("Highlight analysis completed"):a?.("Highlight analysis failed"))},2e3)}catch(e){console.error("Failed to trigger analysis:",e),a?.("Failed to start highlight analysis"),k(!1)}}};(0,s.useEffect)(()=>{let e=B.current,t=C.current;if(!e||!t)return;let s=e.getContext("2d");if(!s)return;let r=()=>{e.width=t.naturalWidth,e.height=t.naturalHeight,s.clearRect(0,0,e.width,e.height),(b[x]||[]).forEach(t=>{if(!t.bbox||null===t.bbox.x1)return;let r=e.width/1e3,l=e.height/1e3,a=t.bbox.x1*r,n=t.bbox.y1*l,i=(t.bbox.x2-t.bbox.x1)*r,o=(t.bbox.y2-t.bbox.y1)*l;s.fillStyle="rgba(255, 255, 0, 0.3)",s.fillRect(a,n,i,o),A?.id===t.id?(s.strokeStyle="rgba(255, 165, 0, 0.9)",s.lineWidth=3):(s.strokeStyle="rgba(255, 200, 0, 0.6)",s.lineWidth=1),s.strokeRect(a,n,i,o)})};t.complete?r():t.onload=r},[x,b,A]),i.find(e=>e.id===c);let $=i.filter(e=>"completed"===e.highlight_status).length;return 0===i.length?(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-8 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-[#6B7280]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-[#1A1A1A] mb-2",children:"No Documents Ready"}),(0,t.jsx)("p",{className:"text-[#6B7280]",children:"Complete OCR on documents first to analyze highlights."})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"text-sm text-[#6B7280]",children:[i.length," document",1!==i.length?"s":""," ready"]}),(0,t.jsx)("span",{className:"text-[#E5E7EB]",children:"|"}),(0,t.jsxs)("span",{className:"text-sm text-[#6B7280]",children:[$," analyzed"]}),g.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-[#E5E7EB]",children:"|"}),(0,t.jsxs)("span",{className:"px-2 py-1 bg-yellow-50 text-yellow-600 rounded text-xs font-medium",children:[g.length," highlight",1!==g.length?"s":""]})]})]}),(0,t.jsx)("button",{onClick:L,disabled:w||!c||"processing"===j,className:"px-4 py-2 text-sm bg-yellow-500 text-white rounded-lg font-medium hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Analyzing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"Analyze Highlights"]})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[#E5E7EB] overflow-hidden",style:{height:"600px"},children:(0,t.jsxs)("div",{className:"flex h-full",children:[(0,t.jsxs)("div",{className:"w-56 border-r overflow-y-auto bg-gray-50",children:[(0,t.jsx)("div",{className:"p-3 border-b bg-gray-100",children:(0,t.jsx)("h3",{className:"font-medium text-gray-700 text-sm",children:"Documents"})}),(0,t.jsx)("div",{className:"divide-y",children:i.map(e=>(0,t.jsxs)("button",{onClick:()=>d(e.id),className:`w-full text-left p-3 hover:bg-gray-100 transition ${c===e.id?"bg-blue-50 border-l-4 border-blue-500":""}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${"completed"===e.highlight_status?"bg-green-500":"processing"===e.highlight_status?"bg-yellow-500":"failed"===e.highlight_status?"bg-red-500":"bg-gray-300"}`}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 truncate",children:e.exhibit_number||"N/A"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate mt-1",children:e.file_name})]},e.id))})]}),(0,t.jsx)("div",{className:"flex-1 bg-gray-100 overflow-hidden flex flex-col",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-white border-b p-2 flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>h(e=>Math.max(1,e-1)),disabled:x<=1,className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:""}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",x," / ",m]}),(0,t.jsx)("button",{onClick:()=>h(e=>Math.min(m,e+1)),disabled:x>=m,className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:""})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:j||"Not analyzed"})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-4 flex items-start justify-center",children:y?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Loading..."})}):(0,t.jsxs)("div",{className:"relative inline-block shadow-lg",children:[(0,t.jsx)("img",{ref:C,src:c?l.highlightApi.getPageImage(c,x,150):"",alt:`Page ${x}`,className:"max-w-full max-h-[500px] object-contain"}),(0,t.jsx)("canvas",{ref:B,className:"absolute top-0 left-0 pointer-events-none",style:{width:"100%",height:"100%"}})]})})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:"Select a document to view highlights"})}),(0,t.jsxs)("div",{className:"w-72 border-l overflow-y-auto",children:[(0,t.jsxs)("div",{className:"p-3 border-b bg-gray-50",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-700 text-sm",children:"Highlights"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[g.length," item",1!==g.length?"s":""," found"]})]}),0===g.length&&!y&&"completed"!==j&&(0,t.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:'No highlights yet. Click "Analyze Selected Doc" to start.'}),(0,t.jsx)("div",{className:"divide-y",children:g.map((e,s)=>(0,t.jsx)("button",{onClick:()=>{E(e),e.page_number!==x&&h(e.page_number)},className:`w-full text-left p-3 hover:bg-gray-50 transition ${A?.id===e.id?"bg-yellow-50 border-l-4 border-yellow-400":""}`,children:(0,t.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-400",children:["#",s+1]}),(0,t.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded border ${M[e.category||"other"]}`,children:e.category_cn||e.category||"Other"}),e.importance&&(0,t.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${P[e.importance]}`,children:e.importance})]}),(0,t.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2",children:e.text_content||"(No text)"}),e.reason&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:e.reason}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Page ",e.page_number,e.bbox?" - Has BBox":" - No BBox"]})]})})},e.id))})]})]})})]})}function O({isOpen:e,onClose:r,quote:l,documentOcrText:a}){let[n,i]=(0,s.useState)("");return((0,s.useEffect)(()=>{if(l&&a){let e=l.quote,t=a.toLowerCase(),s=e.toLowerCase(),r=t.indexOf(s);if(-1!==r){let t=Math.max(0,r-500),s=Math.min(a.length,r+e.length+500),l=a.slice(t,r),n=a.slice(r,r+e.length),o=a.slice(r+e.length,s);i(`...${l}<mark class="bg-yellow-300 px-1 rounded">${n}</mark>${o}...`)}else i(`<mark class="bg-yellow-300 px-1 rounded">${e}</mark>`)}},[l,a]),e&&l)?(0,t.jsxs)("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),(0,t.jsxs)("div",{className:"relative w-full max-w-4xl max-h-[90vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-b border-[#E5E7EB] flex items-center justify-between flex-shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-[#1A1A1A]",children:["Exhibit ",l.source.exhibit_id]}),(0,t.jsx)("p",{className:"text-sm text-[#6B7280]",children:l.source.file_name})]})]}),(0,t.jsx)("button",{onClick:r,className:"p-2 text-[#6B7280] hover:text-[#1A1A1A] hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"px-6 py-3 bg-blue-50 border-b border-blue-100 flex items-center gap-4 flex-shrink-0",children:[l.page&&(0,t.jsxs)("span",{className:"px-3 py-1 bg-white text-blue-600 text-sm font-medium rounded-lg",children:["Page ",l.page]}),(0,t.jsx)("span",{className:"px-3 py-1 bg-white text-[#6B7280] text-sm rounded-lg",children:l.standard_en||l.standard}),(0,t.jsx)("span",{className:"text-sm text-blue-700",children:l.relevance})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,t.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg",children:[(0,t.jsx)("div",{className:"text-xs text-[#6B7280] uppercase tracking-wider mb-2",children:"Matched Quote"}),(0,t.jsxs)("div",{className:"text-sm text-[#1A1A1A] italic",children:['"',l.quote,'"']})]}),a?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-[#6B7280] uppercase tracking-wider mb-3",children:"Document Context"}),(0,t.jsx)("div",{className:"text-sm text-[#1A1A1A] leading-relaxed font-mono whitespace-pre-wrap bg-gray-50 p-4 rounded-lg border border-[#E5E7EB]",dangerouslySetInnerHTML:{__html:n}})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-[#6B7280]",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-sm",children:"PDF preview with BBox highlighting coming soon."}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"BBox matching is being implemented in the backend."})]})]}),(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-[#E5E7EB] flex items-center justify-between flex-shrink-0",children:[(0,t.jsx)("div",{className:"text-xs text-[#6B7280]",children:"Note: Full PDF page rendering with BBox highlight overlay is planned for future updates."}),(0,t.jsx)("button",{onClick:async()=>{await navigator.clipboard.writeText(l.quote)},className:"px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:"Copy Quote"})]})]})]}):null}function D({currentProjectId:e,isCollapsed:a,onToggle:n}){let i=(0,r.useRouter)(),[o,c]=(0,s.useState)([]),[d,x]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[u,g]=(0,s.useState)(""),[p,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{f()},[]);let f=async()=>{try{x(!0);let e=await l.projectApi.listProjects();c(e)}catch(e){console.error("Failed to load projects:",e)}finally{x(!1)}},j=async()=>{if(u.trim()&&!p)try{b(!0);let e=await l.projectApi.createProject(u.trim());c(t=>[e,...t]),g(""),m(!1),i.push(`/workspace/${e.id}`)}catch(e){console.error("Failed to create project:",e)}finally{b(!1)}},v=async(t,s)=>{if(s.stopPropagation(),confirm("Delete this project? This cannot be undone."))try{if(await l.projectApi.deleteProject(t),c(e=>e.filter(e=>e.id!==t)),t===e&&o.length>1){let e=o.filter(e=>e.id!==t);i.push(`/workspace/${e[0].id}`)}}catch(e){console.error("Failed to delete project:",e)}};return(0,t.jsxs)(t.Fragment,{children:[a&&(0,t.jsx)("button",{onClick:n,className:"fixed left-0 top-1/2 -translate-y-1/2 z-50 bg-white border border-l-0 border-[#E5E7EB] rounded-r-lg p-2 shadow-sm hover:bg-gray-50 transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-[#6B7280]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,t.jsxs)("aside",{className:`fixed left-0 top-0 h-full bg-white border-r border-[#E5E7EB] z-40 transition-all duration-300 flex flex-col ${a?"-translate-x-full":"translate-x-0"}`,style:{width:"280px"},children:[(0,t.jsxs)("div",{className:"h-16 px-4 flex items-center justify-between border-b border-[#E5E7EB] flex-shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),(0,t.jsx)("span",{className:"font-semibold text-[#1A1A1A]",children:"L-1 Builder"})]}),(0,t.jsx)("button",{onClick:n,className:"p-1.5 text-[#6B7280] hover:text-[#1A1A1A] hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})]}),(0,t.jsx)("div",{className:"p-3 border-b border-[#E5E7EB] flex-shrink-0",children:h?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("input",{type:"text",value:u,onChange:e=>g(e.target.value),onKeyDown:e=>"Enter"===e.key&&j(),placeholder:"Project name...",autoFocus:!0,className:"w-full px-3 py-2 text-sm border border-[#E5E7EB] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-[#1A1A1A] placeholder:text-gray-400"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:j,disabled:p||!u.trim(),className:"flex-1 px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:p?"Creating...":"Create"}),(0,t.jsx)("button",{onClick:()=>{m(!1),g("")},className:"px-3 py-1.5 text-[#6B7280] text-sm hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"})]})]}):(0,t.jsxs)("button",{onClick:()=>m(!0),className:"w-full px-3 py-2 bg-blue-50 text-blue-600 text-sm font-medium rounded-lg hover:bg-blue-100 transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Project"]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto py-2",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent"})}):0===o.length?(0,t.jsx)("div",{className:"text-center py-8 text-[#6B7280] text-sm",children:"No projects yet"}):(0,t.jsx)("div",{className:"space-y-1 px-2",children:o.map(s=>(0,t.jsxs)("div",{onClick:()=>i.push(`/workspace/${s.id}`),className:`group flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition-all ${s.id===e?"bg-blue-50 text-blue-600":"hover:bg-gray-50 text-[#1A1A1A]"}`,children:[(0,t.jsx)("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${s.id===e?"bg-blue-100":"bg-gray-100"}`,children:(0,t.jsx)("svg",{className:`w-4 h-4 ${s.id===e?"text-blue-600":"text-[#6B7280]"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium truncate",children:s.name}),(0,t.jsx)("div",{className:"text-xs text-[#6B7280] truncate",children:s.beneficiaryName||"No beneficiary"})]}),(0,t.jsx)("button",{onClick:e=>v(s.id,e),className:"opacity-0 group-hover:opacity-100 p-1 text-[#6B7280] hover:text-red-500 hover:bg-red-50 rounded transition-all",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),s.id===e&&(0,t.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-600 flex-shrink-0"})]},s.id))})}),(0,t.jsx)("div",{className:"p-3 border-t border-[#E5E7EB] flex-shrink-0",children:(0,t.jsxs)("div",{className:"text-xs text-[#6B7280] text-center",children:[o.length," project",1!==o.length?"s":""]})})]}),!a&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/20 z-30 lg:hidden",onClick:n})]})}function R(){let e=(0,r.useParams)(),i=(0,r.useRouter)(),c=e.id,[x,h]=(0,s.useState)(null),[u,g]=(0,s.useState)(!0),[p,b]=(0,s.useState)(""),[f,j]=(0,s.useState)(!1),[v,y]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),[A,E]=(0,s.useState)([]),[B,C]=(0,s.useState)([]),[_,S]=(0,s.useState)(!0),[M,P]=(0,s.useState)({}),[R,z]=(0,s.useState)(!1),[I,W]=(0,s.useState)(null),[T,V]=(0,s.useState)(""),[q,H]=(0,s.useState)("pipeline"),[U,G]=(0,s.useState)(!0),[J,Y]=(0,s.useState)(null);(0,s.useEffect)(()=>{console.log("[DEBUG] useEffect triggered, projectId:",c),c&&(console.log("[DEBUG] Calling loadProject..."),Q(),K(),X())},[c]);let Q=async()=>{try{console.log("[DEBUG] loadProject started, calling API..."),g(!0);let e=await l.projectApi.getProject(c);console.log("[DEBUG] loadProject got data:",e),h(e),e.beneficiaryName&&b(e.beneficiaryName),e.petitionerName&&y(e.petitionerName),e.foreignEntityName&&k(e.foreignEntityName)}catch(e){console.error("Failed to load project:",e),i.push("/")}finally{g(!1)}},K=async()=>{try{S(!0);let e=await l.documentApi.getDocuments(c);E(e.documents||[])}catch(e){console.error("Failed to load documents:",e),et("Failed to load documents","error")}finally{S(!1)}},X=async()=>{try{let e=await l.analysisApi.getSummary(c);e?.by_standard&&P(e.by_standard)}catch{}},Z=async()=>{if(p.trim())try{j(!0),await l.projectApi.updateProject(c,{beneficiaryName:p.trim()}),et("Beneficiary name saved","success")}catch(e){console.error("Failed to save beneficiary name:",e),et("Failed to save","error")}finally{j(!1)}},ee=async()=>{try{await l.projectApi.updateProject(c,{petitionerName:v||void 0,foreignEntityName:N||void 0})}catch(e){console.error("Failed to save entity names:",e)}},et=(e,t)=>{Y({message:e,type:t})},es=async e=>{try{z(!0);let t=await l.analysisApi.analyzeDocuments(c,e);t.success&&(await l.analysisApi.generateSummary(c),await X(),et(`Analyzed ${t.total_docs_analyzed} docs, found ${t.total_quotes_found} quotes`,"success"))}catch(e){console.error("Analysis failed:",e),et("Analysis failed","error")}finally{z(!1)}},er=(0,s.useCallback)(e=>{let t=A.find(t=>t.exhibit_number===e.source.exhibit_id);W(e),V(t?.ocr_text||"")},[A]);if(u)return(0,t.jsx)("div",{className:"min-h-screen bg-[#FAFAFA] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"text-[#6B7280]",children:"Loading workspace..."})]})});if(!x)return(0,t.jsx)("div",{className:"min-h-screen bg-[#FAFAFA] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-[#1A1A1A]",children:"Project not found"}),(0,t.jsx)("button",{onClick:()=>i.push("/"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Projects"})]})});let el=(0,t.jsx)(m,{projectName:x.name,projectId:c,beneficiaryName:p,onBeneficiaryChange:b,onBeneficiarySave:Z,isSaving:f,layoutMode:q,onLayoutChange:H}),ea=(0,t.jsx)(w,{projectId:c,documents:A,selectedDocs:B,onSelectDoc:e=>{C(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onSelectAll:()=>{B.length===A.length?C([]):C(A.map(e=>e.id))},onRefresh:K,onError:e=>et(e,"error"),onSuccess:e=>et(e,"success"),loading:_}),en=(0,t.jsx)(L,{projectId:c,documents:A,selectedDocs:B,quotesByStandard:M,onRunAnalysis:es,isAnalyzing:R,onViewQuote:er}),ei=(0,t.jsx)($,{projectId:c,quotesByStandard:M,beneficiaryName:p,petitionerName:v,foreignEntityName:N,onPetitionerChange:y,onForeignEntityChange:k,onEntitySave:ee,onViewQuote:er}),eo=(0,t.jsx)(F,{projectId:c,documents:A,onError:e=>et(e,"error"),onSuccess:e=>et(e,"success")});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D,{currentProjectId:c,isCollapsed:U,onToggle:()=>G(!U)}),(0,t.jsx)("div",{className:"transition-all duration-300",style:{marginLeft:280*!U},children:(()=>{let e={header:el,documents:ea,analysis:en,generate:ei,highlight:eo};switch(q){case"sidebar":return(0,t.jsx)(o,{...e});case"tabs":return(0,t.jsx)(d,{...e});default:return(0,t.jsx)(n,{...e})}})()}),(0,t.jsx)(O,{isOpen:!!I,onClose:()=>W(null),quote:I,documentOcrText:T}),J&&(0,t.jsx)(a.default,{message:J.message,type:J.type,onClose:()=>Y(null)})]})}e.s(["default",()=>R],75283)}]);